{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "permissions": {
    "allow": [
      "Read",
      "Write",
      "Edit",
      "Glob",
      "Grep",
      "Task",
      "WebSearch",
      "Bash(git:*)",
      "Bash(pnpm:*)",
      "Bash(npm:*)",
      "Bash(npx:*)",
      "Bash(node:*)",
      "Bash(prisma:*)",
      "Bash(cat:*)",
      "Bash(ls:*)",
      "Bash(dir:*)",
      "Bash(tree:*)",
      "Bash(find:*)",
      "Bash(findstr:*)",
      "Bash(xargs:*)",
      "Bash(echo:*)",
      "WebFetch(domain:github.com)",
      "WebFetch(domain:nextjs.org)",
      "WebFetch(domain:react.dev)",
      "WebFetch(domain:ui.shadcn.com)",
      "WebFetch(domain:tailwindcss.com)",
      "WebFetch(domain:prisma.io)",
      "WebFetch(domain:docs.rs)",
      "WebFetch(domain:actix.rs)",
      "WebFetch(domain:typescript-eslint.io)",
      "WebFetch(domain:vitest.dev)",
      "WebFetch(domain:playwright.dev)",
      "WebFetch(domain:zod.dev)",
      "mcp__Ref__ref_search_documentation",
      "mcp__Ref__ref_read_url"
    ],
    "deny": [

    ],
    "ask": []
  },
  "model": "opus",
  "enableAllProjectMcpServers": true,
  "includeCoAuthoredBy": true,
  "alwaysThinkingEnabled": true,
  "env": {
    "PROJECT_NAME": "Hogwarts School Automation Platform",
    "PROJECT_TYPE": "nextjs-prisma-multiTenant",
    "MULTI_TENANT": "true",
    "I18N_LANGUAGES": "en,ar",
    "BMAD_ENABLED": "true",
    "AUTOMATION_LEVEL": "maximum",
    "TDD_ENFORCE": "true",
    "ORCHESTRATOR_MODEL": "claude-opus-4-1-20250805",
    "DEFAULT_MODEL": "opus",
    "COVERAGE_TARGET": "95",
    "ERROR_PATTERNS": "204",
    "AGENT_COUNT": "33"
  },
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash(git:commit)",
        "hooks": [
          {
            "type": "command",
            "command": "BRANCH=$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo 'unknown'); echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"; echo \"ðŸ” PRE-COMMIT BUILD VALIDATION\"; echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"; echo \"Branch: $BRANCH\"; echo \"\"; echo \"Step 1: TypeScript Compilation\"; pnpm tsc --noEmit > /tmp/tsc-output.txt 2>&1 || TSC_EXIT=$?; if [ ! -z \"$TSC_EXIT\" ]; then TSC_ERROR_COUNT=$(wc -l < /tmp/tsc-output.txt 2>/dev/null || echo 0); echo \"âŒ TypeScript: $TSC_ERROR_COUNT errors found\"; head -n 10 /tmp/tsc-output.txt 2>/dev/null; echo \"\"; echo \"ðŸ’¡ Fix: Run 'pnpm tsc --noEmit' to see all errors\"; echo \"ðŸ’¡ Auto-fix: Many TypeScript errors can be auto-fixed\"; ERRORS_FOUND=1; else echo \"âœ… TypeScript: 0 errors\"; fi; echo \"\"; echo \"Step 2: Prisma Client Sync\"; if git diff --cached --name-only | grep -q \"prisma/schema.prisma\\|prisma/models/\"; then echo \"ðŸ” Prisma schema changed, checking client sync...\"; if [ -f node_modules/.prisma/client/index.d.ts ]; then SCHEMA_TIME=$(stat -c %Y prisma/schema.prisma 2>/dev/null || stat -f %m prisma/schema.prisma 2>/dev/null || echo 0); CLIENT_TIME=$(stat -c %Y node_modules/.prisma/client/index.d.ts 2>/dev/null || stat -f %m node_modules/.prisma/client/index.d.ts 2>/dev/null || echo 0); if [ $SCHEMA_TIME -gt $CLIENT_TIME ]; then echo \"âš ï¸  Prisma: Client out of sync (schema modified after client generation)\"; echo \"ðŸ’¡ Fix: Run 'pnpm prisma generate' to regenerate client\"; ERRORS_FOUND=1; else echo \"âœ… Prisma: Client up to date\"; fi; else echo \"âš ï¸  Prisma: Client not found\"; echo \"ðŸ’¡ Fix: Run 'pnpm prisma generate'\"; ERRORS_FOUND=1; fi; else echo \"âœ… Prisma: No schema changes detected\"; fi; echo \"\"; echo \"Step 3: Linting\"; pnpm lint --quiet 2>&1 | head -n 10 || LINT_EXIT=$?; if [ ! -z \"$LINT_EXIT\" ]; then echo \"âŒ ESLint: Errors found\"; echo \"ðŸ’¡ Fix: Run 'pnpm lint --fix' to auto-fix\"; ERRORS_FOUND=1; else echo \"âœ… ESLint: No errors\"; fi; echo \"\"; echo \"Step 4: Running Tests (Changed Files)\"; pnpm test --changed --silent --run 2>&1 | grep -E \"(PASS|FAIL|Test Suites)\" || TEST_EXIT=$?; if [ ! -z \"$TEST_EXIT\" ]; then echo \"âŒ Tests: Failed\"; ERRORS_FOUND=1; else echo \"âœ… Tests: Passed\"; fi; echo \"\"; echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"; if [ ! -z \"$ERRORS_FOUND\" ]; then echo \"âŒ PRE-COMMIT VALIDATION FAILED\"; echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"; echo \"\"; echo \"Errors detected. Please fix before committing.\"; echo \"\"; echo \"Quick Fixes:\"; echo \"  - TypeScript errors: Fix manually or check for auto-fix patterns\"; echo \"  - Prisma sync: pnpm prisma generate\"; echo \"  - Linting: pnpm lint --fix\"; echo \"  - Tests: Fix failing tests\"; echo \"\"; echo \"Documentation: /docs/build\"; echo \"\"; if [ \"$BRANCH\" = \"main\" ] || [ \"$BRANCH\" = \"master\" ] || [ \"$BRANCH\" = \"production\" ]; then echo \"ðŸš« COMMIT BLOCKED on protected branch ($BRANCH)\"; exit 1; else echo \"âš ï¸  You can override with: git commit --no-verify\"; echo \"   (Not recommended - fix errors before merging to main)\"; exit 1; fi; else echo \"âœ… ALL PRE-COMMIT CHECKS PASSED\"; echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"; echo \"\"; exit 0; fi"
          }
        ]
      },
      {
        "matcher": "Bash(git:push)",
        "hooks": [
          {
            "type": "command",
            "command": "BRANCH=$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo 'unknown'); echo \"ðŸ” Pre-Push Build Verification (Branch: $BRANCH)\"; echo \"\"; echo \"Running production build...\"; pnpm build 2>&1 | grep -v \"^$\" || BUILD_EXIT=$?; echo \"Checking Prettier formatting...\"; npx prettier --check \"src/**/*.{ts,tsx,js,jsx}\" --log-level error 2>&1 | grep -v \"^$\" || PRETTIER_EXIT=$?; echo \"\"; if [ \"$BRANCH\" = \"main\" ] || [ \"$BRANCH\" = \"master\" ] || [ \"$BRANCH\" = \"production\" ]; then if [ ! -z \"$BUILD_EXIT\" ] || [ ! -z \"$PRETTIER_EXIT\" ]; then echo \"âŒ PUSH BLOCKED: Build or formatting checks failed on protected branch ($BRANCH)\"; echo \"Fix errors above before pushing to $BRANCH\"; exit 1; fi; else if [ ! -z \"$BUILD_EXIT\" ] || [ ! -z \"$PRETTIER_EXIT\" ]; then echo \"âš ï¸  WARNING: Build or formatting checks failed on feature branch ($BRANCH)\"; echo \"Allowing push, but please fix errors before merging to main\"; fi; fi; echo \"âœ… Pre-Push checks passed\"; exit 0"
          }
        ]
      },
      {
        "matcher": "Bash(git:merge)",
        "hooks": [
          {
            "type": "command",
            "command": "echo \"ðŸ”„ Pre-Merge Validation\"; echo \"Running comprehensive checks before merge...\"; echo \"\"; echo \"1. Running all tests...\"; pnpm test --run 2>&1 | grep -E \"(PASS|FAIL|Test Suites)\" || TEST_EXIT=$?; echo \"\"; echo \"2. Checking build...\"; pnpm build 2>&1 | grep -E \"(âœ“|âœ—|error|Error)\" || BUILD_EXIT=$?; echo \"\"; echo \"3. Checking for merge conflicts...\"; git diff --check || CONFLICT_EXIT=$?; echo \"\"; if [ ! -z \"$TEST_EXIT\" ] || [ ! -z \"$BUILD_EXIT\" ] || [ ! -z \"$CONFLICT_EXIT\" ]; then echo \"âŒ MERGE BLOCKED: Pre-merge checks failed\"; echo \"Please fix all issues before merging\"; exit 1; fi; echo \"âœ… All pre-merge checks passed\"; exit 0"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "npx prettier --write \"$CLAUDE_TOOL_ARGS\" --log-level silent || exit 0"
          }
        ]
      },
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "npx prettier --write \"$CLAUDE_TOOL_ARGS\" --log-level silent || exit 0"
          }
        ]
      },
      {
        "matcher": "Bash(git:commit)",
        "hooks": [
          {
            "type": "command",
            "command": "echo \"ðŸ“ Post-Commit Actions\"; COMMIT_MSG=$(git log -1 --pretty=%B 2>/dev/null); if [ ! -z \"$COMMIT_MSG\" ]; then if echo \"$COMMIT_MSG\" | grep -qE '^(feat|fix|refactor|perf|docs|style|test|chore|build|ci)'; then echo \"âœ… Commit message follows conventional format\"; if [ -f CHANGELOG.md ] && echo \"$COMMIT_MSG\" | grep -qE '^(feat|fix)'; then echo \"ðŸ’¡ Consider updating CHANGELOG.md for this $(echo $COMMIT_MSG | cut -d: -f1) commit\"; fi; else echo \"ðŸ’¡ Consider using conventional commit format: feat|fix|refactor|perf|docs|style|test|chore|build|ci\"; fi; fi; echo \"Commit successful! Run 'git push' when ready to share your changes.\"; exit 0"
          }
        ]
      }
    ],
    "SessionStart": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'ðŸš€ HOGWARTS SCHOOL AUTOMATION PLATFORM'; echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'; echo 'Stack: Next.js 15 + React 19 + Prisma + TypeScript'; echo 'Auto-Deploy: SessionEnd triggers validation + deploy'; echo ''; BRANCH=$(git branch --show-current 2>/dev/null); CHANGES=$(git status --porcelain 2>/dev/null | wc -l); echo \"ðŸ“Š Repository: $BRANCH branch | $CHANGES uncommitted\"; echo ''; echo 'âš¡ Development Loop (fastest â†’ thorough):'; echo '  /quick    - Lint + commit + push (~10s)'; echo '  /dev      - Validate + test + build + deploy (~30s)'; echo '  /deploy   - Full auto-deploy pipeline (~30s)'; echo '  /validate - Agent-powered validation (~2min)'; echo '  /ship     - Production release (~5min)'; echo ''; echo 'ðŸ”„ Auto-Deploy: Changes auto-deploy on session end'; echo ''; exit 0"
          }
        ]
      }
    ],
    "SessionEnd": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "echo ''; echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'; echo 'ðŸ“Š SESSION END - AUTO-DEPLOY CHECK'; echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'; UNCOMMITTED=$(git status --porcelain 2>/dev/null | wc -l | tr -d ' '); if [ \"$UNCOMMITTED\" -gt 0 ]; then echo \"ðŸ“ Found $UNCOMMITTED uncommitted changes\"; echo ''; echo 'ðŸš€ Running auto-deploy...'; echo ''; if [ -x .claude/hooks/deploy.sh ]; then .claude/hooks/deploy.sh; else echo 'âš ï¸  Deploy hook not found. Running manual deploy...'; pnpm tsc --noEmit && pnpm lint --fix --quiet && pnpm build && git add -A && git commit -m 'chore: auto-deploy session changes' && git push; fi; else echo 'âœ… No uncommitted changes'; fi; echo ''; echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'; echo 'ðŸš€ Session complete!'; echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'; exit 0"
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "echo \"ðŸš¨ Error Detection Hook Activated\"; TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S' 2>/dev/null || echo 'timestamp unavailable'); echo \"Event occurred at: $TIMESTAMP\"; if [ ! -d .claude ]; then mkdir -p .claude; fi; echo \"[$TIMESTAMP] Tool or operation stopped/failed\" >> .claude/error.log 2>/dev/null || true; echo \"ðŸ’¡ Common fixes:\"; echo \"  - TypeScript errors: Run 'pnpm tsc --noEmit' to see details\"; echo \"  - Missing dependencies: Run 'pnpm install'\"; echo \"  - Prisma errors: Run 'pnpm prisma generate'\"; echo \"  - Linting errors: Run 'pnpm lint --fix'\"; echo \"Event logged to .claude/error.log\"; exit 0"
          }
        ]
      }
    ]
  }
}
