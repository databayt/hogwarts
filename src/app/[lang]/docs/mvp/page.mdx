export const metadata = {
  title: 'MVP Implementation Checklist - Hogwarts',
  description: 'Developer onboarding guide for Hogwarts School Automation Platform - Core MVP assessment checklist',
}

# MVP Implementation Checklist

<p className="lead">
  Multi-tenant school management system. 6 core epics, 98 stories. Production-ready with testing gaps.
</p>

---

## Quick Start

### Tech Stack

- **Next.js 15.4.4** - App Router + Turbopack
- **React 19.1.0** - Server Components
- **TypeScript 5.x** - Strict mode
- **Prisma 6.14.0** - PostgreSQL (Neon)
- **NextAuth v5** - JWT, OAuth (Google/Facebook), 2FA
- **Tailwind CSS 4** - RTL/LTR support
- **shadcn/ui** - Radix UI primitives

### Run Locally

```bash
pnpm install              # Install dependencies
pnpm prisma generate      # Generate Prisma client
pnpm db:seed             # Seed database
pnpm dev                 # Start dev server (localhost:3000)
```

### Critical Rules

1. **ALWAYS include `schoolId` in queries** - Multi-tenant isolation
2. **Use Server Actions pattern** - See examples below
3. **Follow Mirror Pattern** - Routes mirror components
4. **Validate twice** - Client (UX) + Server (security)

---

## Core MVP Scope (6 Epics)

**Total: 98 core stories across 6 essential epics**

### Epic Progress Assessment

Use these checklists to assess current implementation status during your first week.

#### Epic 1: Foundation & Infrastructure [_/15]
**Goal:** Multi-tenant architecture, subdomain routing, core setup

- [ ] Multi-tenant database schema with `schoolId` scoping
- [ ] Subdomain routing working (`school.databayt.org`)
- [ ] Next.js 15 + React 19 + Prisma 6 configured
- [ ] CI/CD pipeline with automated tests
- [ ] Error monitoring (Sentry) operational
- [ ] Internationalization (Arabic/English) functional
- [ ] Development/staging/production environments

**Key Files:**
- `src/middleware.ts` - Subdomain rewriting
- `src/lib/tenant-context.ts` - Get `schoolId` from context
- `prisma/schema.prisma` - Multi-tenant models
- `.github/workflows/` - CI/CD configuration

---

#### Epic 2: Authentication & Authorization [_/18]
**Goal:** User management, 8-role RBAC, secure authentication

- [ ] NextAuth v5 configured with JWT strategy
- [ ] Email/password auth with bcrypt hashing
- [ ] OAuth providers (Google, Facebook) working
- [ ] Two-factor authentication (2FA) functional
- [ ] 8 roles implemented (DEVELOPER, ADMIN, TEACHER, STUDENT, GUARDIAN, ACCOUNTANT, STAFF, USER)
- [ ] Role-based access control enforced on routes
- [ ] Password reset flow complete
- [ ] Session management with auto-renewal
- [ ] User profile management

**Key Files:**
- `src/auth.ts` - NextAuth configuration
- `src/auth.config.ts` - Auth callbacks
- `src/middleware.ts` - Route protection
- `prisma/models/auth.prisma` - User, Account, Session models

---

#### Epic 3: School Configuration [_/12]
**Goal:** School setup, academic structure, year levels

- [ ] School profile creation and management
- [ ] Academic year setup with terms/periods
- [ ] Year level/grade configuration
- [ ] Department management
- [ ] School branding (logo, colors)
- [ ] Timezone configuration
- [ ] School settings page functional

**Key Files:**
- `src/components/platform/settings/` - School configuration
- `prisma/models/school.prisma` - School model

---

#### Epic 4: Student Management [_/20]
**Goal:** Student lifecycle from enrollment to graduation

- [ ] Student enrollment form working
- [ ] Comprehensive profiles (personal, academic, health)
- [ ] Search and filtering functional
- [ ] Guardian relationships
- [ ] Document upload (certificates, records)
- [ ] Health records tracking
- [ ] Achievement tracking
- [ ] Photo management
- [ ] Batch operations (import/export CSV)
- [ ] Status transitions (enrolled, transferred, graduated)

**Key Files:**
- `src/components/platform/students/` - Student components
- `src/app/[lang]/s/[subdomain]/(platform)/students/` - Student routes
- `prisma/models/students.prisma` - Student model

---

#### Epic 5: Teacher & Staff Management [_/15]
**Goal:** Teacher profiles, qualifications, workload tracking

- [ ] Teacher profile creation
- [ ] Qualifications management
- [ ] Department assignments
- [ ] Subject expertise tracking
- [ ] Workload calculator
- [ ] Class assignments
- [ ] Teacher dashboard
- [ ] Non-teaching staff management

**Key Files:**
- `src/components/platform/teachers/` - Teacher components
- `src/components/platform/staff/` - Staff components
- `prisma/models/staff.prisma` - Teacher/Staff models

---

#### Epic 6: Class & Subject Management [_/18]
**Goal:** Academic organization, timetable, class scheduling

- [ ] Subject catalog with curriculum
- [ ] Class creation with capacity management
- [ ] Student enrollment in classes
- [ ] Teacher-subject allocation
- [ ] Timetable builder (drag-and-drop)
- [ ] Conflict detection
- [ ] Period-wise scheduling
- [ ] Class sections management
- [ ] Resource sharing
- [ ] Class analytics

**Key Files:**
- `src/components/platform/classes/` - Class components
- `src/components/platform/subjects/` - Subject components
- `src/components/platform/timetable/` - Timetable builder
- `prisma/models/classrooms.prisma` - Class models

---

## Optional Epics (Phase 2)

These epics are implemented but can be considered Phase 2 enhancements:

### Epic 7: Attendance System [_/16]
Daily attendance, period-wise tracking, QR codes, analytics

### Epic 8: Fee Management [_/18]
Fee structures, invoicing, payment tracking, receipts

---

## Technical Patterns Reference

### Server Actions Pattern

**CRITICAL:** All server actions MUST follow this pattern:

```typescript
// actions.ts
"use server"

import { getTenantContext } from "@/lib/tenant-context"
import { db } from "@/lib/db"
import { revalidatePath } from "next/cache"
import { schema } from "./validation"

export async function createEntity(input: FormData) {
  // 1. Get schoolId (MANDATORY)
  const { schoolId } = await getTenantContext()
  if (!schoolId) throw new Error("Missing school context")

  // 2. Validate input
  const validated = schema.parse(Object.fromEntries(input))

  // 3. Execute with schoolId scope
  const result = await db.entity.create({
    data: { ...validated, schoolId }  // ALWAYS include schoolId
  })

  // 4. Revalidate cache
  revalidatePath('/entity')

  return { success: true, id: result.id }
}
```

### Multi-Tenant Safety Checklist

Every feature MUST verify:

- [ ] All queries include `where: { schoolId }`
- [ ] Create/update operations include `schoolId`
- [ ] Unique constraints scoped by `schoolId`
- [ ] Session includes `schoolId` from context
- [ ] No hardcoded school references
- [ ] Automated test verifies isolation

### Mirror Pattern Structure

```
src/app/[lang]/s/[subdomain]/(platform)/<feature>/
  â””â”€â”€ page.tsx               # Imports from components

src/components/platform/<feature>/
  â”œâ”€â”€ content.tsx            # Server component (main UI)
  â”œâ”€â”€ actions.ts             # "use server" functions
  â”œâ”€â”€ validation.ts          # Zod schemas
  â”œâ”€â”€ types.ts               # TypeScript types
  â”œâ”€â”€ form.tsx               # Client component
  â”œâ”€â”€ table.tsx              # Client component (data table)
  â””â”€â”€ columns.tsx            # Column definitions
```

### Data Table Pattern

```typescript
// table.tsx - Client component
"use client"

import { useDataTable } from "@/hooks/use-data-table"
import { columns } from "./columns"

export function EntityTable({ data }) {
  const table = useDataTable({
    data,
    columns,
    // URL-synced state with nuqs
  })

  return <DataTable table={table} />
}
```

---

## Technical Debt Inventory

### ðŸ”´ Critical Priority

**E2E Test Coverage Gap**
- **Current:** ~0 E2E tests (Playwright configured but unused)
- **Impact:** No automated user flow validation
- **Action:** Create E2E test suite covering critical paths
- **Priority Test Scenarios:**
  1. Student enrollment flow
  2. Teacher assignment to class
  3. Attendance marking
  4. Fee payment processing
  5. Multi-tenant isolation verification

**Estimated Effort:** 2-3 weeks for core coverage

---

### ðŸŸ¡ Medium Priority

**61 TODO/FIXME Items Across Codebase**

**By Category:**
1. **Photo/Document Management** (12 TODOs)
   - Student photo upload optimization
   - Document attachment enhancements
   - File storage quota management

2. **Finance Enhancements** (18 TODOs)
   - Invoice PDF generation improvements
   - Bank reconciliation automation
   - Receipt template customization

3. **Exam System** (15 TODOs)
   - Conflict detection optimization
   - Results analytics enhancement
   - Question bank quality scoring

4. **UI Polish** (10 TODOs)
   - Icon updates
   - Messaging UI improvements
   - Mobile responsiveness tweaks

5. **Read Tracking** (6 TODOs)
   - Announcement read receipt optimization
   - Notification delivery status

**Estimated Effort:** 4-6 weeks for all categories

---

### ðŸŸ¢ Low Priority

**Documentation Updates**
- Some READMEs mention "In Progress" for completed features
- Update feature completion status

**Finance Module Simplification**
- 12 finance sub-modules may be over-engineered for basic MVP
- Consider consolidating for simpler maintenance

**Estimated Effort:** 1-2 weeks

---

## API & Integration Points

### Authentication Endpoints

```typescript
// NextAuth v5 API routes
POST /api/auth/signin           // Login
POST /api/auth/signout          // Logout
GET  /api/auth/session          // Get current session
POST /api/auth/callback/google  // OAuth callback
POST /api/auth/callback/facebook
```

### Server Actions Pattern (Primary API)

**No traditional REST API** - Uses Next.js Server Actions exclusively:

```typescript
// Import and call directly in client components
import { createStudent } from "@/components/platform/students/actions"

const result = await createStudent(formData)
```

### Key Data Models

**Core Entities:** (27 Prisma models in `prisma/models/`)
- `School` - Tenant root entity
- `User` - Authentication + RBAC
- `Student` - Student records
- `Teacher` - Teacher profiles
- `Class` - Class organization
- `Subject` - Subject catalog
- `Attendance` - Attendance tracking
- `Grade` - Assessment records
- `Fee` - Fee management

**All models include:**
- `schoolId` (required, indexed)
- `@@unique` constraints scoped by `schoolId`
- Timestamps (`createdAt`, `updatedAt`)

### File Upload

**Pattern:** Direct upload to storage (implementation varies)
- Student photos
- Document attachments
- Report exports

---

## Testing Coverage Gaps

### Current Status

**Unit Tests:** 14 test files
- `src/components/platform/operator/**/*.test.ts` - Operator features
- `src/components/platform/timetable/**/*.test.ts` - Timetable logic
- `src/components/platform/attendance/**/*.test.ts` - Attendance actions
- `src/components/platform/announcements/**/*.test.ts` - Announcement actions

**Coverage:** ~10% of features have unit tests

**E2E Tests:** 0-1 test files
- Playwright configured for 5 browsers
- No comprehensive E2E test suite

---

### Priority Test Scenarios Needed

**Critical User Flows (E2E):**
1. [ ] Student enrollment end-to-end
2. [ ] Teacher creates class and adds students
3. [ ] Attendance marking (daily + period-wise)
4. [ ] Grade assignment submission and grading
5. [ ] Fee invoice generation and payment
6. [ ] Multi-tenant isolation (no cross-school data leaks)
7. [ ] Role-based access control (RBAC verification)
8. [ ] Parent portal (view student data)

**Integration Tests:**
1. [ ] Authentication flows (email, OAuth, 2FA)
2. [ ] School onboarding wizard
3. [ ] Bulk student import (CSV)
4. [ ] Report generation (PDF exports)
5. [ ] Notification delivery

**Unit Test Gaps:**
- Students component (~5% coverage)
- Teachers component (~5% coverage)
- Classes component (~5% coverage)
- Finance module (0% coverage)
- Communication module (minimal coverage)

---

## First Week Action Items

Your team's first week checklist:

### Day 1-2: Environment Setup
- [ ] Clone repo and install dependencies
- [ ] Set up local PostgreSQL database
- [ ] Configure environment variables
- [ ] Run migrations and seed data
- [ ] Verify app runs locally

### Day 3-4: Codebase Audit
- [ ] Review architecture patterns (above)
- [ ] Audit Epic 1-6 completion status (fill checkboxes)
- [ ] Identify top 3 technical debt priorities
- [ ] Review 61 TODOs and categorize urgency
- [ ] Map feature directory structure

### Day 5: Testing Strategy
- [ ] Review existing test coverage (14 test files)
- [ ] Create E2E testing plan (8 critical scenarios)
- [ ] Estimate effort for test coverage goals
- [ ] Set up Playwright test environment

---

## Next Steps

<div className="grid gap-6 md:grid-cols-2 my-8">
  <div className="rounded-lg border bg-card p-6">
    <h4>Product Requirements</h4>
    <p className="muted">Read the complete PRD for detailed feature specifications</p>
    <p><a href="/docs/prd">View PRD â†’</a></p>
  </div>

  <div className="rounded-lg border bg-card p-6">
    <h4>Epic Breakdown</h4>
    <p className="muted">Explore the detailed user stories for each epic</p>
    <p><a href="/docs/epics">View Epics â†’</a></p>
  </div>

  <div className="rounded-lg border bg-card p-6">
    <h4>Architecture Guide</h4>
    <p className="muted">Understand the technical architecture and patterns</p>
    <p><a href="/docs/architecture">View Architecture â†’</a></p>
  </div>

  <div className="rounded-lg border bg-card p-6">
    <h4>CLAUDE.md</h4>
    <p className="muted">Essential commands, workflows, and development guidelines</p>
    <p><a href="https://github.com/databayt/hogwarts/blob/main/CLAUDE.md">View Guide â†’</a></p>
  </div>
</div>

---

<div className="rounded-lg border bg-muted p-6 my-8">
  <p className="muted">
    <strong>Document Purpose:</strong> This checklist is designed for a team of 4 developers newly assigned to the Hogwarts project. Use it to assess current implementation status, identify technical debt, and plan your first sprint. All checkboxes should be filled during your first week audit.
  </p>
</div>
