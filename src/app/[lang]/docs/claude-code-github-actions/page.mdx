# Claude Code GitHub Actions

Integrate Claude Code into your CI/CD pipeline with GitHub Actions for automated code review, testing, documentation, and quality checks on every commit and pull request.

## What is GitHub Actions Integration?

GitHub Actions integration allows Claude to participate in your CI/CD pipeline:

- **Automated Code Review**: Review every PR automatically
- **Test Generation**: Generate missing tests
- **Documentation Updates**: Keep docs in sync with code
- **Security Scanning**: Check for vulnerabilities
- **Performance Analysis**: Detect performance regressions
- **Standards Enforcement**: Ensure code follows conventions
- **Changelog Generation**: Auto-generate release notes
- **Issue Triage**: Automatically label and assign issues

All running automatically on GitHub's infrastructure.

## Setup Options

### Method 1: Quick Setup (Recommended)

Add Claude Code action to your workflow:

```yaml
# .github/workflows/claude.yml
name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Claude Code Review
        uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
          task: review-pr
```

### Method 2: Custom Workflow

Full control over Claude's behavior:

```yaml
# .github/workflows/claude-review.yml
name: AI Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  claude-review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Claude Code
        run: npm install -g claude-code

      - name: Review PR
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          claude -p "Review this pull request for:
          1. Code quality and best practices
          2. Security vulnerabilities
          3. Performance issues
          4. Test coverage
          5. Documentation completeness

          Post your findings as a PR comment with:
          - Issues that must be fixed
          - Suggestions for improvement
          - Things done well

          Be constructive and specific."
```

### Method 3: Multi-Task Workflow

Run multiple Claude tasks in parallel:

```yaml
# .github/workflows/claude-multi.yml
name: Claude Multi-Task Review

on:
  pull_request:

jobs:
  security-review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: security-audit

  test-generation:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: generate-tests

  docs-update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: update-docs
```

## Configuration

### Required Secrets

Add to GitHub repository secrets (Settings → Secrets → Actions):

```
ANTHROPIC_API_KEY=your-anthropic-api-key
```

`GITHUB_TOKEN` is automatically provided by GitHub Actions.

### Action Inputs

Configure the Claude Code action:

```yaml
- uses: anthropics/claude-code-action@v1
  with:
    # Required
    anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}

    # Optional
    github-token: ${{ secrets.GITHUB_TOKEN }}
    task: review-pr                    # Task to perform
    model: claude-3-5-sonnet-20250514  # Claude model
    custom-prompt: ""                  # Override default prompt
    config-path: .claude/              # Path to config
    working-directory: ./              # Working directory
    max-tokens: 4096                   # Response length
    temperature: 0.7                   # Creativity (0-1)
```

### Task Types

Pre-built tasks available:

| Task | Description |
|------|-------------|
| `review-pr` | Comprehensive PR review |
| `security-audit` | Security vulnerability scan |
| `generate-tests` | Create missing tests |
| `update-docs` | Sync documentation |
| `check-standards` | Enforce coding standards |
| `performance-check` | Analyze performance |
| `dependency-audit` | Check dependencies |
| `changelog` | Generate changelog entries |

## Workflow Examples

### Code Review on Every PR

```yaml
name: PR Review

on:
  pull_request:
    branches: [main, develop]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Review Changes
        uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: review-pr
          custom-prompt: |
            Review this PR focusing on:
            1. React best practices
            2. TypeScript type safety
            3. Accessibility (a11y)
            4. Performance implications

            Reference @CLAUDE.md for project standards.

      - name: Comment Results
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: process.env.CLAUDE_OUTPUT
            })
```

### Security Scan on Push

```yaml
name: Security Scan

on:
  push:
    branches: [main]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Security Audit
        uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: security-audit

      - name: Create Issue if Vulnerabilities Found
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: '🔒 Security vulnerabilities detected',
              body: process.env.CLAUDE_OUTPUT,
              labels: ['security', 'urgent']
            })
```

### Test Coverage Check

```yaml
name: Test Coverage

on:
  pull_request:

jobs:
  coverage:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install dependencies
        run: npm install

      - name: Run tests with coverage
        run: npm test -- --coverage

      - name: Analyze Coverage
        uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          custom-prompt: |
            Analyze test coverage report.

            For uncovered code:
            1. Identify critical paths without tests
            2. Generate test cases for high-priority uncovered code
            3. Create test files following project patterns

            Post summary and generated tests as PR comment.
```

### Documentation Sync

```yaml
name: Docs Sync

on:
  push:
    paths:
      - 'src/**/*.ts'
      - 'src/**/*.tsx'

jobs:
  docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Update Documentation
        uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: update-docs

      - name: Commit Documentation
        run: |
          git config user.name "Claude Bot"
          git config user.email "claude@anthropic.com"
          git add docs/
          git diff --quiet && git diff --staged --quiet || git commit -m "docs: Update documentation [skip ci]"
          git push
```

### Dependency Audit

```yaml
name: Dependency Audit

on:
  schedule:
    - cron: '0 0 * * 1'  # Weekly on Monday
  workflow_dispatch:      # Manual trigger

jobs:
  audit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check Dependencies
        uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: dependency-audit
          custom-prompt: |
            Audit project dependencies:

            1. Run npm audit
            2. Check for outdated packages
            3. Identify security vulnerabilities
            4. Suggest safe update path
            5. Check license compliance

            Create issue with findings and recommendations.
```

## Advanced Options

### Using AWS Bedrock

For enterprise deployments with AWS:

```yaml
- uses: anthropics/claude-code-action@v1
  with:
    provider: aws-bedrock
    aws-region: us-east-1
    aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
    aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    model: anthropic.claude-3-5-sonnet-20250514-v1:0
```

### Using Google Vertex AI

For Google Cloud deployments:

```yaml
- uses: anthropics/claude-code-action@v1
  with:
    provider: vertex-ai
    vertex-project-id: ${{ secrets.GCP_PROJECT_ID }}
    vertex-location: us-central1
    google-credentials: ${{ secrets.GCP_CREDENTIALS }}
    model: claude-3-5-sonnet@20250514
```

### Custom Configuration Path

Use project-specific Claude config:

```yaml
- uses: anthropics/claude-code-action@v1
  with:
    anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
    config-path: .github/claude/
```

Structure:
```
.github/
  claude/
    settings.json
    commands/
    agents/
```

### Matrix Builds

Run Claude across multiple configurations:

```yaml
jobs:
  review:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        task: [review-pr, security-audit, generate-tests]

    steps:
      - uses: actions/checkout@v4
      - uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: ${{ matrix.task }}
```

## Best Practices

### Cost Management

Claude usage in CI/CD can incur costs. Optimize with:

#### 1. Selective Triggers

```yaml
# Only review significant changes
on:
  pull_request:
    paths:
      - 'src/**'
      - '!**/*.md'
    types: [opened, reopened]
```

#### 2. Use Haiku for Simple Tasks

```yaml
- uses: anthropics/claude-code-action@v1
  with:
    anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
    model: claude-3-5-haiku-20241022  # Faster, cheaper
    task: check-standards
```

#### 3. Cache Results

```yaml
- name: Cache Claude Review
  uses: actions/cache@v4
  with:
    path: .claude-cache
    key: claude-review-${{ github.sha }}
```

#### 4. Set Token Limits

```yaml
- uses: anthropics/claude-code-action@v1
  with:
    anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
    max-tokens: 2048  # Limit response length
```

### Security Considerations

#### 1. Secret Management

Never expose API keys:

```yaml
# ❌ Bad
env:
  ANTHROPIC_API_KEY: sk-ant-xxxxx

# ✅ Good
env:
  ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
```

#### 2. Limit Permissions

```yaml
permissions:
  contents: read          # Read repo content
  pull-requests: write    # Comment on PRs
  issues: write          # Create issues (if needed)
  # Don't grant unnecessary permissions
```

#### 3. Review External PRs Carefully

```yaml
on:
  pull_request_target:  # Be cautious with external PRs
    types: [labeled]

jobs:
  review:
    if: contains(github.event.pull_request.labels.*.name, 'safe-to-review')
    # Only review after manual label
```

### Performance Optimization

#### 1. Parallel Jobs

```yaml
jobs:
  review:
    runs-on: ubuntu-latest
    # ... review job

  security:
    runs-on: ubuntu-latest
    # ... security job

  # Run in parallel, not sequential
```

#### 2. Selective File Reading

```yaml
custom-prompt: |
  Review only files changed in this PR.
  Focus on src/ directory.
  Skip test files for initial review.
```

#### 3. Incremental Reviews

```yaml
on:
  pull_request:
    types: [synchronize]  # On new commits

# Review only new commits, not entire PR
```

## Output Handling

### Capture Claude Output

```yaml
- name: Run Claude
  id: claude
  uses: anthropics/claude-code-action@v1
  with:
    anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
    task: review-pr

- name: Use Output
  run: |
    echo "Review: ${{ steps.claude.outputs.result }}"
```

### Post as PR Comment

```yaml
- name: Comment PR
  uses: actions/github-script@v7
  with:
    script: |
      github.rest.issues.createComment({
        issue_number: context.issue.number,
        owner: context.repo.owner,
        repo: context.repo.repo,
        body: `## Claude Code Review\n\n${process.env.CLAUDE_OUTPUT}`
      })
```

### Create Annotations

```yaml
- name: Annotate Files
  run: |
    # Parse Claude output and create annotations
    echo "::warning file=src/App.tsx,line=10::Potential security issue"
```

## Troubleshooting

### Action Fails to Authenticate

```
Error: Invalid API key
```

**Fix**:
1. Verify `ANTHROPIC_API_KEY` secret is set
2. Check key hasn't expired
3. Ensure key has correct format (`sk-ant-...`)

### Rate Limits

```
Error: Rate limit exceeded
```

**Fix**:
- Reduce action frequency
- Use caching
- Implement exponential backoff
- Consider multiple API keys (if allowed)

### Timeout Issues

```
Error: Action timed out
```

**Fix**:
```yaml
- uses: anthropics/claude-code-action@v1
  timeout-minutes: 10  # Increase timeout
  with:
    max-tokens: 2048   # Reduce response size
```

### Large PRs

```
Error: Input too large
```

**Fix**:
```yaml
custom-prompt: |
  Review only files in src/components/
  Limit to security and critical issues
```

## Cost Estimation

Estimate costs for your CI/CD usage:

| Model | Cost per 1M tokens | Typical PR Review |
|-------|-------------------|-------------------|
| Sonnet | $3 (input) / $15 (output) | ~$0.10 - $0.50 |
| Haiku | $0.25 (input) / $1.25 (output) | ~$0.01 - $0.05 |

**Monthly estimates**:
- Small team (10 PRs/day): $50-150/month
- Medium team (50 PRs/day): $200-500/month
- Large team (200 PRs/day): $800-2000/month

Use Haiku for simple checks, Sonnet for critical reviews.

## Next Steps

- [GitHub Integration](/docs/claude-code-github-integration) - Interactive GitHub usage
- [Best Practices](/docs/claude-code-best-practices) - Effective CI/CD patterns
- [Hooks](/docs/claude-code-hooks) - Automate local git workflows
- [Security](/docs/claude-code-security) - Secure CI/CD practices

## Resources

- **GitHub Actions**: https://docs.github.com/actions
- **Action Marketplace**: https://github.com/marketplace
- **Workflow Syntax**: https://docs.github.com/actions/reference/workflow-syntax-for-github-actions
- **Cost Calculator**: Estimate usage costs

---

*GitHub Actions integration brings AI-powered code review and quality checks to every commit, ensuring consistent standards across your entire team.*
