# Attendance System Documentation

## Overview

The Hogwarts attendance system provides a comprehensive, multi-method approach to tracking student attendance with support for traditional manual entry and modern automated methods. The system is designed to be flexible, secure, and scalable for educational institutions of all sizes.

## Table of Contents

1. [System Architecture](#system-architecture)
2. [Available Methods](#available-methods)
3. [Quick Start Guide](#quick-start-guide)
4. [Method Guides](#method-guides)
5. [API Reference](#api-reference)
6. [Security & Privacy](#security--privacy)
7. [Best Practices](#best-practices)
8. [Troubleshooting](#troubleshooting)

## System Architecture

### Core Components

The attendance system is built with a modular architecture consisting of:

- **Core Infrastructure** (`/components/platform/attendance/core/`)
  - `attendance-context.tsx` - Global state management
  - `attendance-hub.tsx` - Central method selector interface
  - `attendance-stats.tsx` - Real-time statistics dashboard
  - `attendance-export.tsx` - Data export utilities

- **Shared Utilities** (`/components/platform/attendance/shared/`)
  - `types.ts` - TypeScript type definitions
  - `validation.ts` - Zod validation schemas
  - `utils.ts` - Helper functions
  - `hooks.ts` - React hooks for attendance operations

- **Method Implementations** (`/components/platform/attendance/[method]/`)
  - Each attendance method has its own directory with specialized components

### Database Schema

The system uses PostgreSQL with Prisma ORM and includes the following key models:

- **Attendance** - Core attendance records
- **StudentIdentifier** - Multi-method student identification
- **AttendanceDevice** - Device registry for hardware methods
- **AttendanceSession** - Time-based attendance tracking
- **AttendanceEvent** - Event logging and audit trail

## Available Methods

### 1. Manual Entry
Traditional teacher-driven attendance marking with keyboard shortcuts and bulk actions.

**Features:**
- Quick status selection (Present/Absent/Late)
- Keyboard shortcuts (P/A/L)
- Bulk mark all students
- Auto-save functionality

### 2. QR Code Scanning
Dynamic QR codes that refresh periodically for secure, contactless attendance.

**Features:**
- Time-limited codes (30-600 seconds)
- Anti-screenshot protection
- Location verification
- Proxy detection

### 3. Geofence (Location-Based)
Automatic attendance based on GPS location within defined zones.

**Features:**
- Multiple geofence types (circular/polygon)
- Real-time location tracking
- Battery optimization
- Offline queue support

### 4. Barcode Scanning
Student ID card scanning using device cameras.

**Features:**
- Multiple barcode formats (CODE128, EAN-13, QR)
- Batch scanning support
- Card management system

### 5. RFID Cards
Tap-based attendance using RFID readers.

**Features:**
- Multiple card types (125kHz, 13.56MHz)
- Fast bulk processing
- Card lifecycle management

### 6. NFC Tap
Near-field communication for mobile devices.

**Features:**
- < 1 second marking
- Encrypted tags
- Mobile app support

### 7. Bluetooth Proximity
Automatic detection via BLE beacons.

**Features:**
- Background scanning
- Multi-beacon support
- Distance calculation

### 8. Biometric Methods
Fingerprint and facial recognition.

**Features:**
- WebAuthn fingerprint support
- AI-powered face recognition
- Liveness detection
- Template encryption

### 9. Bulk Upload
CSV/Excel import for batch attendance.

**Features:**
- Multiple file formats
- Validation reports
- Error handling

## Quick Start Guide

### For Teachers

1. **Access the Attendance Hub**
   ```
   Navigate to: /attendance
   ```

2. **Select Your Preferred Method**
   - Click on any available method card
   - Methods with hardware requirements will show indicators

3. **Configure Settings**
   - Each method has specific configuration options
   - Access via the Settings button in each method view

4. **Start Marking Attendance**
   - Follow method-specific instructions
   - Monitor real-time statistics
   - Export data as needed

### For Students

1. **QR Code Attendance**
   - Open camera/scanner when teacher displays code
   - Scan within time limit
   - Wait for confirmation

2. **Geofence Attendance**
   - Enable location services
   - Enter designated area
   - Automatic marking when detected

3. **Card/Tag Methods**
   - Present your card/tag to reader
   - Wait for beep/confirmation
   - Check-in/out as required

## Method Guides

### QR Code Implementation

```typescript
// Generate QR Code (Teacher)
import { generateAttendanceQR } from '@/components/platform/attendance/qr-code/actions';

const result = await generateAttendanceQR({
  classId: 'class-123',
  validFor: 60, // seconds
  includeLocation: true
});

// Process QR Scan (Student)
import { processQRScan } from '@/components/platform/attendance/qr-code/actions';

const result = await processQRScan({
  code: qrData,
  scannedAt: new Date(),
  deviceId: navigator.userAgent,
  location: { lat: 0, lon: 0 }
});
```

### Geofence Setup

```typescript
// Create Geofence
const geofence = {
  name: 'Main Campus',
  type: 'SCHOOL_GROUNDS',
  shape: 'circle',
  center: { lat: 40.7128, lon: -74.0060 },
  radius: 200, // meters
  isActive: true
};

// Check Location
import { calculateDistance } from '@/components/platform/attendance/shared/utils';

const distance = calculateDistance(
  studentLat, studentLon,
  geofenceLat, geofenceLon
);
const isInside = distance <= radius;
```

### Biometric Integration

```typescript
// Fingerprint Authentication
const credential = await navigator.credentials.create({
  publicKey: {
    challenge: new Uint8Array(32),
    rp: { name: "Hogwarts School" },
    user: {
      id: new TextEncoder().encode(studentId),
      name: studentEmail,
      displayName: studentName
    },
    pubKeyCredParams: [{ alg: -7, type: "public-key" }],
    authenticatorSelection: {
      authenticatorAttachment: "platform",
      userVerification: "required"
    }
  }
});
```

## API Reference

### Core Actions

#### `markAttendance(record: AttendanceRecord)`
Marks attendance for a single student.

**Parameters:**
- `classId` - Class identifier
- `studentId` - Student identifier
- `status` - Attendance status
- `method` - Method used
- `checkInTime` - Optional check-in timestamp
- `location` - Optional GPS coordinates

**Returns:**
```typescript
{
  success: boolean;
  data?: AttendanceRecord;
  error?: string;
}
```

#### `fetchAttendance(filters: AttendanceFilters)`
Retrieves attendance records with filters.

**Parameters:**
- `classId` - Optional class filter
- `dateFrom` - Start date
- `dateTo` - End date
- `status` - Status filter(s)
- `method` - Method filter(s)

### Hooks

#### `useAttendance()`
Main hook for attendance operations.

```typescript
const {
  attendance,
  stats,
  loading,
  error,
  markAttendance,
  updateAttendance,
  fetchAttendance
} = useAttendance();
```

#### `useCamera()`
Camera access for scanning methods.

```typescript
const {
  hasPermission,
  stream,
  videoRef,
  requestPermission,
  stopCamera
} = useCamera();
```

#### `useGeolocation()`
Location services for geofence methods.

```typescript
const {
  location,
  error,
  loading,
  requestLocation,
  watchLocation
} = useGeolocation();
```

## Security & Privacy

### Data Protection

1. **Encryption**
   - All biometric templates are encrypted at rest
   - Location data is encrypted in transit
   - QR codes use time-based tokens

2. **Access Control**
   - Role-based permissions (Teacher/Student/Admin)
   - Method-specific permissions
   - Audit logging for all actions

3. **Privacy Compliance**
   - GDPR compliant data handling
   - Opt-in consent for biometrics
   - 30-day retention for location data
   - Right to deletion support

### Anti-Fraud Measures

1. **QR Code Security**
   - Dynamic generation with expiry
   - One-time use enforcement
   - IP tracking for proxy detection

2. **Location Verification**
   - Accuracy thresholds
   - Multiple location checks
   - Geofence boundary validation

3. **Biometric Security**
   - Liveness detection for face recognition
   - Template hashing (no raw biometrics stored)
   - Multi-factor options available

## Best Practices

### For Administrators

1. **Method Selection**
   - Choose methods based on infrastructure
   - Consider student device availability
   - Plan for fallback methods

2. **Configuration**
   - Set appropriate time thresholds
   - Configure location accuracy requirements
   - Enable audit logging

3. **Training**
   - Provide clear instructions to teachers
   - Create student guides
   - Test methods before deployment

### For Developers

1. **Code Organization**
   - Follow the mirror pattern for routes/components
   - Keep method implementations isolated
   - Use shared utilities for common functions

2. **Performance**
   - Implement lazy loading for methods
   - Use WebSocket for real-time updates
   - Cache frequently accessed data

3. **Testing**
   - Unit test each method independently
   - Integration test cross-method workflows
   - Load test for concurrent users

## Troubleshooting

### Common Issues

#### QR Code Not Scanning
- Check camera permissions
- Ensure adequate lighting
- Verify QR code hasn't expired
- Try manual code entry

#### Location Not Detected
- Enable GPS/Location services
- Check app permissions
- Move to open area for better signal
- Verify geofence configuration

#### Biometric Failures
- Re-enroll biometric template
- Clean sensor/camera
- Check device compatibility
- Use fallback method

#### Sync Issues
- Check network connectivity
- Verify server status
- Clear app cache
- Check offline queue

### Error Codes

| Code | Description | Solution |
|------|-------------|----------|
| `ATT-001` | Invalid QR code | Generate new code |
| `ATT-002` | Location required | Enable GPS |
| `ATT-003` | Device not registered | Register device |
| `ATT-004` | Biometric mismatch | Re-enroll template |
| `ATT-005` | Network timeout | Check connection |
| `ATT-006` | Permission denied | Check user role |
| `ATT-007` | Duplicate attendance | Already marked |
| `ATT-008` | Session expired | Re-authenticate |

### Support

For additional support:
- Technical issues: `tech-support@hogwarts.edu`
- Feature requests: Create GitHub issue
- Documentation updates: Submit PR

## Migration Guide

### From Manual to Automated Methods

1. **Phase 1: Preparation**
   - Audit current attendance data
   - Identify pilot classes
   - Procure necessary hardware

2. **Phase 2: Pilot Testing**
   - Deploy to select classes
   - Gather feedback
   - Refine configuration

3. **Phase 3: Rollout**
   - Gradual deployment
   - Maintain manual backup
   - Monitor adoption metrics

4. **Phase 4: Optimization**
   - Analyze usage patterns
   - Optimize method selection
   - Retire legacy systems

## Appendix

### Supported Hardware

#### RFID Readers
- ACR122U NFC Reader
- RC522 RFID Module
- PN532 NFC/RFID Controller

#### Fingerprint Scanners
- Windows Hello compatible devices
- Touch ID (macOS/iOS)
- Android Fingerprint API devices

#### BLE Beacons
- iBeacon compatible
- Eddystone beacons
- Nordic nRF series

### Performance Metrics

| Method | Processing Time | Accuracy | Concurrent Users |
|--------|----------------|----------|------------------|
| Manual | < 1s | 100% | Unlimited |
| QR Code | < 2s | 99.9% | 500+ |
| Geofence | < 5s | 95% | 1000+ |
| RFID | < 0.5s | 99.9% | 100/reader |
| Biometric | < 3s | 99.5% | 50/device |

### Roadmap

**Q1 2025**
- Voice recognition support
- AI-powered attendance predictions
- Enhanced analytics dashboard

**Q2 2025**
- Blockchain verification
- Cross-campus synchronization
- Mobile app v2.0

**Q3 2025**
- Integration with LMS platforms
- Advanced reporting templates
- Multi-language support expansion

---

*Last updated: October 2024*
*Version: 1.0.0*