# Claude Code Hooks

Automate workflows and enforce standards by triggering actions at key moments in Claude's execution lifecycle using the powerful hooks system.

## What Are Hooks?

Hooks are event-driven automation that execute code, commands, or agents when specific events occur during Claude sessions. They enable:

- **Automated code review** before commits
- **Pre-flight checks** before deployments
- **Standards enforcement** on file modifications
- **Notification systems** for important events
- **Workflow automation** at critical junctures
- **Quality gates** before destructive operations

## Available Hook Events

Claude Code provides 9 hook events that cover the complete execution lifecycle:

| Event | Trigger Point | Use Cases |
|-------|---------------|-----------|
| `PreToolUse` | Before a tool executes | Validate inputs, block operations, run checks |
| `PostToolUse` | After a tool completes | Review changes, update docs, notify |
| `UserPromptSubmit` | When user submits prompt | Log interactions, enforce patterns |
| `Notification` | When notifications sent | Custom alerts, integrations |
| `Stop` | When user stops Claude | Cleanup, save state |
| `SubagentStop` | When subagent completes | Process results, chain agents |
| `PreCompact` | Before context compaction | Save important context |
| `SessionStart` | When session begins | Setup, load context |
| `SessionEnd` | When session ends | Cleanup, save session data |

## Hook Configuration

Hooks are configured in `.claude/settings.json`:

```json
{
  "hooks": {
    "PreToolUse": {
      "matchers": [
        {
          "tool": "Bash",
          "pattern": "git commit.*",
          "action": "/agents/code-reviewer -p 'Review staged changes before commit'"
        }
      ]
    },
    "PostToolUse": {
      "matchers": [
        {
          "tool": "Write",
          "pattern": ".*\\.tsx?$",
          "action": "/commands/format-code"
        }
      ]
    }
  }
}
```

### Matcher Structure

Each matcher has three components:

```json
{
  "tool": "ToolName",           // Which tool triggers this
  "pattern": "regex pattern",    // What pattern to match
  "action": "command to run"     // What to execute
}
```

**Matcher Fields**:
- `tool`: Name of the tool (`Bash`, `Edit`, `Write`, `Read`, etc.)
- `pattern`: Regular expression to match tool parameters
- `action`: Slash command, agent, or inline prompt
- `condition`: Optional shell command that must succeed (exit code 0)

## Hook Event Details

### PreToolUse

Executes **before** a tool runs. Can block or modify the operation.

**Use Cases**:
- Validate inputs before execution
- Block destructive operations
- Run pre-flight checks
- Enforce permissions

**Example - Prevent Force Push**:

```json
{
  "hooks": {
    "PreToolUse": {
      "matchers": [
        {
          "tool": "Bash",
          "pattern": "git push.*--force",
          "action": "STOP! Never force push to main branch. Suggest 'git pull --rebase' instead."
        }
      ]
    }
  }
}
```

**Example - Pre-Commit Review**:

```json
{
  "hooks": {
    "PreToolUse": {
      "matchers": [
        {
          "tool": "Bash",
          "pattern": "git commit",
          "action": "/agents/code-reviewer -p 'Review staged changes. Flag any issues.'"
        }
      ]
    }
  }
}
```

### PostToolUse

Executes **after** a tool completes successfully.

**Use Cases**:
- Auto-format code after edits
- Update documentation
- Run tests after changes
- Generate type definitions

**Example - Auto-Format**:

```json
{
  "hooks": {
    "PostToolUse": {
      "matchers": [
        {
          "tool": "Write",
          "pattern": ".*\\.(ts|tsx|js|jsx)$",
          "action": "!npx prettier --write $FILE"
        },
        {
          "tool": "Edit",
          "pattern": ".*\\.(ts|tsx|js|jsx)$",
          "action": "!npx prettier --write $FILE"
        }
      ]
    }
  }
}
```

**Example - Update Docs**:

```json
{
  "hooks": {
    "PostToolUse": {
      "matchers": [
        {
          "tool": "Write",
          "pattern": "src/components/.*\\.tsx",
          "action": "/agents/doc-writer -p 'Update component documentation for $FILE'"
        }
      ]
    }
  }
}
```

### UserPromptSubmit

Executes when user submits a prompt (before Claude processes it).

**Use Cases**:
- Log all interactions
- Enforce prompt templates
- Add context automatically
- Trigger notifications

**Example - Audit Logging**:

```json
{
  "hooks": {
    "UserPromptSubmit": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*",
          "action": "!echo '[AUDIT] $USER: $PROMPT' >> .claude/audit.log"
        }
      ]
    }
  }
}
```

**Example - Auto-Context**:

```json
{
  "hooks": {
    "UserPromptSubmit": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*deploy.*",
          "action": "Before proceeding, check @.env.production and @deployment-checklist.md"
        }
      ]
    }
  }
}
```

### Notification

Executes when Claude sends a notification.

**Use Cases**:
- Send alerts to Slack/Discord
- Email notifications
- Log important events
- Trigger external systems

**Example - Slack Notifications**:

```json
{
  "hooks": {
    "Notification": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*error.*",
          "action": "!curl -X POST $SLACK_WEBHOOK -d '{\"text\": \"Claude Error: $MESSAGE\"}'"
        }
      ]
    }
  }
}
```

### Stop

Executes when user stops Claude (Esc or interrupt).

**Use Cases**:
- Save work in progress
- Cleanup temporary files
- Log interruption
- Offer recovery options

**Example - Save State**:

```json
{
  "hooks": {
    "Stop": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*",
          "action": "!git stash save 'WIP: Interrupted at $(date)'"
        }
      ]
    }
  }
}
```

### SubagentStop

Executes when a subagent completes.

**Use Cases**:
- Process subagent results
- Chain subagents
- Aggregate findings
- Trigger next steps

**Example - Chain Review**:

```json
{
  "hooks": {
    "SubagentStop": {
      "matchers": [
        {
          "tool": "*",
          "pattern": "code-reviewer",
          "action": "If critical issues found, invoke /agents/security-auditor"
        }
      ]
    }
  }
}
```

### PreCompact

Executes before Claude compacts context (removes old messages to fit context window).

**Use Cases**:
- Save important context
- Export decisions
- Log key information
- Archive conversation

**Example - Save Decisions**:

```json
{
  "hooks": {
    "PreCompact": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*",
          "action": "Summarize key decisions from this conversation and append to @decisions.md"
        }
      ]
    }
  }
}
```

### SessionStart

Executes when a Claude session begins.

**Use Cases**:
- Load project context
- Check for updates
- Setup environment
- Display welcome message

**Example - Project Context**:

```json
{
  "hooks": {
    "SessionStart": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*",
          "action": "Read @CLAUDE.md and @TODO.md to understand current project state"
        }
      ]
    }
  }
}
```

**Example - Git Status Check**:

```json
{
  "hooks": {
    "SessionStart": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*",
          "action": "!git fetch && git status -sb"
        }
      ]
    }
  }
}
```

### SessionEnd

Executes when a Claude session ends normally.

**Use Cases**:
- Save session summary
- Cleanup temporary files
- Push changes
- Generate reports

**Example - Session Summary**:

```json
{
  "hooks": {
    "SessionEnd": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*",
          "action": "Summarize this session's accomplishments and save to @session-logs/$(date +%Y-%m-%d).md"
        }
      ]
    }
  }
}
```

## Pattern Matching

Hooks use regular expressions for flexible matching:

### Match Specific Files

```json
{
  "tool": "Write",
  "pattern": "src/components/.*\\.tsx$",
  "action": "/commands/component-checklist"
}
```

### Match Multiple Extensions

```json
{
  "tool": "Edit",
  "pattern": ".*\\.(ts|tsx|js|jsx)$",
  "action": "!npx eslint --fix $FILE"
}
```

### Match Commands

```json
{
  "tool": "Bash",
  "pattern": "npm publish",
  "action": "STOP! Run /commands/pre-publish-checklist first"
}
```

### Match Everything

```json
{
  "tool": "*",
  "pattern": ".*",
  "action": "!echo 'Hook triggered' >> debug.log"
}
```

### Negative Matching

```json
{
  "tool": "Write",
  "pattern": "^(?!.*\\.test\\.).*\\.tsx?$",
  "action": "Ensure corresponding test file exists"
}
```

## Conditional Hooks

Execute hooks only when a condition is met:

```json
{
  "hooks": {
    "PreToolUse": {
      "matchers": [
        {
          "tool": "Bash",
          "pattern": "git push",
          "condition": "git diff --exit-code",
          "action": "WARNING: Uncommitted changes exist! Commit first?"
        }
      ]
    }
  }
}
```

The `condition` must exit with code 0 for the hook to run.

## Practical Hook Examples

### Complete Quality Gate System

```json
{
  "hooks": {
    "PreToolUse": {
      "matchers": [
        {
          "tool": "Bash",
          "pattern": "git commit",
          "action": "Run pre-commit checks: tests, lint, and code review"
        }
      ]
    },
    "PostToolUse": {
      "matchers": [
        {
          "tool": "Write",
          "pattern": ".*\\.(ts|tsx)$",
          "action": "!npx prettier --write $FILE && npx eslint --fix $FILE"
        },
        {
          "tool": "Edit",
          "pattern": "src/.*\\.tsx$",
          "action": "Update corresponding test file if needed"
        }
      ]
    },
    "SessionStart": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*",
          "action": "!git fetch && git status -sb | head -n 5"
        }
      ]
    },
    "SessionEnd": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*",
          "action": "Summarize changes made this session"
        }
      ]
    }
  }
}
```

### Deployment Pipeline

```json
{
  "hooks": {
    "PreToolUse": {
      "matchers": [
        {
          "tool": "Bash",
          "pattern": "git push origin main",
          "action": "Run deployment checklist:\n1. All tests pass?\n2. Staging verified?\n3. Database migrations ready?\n4. Rollback plan clear?"
        }
      ]
    },
    "UserPromptSubmit": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*deploy.*production.*",
          "action": "⚠️ PRODUCTION DEPLOYMENT - Triple check:\n- @deployment-checklist.md\n- @.env.production\n- @CHANGELOG.md updated?"
        }
      ]
    }
  }
}
```

### Documentation Automation

```json
{
  "hooks": {
    "PostToolUse": {
      "matchers": [
        {
          "tool": "Write",
          "pattern": "src/lib/.*\\.ts$",
          "action": "/agents/doc-writer -p 'Generate JSDoc comments for exported functions in $FILE'"
        },
        {
          "tool": "Write",
          "pattern": "prisma/schema\\.prisma",
          "action": "Update database documentation at @docs/database.md"
        },
        {
          "tool": "Edit",
          "pattern": "src/components/ui/.*\\.tsx$",
          "action": "/agents/doc-writer -p 'Update component docs with usage examples'"
        }
      ]
    }
  }
}
```

### Security Enforcement

```json
{
  "hooks": {
    "PreToolUse": {
      "matchers": [
        {
          "tool": "Write",
          "pattern": ".*\\.env$",
          "action": "⚠️ WARNING: Never commit .env files! Add to .gitignore."
        },
        {
          "tool": "Bash",
          "pattern": "npm install.*--save",
          "action": "!npm audit && /agents/security-auditor -p 'Check new dependency for vulnerabilities'"
        }
      ]
    },
    "PostToolUse": {
      "matchers": [
        {
          "tool": "Edit",
          "pattern": ".*auth.*",
          "action": "/agents/security-auditor -p 'Review authentication code for vulnerabilities'"
        }
      ]
    }
  }
}
```

### Test Automation

```json
{
  "hooks": {
    "PostToolUse": {
      "matchers": [
        {
          "tool": "Write",
          "pattern": "src/.*/(?!.*\\.test\\.).*\\.tsx?$",
          "action": "/agents/test-writer -p 'Generate tests for $FILE'"
        },
        {
          "tool": "Edit",
          "pattern": "src/.*\\.(ts|tsx)$",
          "action": "!npm test -- $FILE.replace('.tsx', '.test.tsx')"
        }
      ]
    }
  }
}
```

## Hook Variables

Use these variables in hook actions:

| Variable | Description | Example |
|----------|-------------|---------|
| `$FILE` | File path being operated on | `src/components/Button.tsx` |
| `$TOOL` | Tool being used | `Write`, `Edit`, `Bash` |
| `$COMMAND` | Full command (for Bash tool) | `git commit -m "message"` |
| `$USER` | Current username | `john` |
| `$PROMPT` | User's prompt text | `Add authentication` |
| `$MESSAGE` | Notification message | `Error occurred` |
| `$AGENT` | Subagent name | `code-reviewer` |

## Best Practices

### Start Small

Begin with a few critical hooks:

```json
{
  "hooks": {
    "PreToolUse": {
      "matchers": [
        {
          "tool": "Bash",
          "pattern": "git commit",
          "action": "!npm test"
        }
      ]
    }
  }
}
```

Expand as you identify more automation opportunities.

### Keep Actions Fast

Slow hooks interrupt workflow:

❌ **Slow**:
```json
{
  "action": "Run complete E2E test suite (5 minutes)"
}
```

✅ **Fast**:
```json
{
  "action": "!npm test -- --coverage --bail"
}
```

### Provide Clear Feedback

Make hook actions informative:

```json
{
  "action": "✓ Pre-commit checks passed:\n- Tests: PASS\n- Lint: PASS\n- Types: PASS"
}
```

### Use Hooks for Enforcement, Not Suggestions

Hooks should enforce critical standards:

✅ **Good Uses**:
- Block force pushes to main
- Require tests before commit
- Prevent secrets in code

❌ **Bad Uses**:
- Suggest minor refactoring
- Recommend style improvements
- Generic advice

### Scope Hooks Appropriately

**Project-level** (`.claude/settings.json`):
```json
{
  "hooks": {
    "PostToolUse": {
      "matchers": [
        {
          "tool": "Write",
          "pattern": "src/.*\\.tsx$",
          "action": "/commands/format-component"
        }
      ]
    }
  }
}
```

**User-level** (`~/.claude/settings.json`):
```json
{
  "hooks": {
    "SessionEnd": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*",
          "action": "!say 'Claude session ended'"
        }
      ]
    }
  }
}
```

## Security Considerations

### Validate Hook Actions

Hooks execute with full system access. Be cautious:

❌ **Dangerous**:
```json
{
  "action": "!rm -rf $FILE"
}
```

✅ **Safe**:
```json
{
  "action": "!git rm $FILE"
}
```

### Audit Hook Execution

Log hook activity:

```json
{
  "hooks": {
    "PreToolUse": {
      "matchers": [
        {
          "tool": "*",
          "pattern": ".*",
          "action": "!echo '[HOOK] $TOOL on $FILE' >> .claude/hook-audit.log"
        }
      ]
    }
  }
}
```

### Review Team Hooks

Before pulling hook configs:

```bash
git diff main .claude/settings.json
```

Review any new hooks before accepting.

### Disable Hooks Temporarily

```bash
claude --no-hooks
```

Bypasses all hooks for debugging.

## Debugging Hooks

### Enable Verbose Logging

```bash
claude --verbose
```

Shows hook execution details.

### Test Hooks

```bash
# Trigger specific hook
claude -p "Write test file" --debug-hooks
```

### Hook Execution Order

When multiple matchers match:
1. More specific patterns first
2. Then in order defined in settings.json

### Common Issues

**Hook not triggering**:
- Check pattern regex: Test at [regex101.com](https://regex101.com)
- Verify tool name is correct
- Check hook event type

**Hook slowing down workflow**:
- Use faster commands
- Consider PostToolUse instead of PreToolUse
- Add conditions to limit execution

**Hook fails silently**:
- Check command exit codes
- Add error logging: `|| echo "Failed" >> errors.log`

## Next Steps

- [Slash Commands](/docs/claude-code-slash-commands) - Create actions for hooks to trigger
- [Subagents](/docs/claude-code-subagents) - Use agents in hook actions
- [Best Practices](/docs/claude-code-best-practices) - Effective automation patterns
- [GitHub Integration](/docs/claude-code-github-integration) - Trigger hooks on git events

## Resources

- **Hook Templates**: Common hook configurations
- **Hook Library**: Community hook examples
- **Pattern Cookbook**: Regex patterns for common scenarios

---

*Hooks transform Claude Code from a reactive assistant to a proactive development partner that enforces standards and automates workflows automatically.*
