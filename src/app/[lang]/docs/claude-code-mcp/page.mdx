# Claude Code MCP Integration

Extend Claude's capabilities with the Model Context Protocol (MCP) - a universal standard for connecting AI assistants to external tools, data sources, and services.

## What is MCP?

The Model Context Protocol is an open standard that allows Claude to:

- **Access databases** (PostgreSQL, MySQL, MongoDB, etc.)
- **Query APIs** (GitHub, Linear, Jira, Slack, etc.)
- **Search the web** (Google, Brave, Exa, etc.)
- **Read documentation** (fetch and parse docs)
- **Execute specialized tools** (image processing, code analysis, etc.)
- **Connect to enterprise systems** (CRMs, ERPs, custom APIs)

**Think of MCP as USB for AI** - a standard protocol that works with any compatible tool.

## MCP Architecture

```
┌─────────────┐
│   Claude    │
│    Code     │
└─────┬───────┘
      │
      │ MCP Protocol
      │
┌─────▼───────────────────────────┐
│      MCP Servers                │
│  ┌────────┬────────┬────────┐  │
│  │Database│  APIs  │  Tools │  │
│  └────────┴────────┴────────┘  │
└─────────────────────────────────┘
```

**Components**:
- **MCP Client** (Claude Code) - Initiates requests
- **MCP Server** - Provides tools/resources
- **Transport** - HTTP, SSE, or stdio communication

## Installation Methods

MCP servers can be installed three ways:

### 1. HTTP Servers

Remote servers accessed via HTTP:

```json
{
  "mcp": {
    "servers": {
      "github": {
        "transport": "http",
        "url": "https://mcp.github.com",
        "headers": {
          "Authorization": "token YOUR_GITHUB_TOKEN"
        }
      }
    }
  }
}
```

### 2. SSE (Server-Sent Events)

Real-time streaming servers:

```json
{
  "mcp": {
    "servers": {
      "realtime-data": {
        "transport": "sse",
        "url": "https://api.example.com/mcp/stream"
      }
    }
  }
}
```

### 3. Stdio (Standard Input/Output)

Local processes communicating via stdin/stdout:

```json
{
  "mcp": {
    "servers": {
      "postgres": {
        "transport": "stdio",
        "command": "npx",
        "args": [
          "-y",
          "@modelcontextprotocol/server-postgres",
          "postgresql://localhost/mydb"
        ]
      }
    }
  }
}
```

**Most common for local development.**

## Configuration Scopes

Configure MCP servers at different levels:

### User-Level

`~/.claude/settings.json`:

```json
{
  "mcp": {
    "servers": {
      "github": {
        "transport": "http",
        "url": "https://mcp.github.com",
        "headers": {
          "Authorization": "token ${GITHUB_TOKEN}"
        }
      }
    }
  }
}
```

Available across all projects.

### Project-Level

`.claude/settings.json`:

```json
{
  "mcp": {
    "servers": {
      "project-db": {
        "transport": "stdio",
        "command": "npx",
        "args": ["-y", "@modelcontextprotocol/server-postgres", "${DATABASE_URL}"]
      }
    }
  }
}
```

Shared with team via git.

### Local Project

`.claude/settings.local.json`:

```json
{
  "mcp": {
    "servers": {
      "dev-db": {
        "transport": "stdio",
        "command": "npx",
        "args": ["-y", "@modelcontextprotocol/server-postgres", "postgresql://localhost/dev"]
      }
    }
  }
}
```

Personal, not committed to git.

## Popular MCP Servers

### Database Servers

#### PostgreSQL

```json
{
  "postgres": {
    "transport": "stdio",
    "command": "npx",
    "args": [
      "-y",
      "@modelcontextprotocol/server-postgres",
      "${DATABASE_URL}"
    ]
  }
}
```

**Capabilities**:
- Query database schema
- Execute SELECT queries
- Analyze query performance
- Suggest optimizations

#### SQLite

```json
{
  "sqlite": {
    "transport": "stdio",
    "command": "npx",
    "args": [
      "-y",
      "@modelcontextprotocol/server-sqlite",
      "./database.db"
    ]
  }
}
```

#### MySQL

```json
{
  "mysql": {
    "transport": "http",
    "url": "https://mcp-mysql.example.com",
    "headers": {
      "Authorization": "Bearer ${MYSQL_MCP_TOKEN}"
    }
  }
}
```

### API Integration Servers

#### GitHub

```json
{
  "github": {
    "transport": "http",
    "url": "https://mcp.github.com",
    "headers": {
      "Authorization": "token ${GITHUB_TOKEN}"
    }
  }
}
```

**Capabilities**:
- Create/update issues
- Create pull requests
- Review code
- Manage repositories
- Search code

#### Linear

```json
{
  "linear": {
    "transport": "http",
    "url": "https://mcp.linear.app",
    "headers": {
      "Authorization": "Bearer ${LINEAR_API_KEY}"
    }
  }
}
```

**Capabilities**:
- Create/update issues
- Manage projects
- Search issues
- Update status

#### Slack

```json
{
  "slack": {
    "transport": "http",
    "url": "https://mcp.slack.com",
    "headers": {
      "Authorization": "Bearer ${SLACK_BOT_TOKEN}"
    }
  }
}
```

**Capabilities**:
- Send messages
- Create channels
- Search messages
- Manage threads

### Search & Information

#### Brave Search

```json
{
  "brave": {
    "transport": "http",
    "url": "https://mcp-brave-search.example.com",
    "headers": {
      "X-Api-Key": "${BRAVE_API_KEY}"
    }
  }
}
```

#### Exa (Semantic Search)

```json
{
  "exa": {
    "transport": "http",
    "url": "https://mcp.exa.ai",
    "headers": {
      "Authorization": "Bearer ${EXA_API_KEY}"
    }
  }
}
```

#### Perplexity

```json
{
  "perplexity": {
    "transport": "http",
    "url": "https://mcp.perplexity.ai",
    "headers": {
      "Authorization": "Bearer ${PERPLEXITY_API_KEY}"
    }
  }
}
```

### Filesystem & Git

#### Filesystem Server

```json
{
  "filesystem": {
    "transport": "stdio",
    "command": "npx",
    "args": [
      "-y",
      "@modelcontextprotocol/server-filesystem",
      "/path/to/allowed/directory"
    ]
  }
}
```

**Capabilities**:
- Read files (with restrictions)
- Search directories
- Monitor changes

#### Git Server

```json
{
  "git": {
    "transport": "stdio",
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-git"]
  }
}
```

**Capabilities**:
- Advanced git operations
- Repository analysis
- Commit history search
- Branch management

### Specialized Tools

#### Puppeteer (Browser Automation)

```json
{
  "puppeteer": {
    "transport": "stdio",
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-puppeteer"]
  }
}
```

**Capabilities**:
- Screenshot websites
- Extract webpage content
- Automate browser tasks
- Test web applications

#### Memory Server

```json
{
  "memory": {
    "transport": "stdio",
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-memory"]
  }
}
```

**Capabilities**:
- Store conversation context
- Remember user preferences
- Persist information across sessions

## Management Commands

### List MCP Servers

```bash
claude /mcp list
```

Shows all configured servers and their status.

### Install MCP Server

```bash
claude /mcp install
```

Interactive installer for popular MCP servers.

### Test MCP Server

```bash
claude /mcp test postgres
```

Verifies server connection and tools.

### Remove MCP Server

```bash
claude /mcp remove postgres
```

Removes server from configuration.

### Update MCP Servers

```bash
claude /mcp update
```

Updates all stdio-based MCP servers to latest versions.

## Authentication

### Environment Variables (Recommended)

Use environment variables for secrets:

```json
{
  "github": {
    "transport": "http",
    "url": "https://mcp.github.com",
    "headers": {
      "Authorization": "token ${GITHUB_TOKEN}"
    }
  }
}
```

Set in `.env`:

```bash
GITHUB_TOKEN=your-token-here
DATABASE_URL=postgresql://localhost/mydb
SLACK_BOT_TOKEN=xoxb-your-token
```

### Credential Helpers

For secure credential storage:

```json
{
  "postgres": {
    "transport": "stdio",
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-postgres"],
    "env": {
      "DATABASE_URL": "$(security find-generic-password -s postgres-url -w)"
    }
  }
}
```

### OAuth Flows

Some MCP servers support OAuth:

```bash
claude /mcp auth github
```

Opens browser for OAuth flow.

## Using MCP Tools

Once configured, Claude can use MCP tools automatically:

### Database Queries

```
You: "What are the top 10 users by post count?"

Claude: I'll query the database...
[Uses postgres MCP server]
[Executes: SELECT users.name, COUNT(posts.id)...]

Claude: Here are the top 10 users:
1. Alice - 245 posts
2. Bob - 198 posts
...
```

### GitHub Operations

```
You: "Create an issue for the bug we just found"

Claude: I'll create a GitHub issue...
[Uses github MCP server]
[Creates issue with title, description, labels]

Claude: Issue #123 created: "Fix authentication bug"
https://github.com/user/repo/issues/123
```

### Web Search

```
You: "Find the latest React best practices"

Claude: Searching the web...
[Uses brave MCP server]
[Searches for "React best practices 2025"]

Claude: Based on recent articles, here are the key practices...
```

## Advanced Configuration

### Custom Headers

```json
{
  "custom-api": {
    "transport": "http",
    "url": "https://api.example.com/mcp",
    "headers": {
      "Authorization": "Bearer ${API_TOKEN}",
      "X-Custom-Header": "value",
      "User-Agent": "Claude-Code/1.0"
    }
  }
}
```

### Timeout Configuration

```json
{
  "slow-api": {
    "transport": "http",
    "url": "https://slow-api.example.com",
    "timeout": 60000
  }
}
```

### Retry Configuration

```json
{
  "unreliable-api": {
    "transport": "http",
    "url": "https://api.example.com",
    "retries": 3,
    "retryDelay": 1000
  }
}
```

### Environment-Specific Configs

Use different MCP servers per environment:

**Development** (`.claude/settings.local.json`):
```json
{
  "mcp": {
    "servers": {
      "db": {
        "transport": "stdio",
        "command": "npx",
        "args": ["-y", "@modelcontextprotocol/server-postgres", "postgresql://localhost/dev"]
      }
    }
  }
}
```

**Production** (`.claude/settings.json`):
```json
{
  "mcp": {
    "servers": {
      "db": {
        "transport": "stdio",
        "command": "npx",
        "args": ["-y", "@modelcontextprotocol/server-postgres", "${DATABASE_URL}"]
      }
    }
  }
}
```

## Enterprise Configuration

### Self-Hosted MCP Servers

```json
{
  "internal-api": {
    "transport": "http",
    "url": "https://mcp.internal.company.com",
    "headers": {
      "Authorization": "Bearer ${INTERNAL_API_TOKEN}"
    },
    "tls": {
      "cert": "/path/to/cert.pem",
      "key": "/path/to/key.pem",
      "ca": "/path/to/ca.pem"
    }
  }
}
```

### Proxy Configuration

```json
{
  "external-api": {
    "transport": "http",
    "url": "https://api.external.com",
    "proxy": {
      "host": "proxy.company.com",
      "port": 8080,
      "auth": {
        "username": "${PROXY_USER}",
        "password": "${PROXY_PASS}"
      }
    }
  }
}
```

### Network Policies

Restrict MCP server access:

```json
{
  "mcp": {
    "allowedDomains": [
      "mcp.github.com",
      "mcp.linear.app",
      "*.company.com"
    ],
    "blockedDomains": [
      "*.untrusted.com"
    ]
  }
}
```

## Building Custom MCP Servers

### Server Structure

```typescript
// server.ts
import { MCPServer } from '@modelcontextprotocol/sdk';

const server = new MCPServer({
  name: 'my-custom-server',
  version: '1.0.0',
  description: 'Custom MCP server for X'
});

// Add tools
server.addTool({
  name: 'get_data',
  description: 'Fetch data from custom API',
  parameters: {
    type: 'object',
    properties: {
      id: { type: 'string', description: 'Resource ID' }
    },
    required: ['id']
  },
  handler: async ({ id }) => {
    // Fetch and return data
    return { data: await fetchData(id) };
  }
});

// Start server
server.listen('stdio');
```

### Publishing

```bash
npm publish
```

### Using Custom Server

```json
{
  "custom": {
    "transport": "stdio",
    "command": "npx",
    "args": ["-y", "your-custom-mcp-server"]
  }
}
```

## Best Practices

### Scope MCP Servers Appropriately

**User-level**: Personal tools (GitHub, Gmail, etc.)
**Project-level**: Project databases, APIs
**Local**: Development-only servers

### Use Environment Variables

Never hardcode secrets:

❌ **Bad**:
```json
{
  "headers": {
    "Authorization": "token ghp_abc123..."
  }
}
```

✅ **Good**:
```json
{
  "headers": {
    "Authorization": "token ${GITHUB_TOKEN}"
  }
}
```

### Test MCP Servers Before Using

```bash
claude /mcp test your-server
```

Verify connectivity before relying on the server.

### Monitor MCP Usage

Enable logging:

```json
{
  "mcp": {
    "logging": {
      "level": "info",
      "file": ".claude/mcp.log"
    }
  }
}
```

### Handle Failures Gracefully

MCP servers can fail. Claude will notify you and continue without them.

## Troubleshooting

### Server Not Found

```
Error: MCP server 'postgres' not found
```

**Fix**: Verify configuration in settings.json

### Connection Failed

```
Error: Failed to connect to MCP server
```

**Fix**:
1. Check server is running
2. Verify URL/command is correct
3. Test network connectivity
4. Check authentication

### Tool Not Working

```
Error: Tool 'query_database' failed
```

**Fix**:
1. Check tool parameters
2. Verify permissions
3. Review server logs
4. Test with `/mcp test`

### Slow Response

```
MCP request timed out
```

**Fix**:
1. Increase timeout in config
2. Optimize query/request
3. Check network latency
4. Consider caching

### Debug Mode

```bash
claude --debug-mcp
```

Shows detailed MCP communication.

## Security Considerations

### Trust MCP Servers

Only use MCP servers from trusted sources. They have access to:
- Your data
- Your credentials
- Your system resources

### Review Permissions

Check what tools each server provides:

```bash
claude /mcp info postgres
```

### Network Security

For HTTP/SSE servers:
- Use HTTPS only
- Verify certificates
- Use VPN for internal servers

### Audit MCP Activity

Enable logging to track MCP usage:

```json
{
  "mcp": {
    "audit": {
      "enabled": true,
      "file": ".claude/mcp-audit.log"
    }
  }
}
```

## Next Steps

- [Plugins](/docs/claude-code-plugins) - Install MCP servers via plugins
- [Configuration](/docs/claude-code-configuration) - Detailed config options
- [Best Practices](/docs/claude-code-best-practices) - Effective MCP usage
- [Security](/docs/claude-code-security) - MCP security guidelines

## Resources

- **MCP Registry**: Browse available MCP servers
- **MCP Specification**: Protocol documentation
- **Server Development**: Build custom MCP servers
- **Community Servers**: Third-party MCP servers

---

*MCP transforms Claude Code from a local assistant to a globally connected development platform with access to any tool or service you need.*
