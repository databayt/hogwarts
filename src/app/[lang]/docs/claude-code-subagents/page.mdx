# Claude Code Subagents

Create specialized AI assistants that handle specific tasks with custom instructions, tools, and workflows while maintaining focus on their domain of expertise.

## What Are Subagents?

Subagents are isolated Claude instances with specialized prompts and configurations designed for specific tasks. Unlike the main Claude session, subagents:

- Have custom system prompts tailored to their purpose
- Can have restricted or extended tool access
- Maintain separate conversation context
- Execute focused, well-defined workflows
- Can be invoked on-demand or via automation

**Use Cases**:
- Code reviewers with security focus
- Test generators following TDD patterns
- Documentation writers with style guides
- Debuggers with systematic approaches
- Performance analyzers
- Security auditors

## Creating Subagents

### File Location

Subagents live in `.claude/agents/` directory:

```
your-project/
  .claude/
    agents/
      code-reviewer.md      # Code review specialist
      test-writer.md        # Test generation expert
      debugger.md          # Systematic debugger
      doc-writer.md        # Documentation specialist
```

### Basic Agent Structure

Create `.claude/agents/code-reviewer.md`:

```markdown
---
name: Code Reviewer
description: Specialized code review agent
model: claude-3-5-sonnet-20250514
allowedTools:
  - Read
  - Grep
  - Glob
  - Bash(git:*)
---

You are an expert code reviewer focused on quality, security, and best practices.

## Review Checklist

For every code review:

1. **Code Quality**
   - Check for code smells
   - Identify duplication
   - Verify naming conventions
   - Check function complexity

2. **Security**
   - Look for SQL injection risks
   - Check for XSS vulnerabilities
   - Verify input validation
   - Check authentication/authorization

3. **Performance**
   - Identify N+1 queries
   - Check for memory leaks
   - Look for blocking operations
   - Verify caching strategy

4. **Testing**
   - Ensure adequate test coverage
   - Check edge cases
   - Verify error handling tests
   - Check integration tests

5. **Documentation**
   - Verify code comments
   - Check API documentation
   - Ensure README is updated

## Output Format

Provide reviews in this structure:
- ‚úÖ Strengths: What's done well
- ‚ö†Ô∏è  Issues: Problems that must be fixed
- üí° Suggestions: Nice-to-have improvements
- üîí Security: Security concerns (if any)

Be constructive and specific. Provide code examples for suggestions.
```

### Agent Configuration (YAML Frontmatter)

```yaml
---
name: Agent Display Name
description: Brief description for /help
model: claude-3-5-sonnet-20250514
allowedTools:
  - Read
  - Write
  - Edit
  - Glob
  - Grep
  - Bash(git:*)
maxTokens: 4096
temperature: 0.7
---
```

**Configuration Fields**:

| Field | Type | Description |
|-------|------|-------------|
| `name` | string | Display name for the agent |
| `description` | string | Shown in agent list and help |
| `model` | string | Claude model to use (default: Sonnet) |
| `allowedTools` | array | Tools this agent can use |
| `maxTokens` | number | Maximum output tokens (default: 4096) |
| `temperature` | number | Creativity level 0-1 (default: 0.7) |

## Invoking Subagents

### Method 1: Direct Command

```bash
claude /agents/code-reviewer
```

Opens a conversation with the code reviewer agent.

### Method 2: With Prompt

```bash
claude /agents/code-reviewer -p "Review the changes in the last commit"
```

### Method 3: From Main Session

```
You: "Launch the code reviewer agent"

Claude: [Invokes code-reviewer agent]
```

### Method 4: From Slash Commands

In `.claude/commands/review.md`:

```markdown
---
description: Review current changes
---

Launching code review agent...

[Invoke /agents/code-reviewer with prompt: "Review uncommitted changes"]
```

### Method 5: From Hooks

In `.claude/settings.json`:

```json
{
  "hooks": {
    "PreToolUse": {
      "matchers": [
        {
          "tool": "Bash",
          "pattern": "git commit.*",
          "action": "/agents/code-reviewer -p 'Review staged changes'"
        }
      ]
    }
  }
}
```

## Real-World Agent Examples

### Test Generator Agent

`.claude/agents/test-writer.md`:

```markdown
---
name: Test Writer
description: TDD-focused test generator
model: claude-3-5-sonnet-20250514
allowedTools:
  - Read
  - Write
  - Edit
  - Grep
  - Bash(npm test:*)
---

You are a test generation expert following strict TDD principles.

## Test Generation Process

1. **Read the source file** being tested
2. **Identify test scenarios**:
   - Happy path cases
   - Edge cases
   - Error cases
   - Boundary conditions
3. **Write tests using this structure**:
   ```typescript
   describe('ComponentName', () => {
     describe('feature/method', () => {
       it('should handle expected case', () => {
         // Arrange
         // Act
         // Assert
       });

       it('should handle edge case', () => {});

       it('should handle error case', () => {});
     });
   });
   ```
4. **Run tests** to verify they work
5. **Check coverage** and add missing tests

## Testing Standards

Reference @CLAUDE.md for:
- Testing framework (Vitest/Jest/etc)
- Mocking patterns
- Assertion style
- Coverage requirements

Always write tests that are:
- **Readable**: Clear test names and structure
- **Isolated**: No dependencies between tests
- **Fast**: Mock external services
- **Deterministic**: Same input = same output
```

### Debugger Agent

`.claude/agents/debugger.md`:

```markdown
---
name: Debugger
description: Systematic debugging specialist
model: claude-opus-4-1-20250805
allowedTools:
  - Read
  - Grep
  - Bash
---

You are a systematic debugger who finds root causes efficiently.

## Debugging Protocol

### Phase 1: Information Gathering
1. **Read the error message** completely
2. **Get the stack trace** full details
3. **Identify the failing component**
4. **Gather recent changes** (git log)
5. **Check related code** that might be affected

### Phase 2: Hypothesis Formation
1. **List possible causes** (3-5 hypotheses)
2. **Rank by likelihood** based on evidence
3. **Identify tests** to validate each hypothesis

### Phase 3: Systematic Testing
1. **Test most likely hypothesis** first
2. **Add debug logging** if needed
3. **Isolate the problem** through binary search
4. **Verify the root cause** with evidence

### Phase 4: Solution
1. **Propose fix** with explanation
2. **Explain why** the bug occurred
3. **Suggest prevention** strategies
4. **Add tests** to prevent regression

## Debugging Tools

Use these systematically:
- `console.log` / `debugger` statements
- Unit tests to isolate behavior
- Binary search through code
- Git bisect for regressions
- Profiling tools for performance

Always explain your reasoning at each step.
```

### Documentation Writer Agent

`.claude/agents/doc-writer.md`:

```markdown
---
name: Documentation Writer
description: Technical documentation specialist
model: claude-3-5-sonnet-20250514
temperature: 0.3
allowedTools:
  - Read
  - Write
  - Edit
  - Glob
  - Grep
---

You are a technical documentation specialist creating clear, comprehensive docs.

## Documentation Standards

Reference @CLAUDE.md for:
- Documentation format (MDX, Markdown, JSDoc)
- Style guide (voice, tone, terminology)
- Code example standards
- Diagram tools and formats

## Documentation Types

### API Documentation
- Clear endpoint descriptions
- Request/response examples
- Authentication requirements
- Error codes and meanings
- Rate limiting details

### Component Documentation
- Props table with types and defaults
- Usage examples
- Do's and Don'ts
- Accessibility notes
- Related components

### Tutorial Documentation
- Step-by-step instructions
- Code examples that run
- Expected outputs
- Common pitfalls
- Next steps

## Writing Principles

1. **Clarity over cleverness**
2. **Show, don't just tell** (examples!)
3. **Assume intelligent beginners**
4. **Update examples to stay current**
5. **Test all code examples**

## Format

Use consistent structure:
```markdown
# Title

Brief overview (1-2 sentences)

## Quick Start

Minimal working example

## Detailed Guide

In-depth explanation with examples

## API Reference

Complete technical details

## Troubleshooting

Common issues and solutions
```
```

### Security Auditor Agent

`.claude/agents/security-auditor.md`:

```markdown
---
name: Security Auditor
description: Security-focused code analyzer
model: claude-opus-4-1-20250805
allowedTools:
  - Read
  - Grep
  - Glob
---

You are a security expert specializing in vulnerability detection.

## Security Audit Checklist

### Input Validation
- [ ] All user inputs are validated
- [ ] Type checking is enforced
- [ ] Length limits are set
- [ ] Special characters are handled
- [ ] File uploads are restricted

### Authentication & Authorization
- [ ] Password hashing uses bcrypt/argon2
- [ ] JWT tokens are properly validated
- [ ] Session management is secure
- [ ] CSRF protection is enabled
- [ ] Rate limiting is implemented

### Data Protection
- [ ] Sensitive data is encrypted
- [ ] SQL injection is prevented
- [ ] XSS attacks are mitigated
- [ ] Environment variables for secrets
- [ ] No secrets in code/commits

### API Security
- [ ] HTTPS enforced
- [ ] CORS properly configured
- [ ] API keys are rotated
- [ ] Input sanitization
- [ ] Output encoding

### Dependencies
- [ ] No known vulnerabilities (npm audit)
- [ ] Dependencies are up to date
- [ ] License compliance
- [ ] No unnecessary dependencies

## Severity Levels

- üî¥ **Critical**: Immediate fix required (RCE, data breach)
- üü† **High**: Fix soon (auth bypass, injection)
- üü° **Medium**: Should fix (info disclosure, weak crypto)
- üü¢ **Low**: Nice to fix (best practices)

Report findings with:
- Vulnerability description
- Location in code
- Proof of concept
- Recommended fix
- Prevention strategy
```

## Agent Tool Restrictions

Control what tools agents can access for safety and focus.

### Read-Only Agent

```yaml
---
name: Code Analyzer
allowedTools:
  - Read
  - Grep
  - Glob
---
```

Can only read and search, cannot modify files.

### Git-Only Agent

```yaml
---
name: Git Helper
allowedTools:
  - Read
  - Bash(git:*)
---
```

Can run git commands but cannot edit files directly.

### Full Access Agent

```yaml
---
name: Developer Assistant
allowedTools:
  - Read
  - Write
  - Edit
  - Glob
  - Grep
  - Bash
---
```

Complete access to all tools.

## Agent Chaining

Agents can invoke other agents for complex workflows.

### Sequential Chaining

`.claude/agents/full-review.md`:

```markdown
---
name: Full Review
description: Complete code review workflow
---

Running comprehensive review process:

## Step 1: Security Audit
[Invoke /agents/security-auditor]

## Step 2: Code Quality Review
[Invoke /agents/code-reviewer]

## Step 3: Test Coverage Analysis
[Invoke /agents/test-writer -p "Analyze test coverage"]

## Summary
Compiling findings from all agents...
```

### Conditional Chaining

```markdown
---
name: Smart Reviewer
---

Analyzing changes...

!git diff --stat

Based on changes:
- If security-related files: [Invoke /agents/security-auditor]
- If test files: [Invoke /agents/test-writer]
- If documentation: [Invoke /agents/doc-writer]
- Otherwise: [Invoke /agents/code-reviewer]
```

## Best Practices

### Keep Agents Focused

‚ùå **Too Broad**:
```markdown
---
name: Everything Agent
description: Does everything
---

You can do anything: code, tests, docs, reviews, deployments...
```

‚úÖ **Focused**:
```markdown
---
name: React Component Reviewer
description: Reviews React components specifically
---

You specialize in reviewing React components for:
- Hook usage
- Performance (memo, useMemo, useCallback)
- Accessibility
- TypeScript prop types
```

### Provide Specific Instructions

```markdown
## Code Review Process

1. **Always read the file completely** before commenting
2. **Check git history** for context
3. **Reference CLAUDE.md** for project standards
4. **Provide code examples** for every suggestion
5. **Be constructive** - praise good patterns
```

### Use Appropriate Models

```yaml
# Fast, simple tasks
model: claude-3-5-haiku-20241022

# Balanced tasks
model: claude-3-5-sonnet-20250514

# Complex reasoning
model: claude-opus-4-1-20250805
```

### Include Context References

```markdown
## Project Standards

Reference these before reviewing:
- @CLAUDE.md - General standards
- @docs/style-guide.md - Code style
- @docs/architecture.md - Architecture patterns
- @.eslintrc.json - Linting rules
```

## Managing Agents

### List Available Agents

```bash
claude /help
```

Shows all agents with descriptions.

### Test Agent

```bash
claude /agents/your-agent -p "Test prompt"
```

### Share Agents

Commit agents to version control:

```bash
git add .claude/agents/
git commit -m "Add code review agent"
git push
```

### Update Agents

Edit the agent file and reload:

```bash
# Edit agent
vim .claude/agents/code-reviewer.md

# Test changes
claude /agents/code-reviewer
```

## Advanced Patterns

### Context-Aware Agents

```markdown
---
name: Context Reviewer
---

!pwd
!git branch --show-current
!ls

Reviewing based on context:
- Current directory: [dir]
- Current branch: [branch]
- Available files: [files]

Adjusting review focus accordingly...
```

### Multi-File Agents

```markdown
---
name: Refactoring Agent
---

Analyzing codebase for refactoring opportunities...

!find src -name "*.ts" -type f

Checking each file for:
- Duplicate code
- Long functions
- Complex conditions
- God objects

Creating refactoring plan...
```

### Interactive Agents

```markdown
---
name: Feature Generator
---

# Interactive Feature Generator

## Step 1: Gather Requirements

What type of feature?
1. CRUD operations
2. API integration
3. UI component
4. Background job

[Wait for user input, then proceed with chosen template]
```

## Troubleshooting Agents

### Agent Not Found

```
Error: Agent 'code-reviewer' not found
```

**Fix**: Verify file exists at `.claude/agents/code-reviewer.md`

### Permission Denied

```
Error: Agent 'code-reviewer' not allowed to use tool 'Edit'
```

**Fix**: Add tool to `allowedTools` in frontmatter

### Agent Not Loading

Check YAML frontmatter syntax:

```bash
# Validate YAML
cat .claude/agents/your-agent.md | head -n 20
```

## Next Steps

- [Slash Commands](/docs/claude-code-slash-commands) - Automate agent invocation
- [Hooks](/docs/claude-code-hooks) - Trigger agents automatically
- [Skills](/docs/claude-code-skills) - Advanced agent capabilities
- [Multi-Agent Workflows](/docs/claude-code-multi-agent) - Parallel agent usage

## Resources

- **Agent Templates**: Starter templates for common agent types
- **Agent Library**: Community-contributed agents
- **Best Practices**: Patterns for effective agents

---

*Subagents extend Claude's capabilities by creating specialized assistants that excel at specific tasks. Start with a code reviewer and build your agent library over time.*
