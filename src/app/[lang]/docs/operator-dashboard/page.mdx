# Operator Dashboard

## Overview

The dashboard component provides real-time analytics and metrics visualization for the Hogwarts SaaS platform operators. It displays key performance indicators, usage trends, financial metrics, and system health status in a data-rich interface.

## Architecture

### Component Structure
The dashboard follows a modular architecture with separate components for different visualization types:

- **content.tsx** - Main server component composition
- **metrics-cards.tsx** - KPI cards grid
- **bar-graph.tsx** - Bar chart for comparisons
- **area-graph.tsx** - Area chart for trends
- **pie-graph.tsx** - Pie chart for distributions
- **recent-sales.tsx** - Recent transactions list
- **period-switcher.tsx** - Time period selector

### Data Flow
The dashboard implements parallel data fetching for optimal performance:

1. Page route initiates dashboard load
2. Parallel database queries fetch metrics
3. Data distributed to respective components
4. Charts and cards render with loaded data
5. Period switcher filters apply to all components

## Key Metrics

### School Metrics
- Total Schools - Complete count of registered schools
- Active Schools - Schools with active subscriptions
- Trial Schools - Schools in trial period
- Paid Schools - Schools on paid plans

### User Metrics
- Total Users - All platform users
- Active Users - Users logged in last 30 days
- New Users - Registrations in current period
- User Growth - Percentage change over previous period

### Financial Metrics
- Monthly Recurring Revenue (MRR)
- Annual Recurring Revenue (ARR)
- Average Revenue Per User (ARPU)
- Customer Lifetime Value (CLV)

### Usage Metrics
- Total Students - Across all schools
- API Calls - Platform API usage
- Storage Used - File storage consumption
- Bandwidth - Data transfer metrics

## Chart Components

### Bar Graph
Displays comparative metrics across time periods with interactive features:

- Monthly revenue comparison
- School growth trends
- User acquisition rates
- Feature usage statistics

### Area Graph
Shows trend data over time with gradient visualization:

- Revenue growth trajectory
- User engagement trends
- Platform usage patterns
- Performance metrics

### Pie Graph
Represents distribution of categorical data:

- School distribution by plan
- User roles breakdown
- Geographic distribution
- Feature adoption rates

## Period Switching

The dashboard supports multiple time period views:

- **Last 24 hours** - Real-time monitoring
- **Last 7 days** - Weekly overview
- **Last 30 days** - Monthly summary
- **Last 3 months** - Quarterly review
- **Last 12 months** - Annual analysis
- **Custom range** - Specific date selection

## Data Fetching

### Parallel Queries
```typescript
const [totalSchools, activeSchools, totalUsers, totalStudents] = await Promise.all([
  db.school.count(),
  db.school.count({ where: { isActive: true } }),
  db.user.count(),
  db.student.count(),
]);
```

### Aggregation Queries
Efficient database aggregations for performance:

```typescript
async function getSchoolMetrics() {
  const [total, active, trial, paid] = await db.$transaction([
    db.school.count(),
    db.school.count({ where: { isActive: true } }),
    db.school.count({ where: { planType: 'TRIAL' } }),
    db.school.count({ where: { planType: { in: ['BASIC', 'PREMIUM'] } } })
  ]);
  return { total, active, trial, paid };
}
```

## Performance Optimization

### Caching Strategy
- Metrics cached for 1 minute
- Chart data cached for 5 minutes
- Recent sales cached for 30 seconds

### Query Optimization
- Indexed database columns
- Parallel query execution
- Aggregation at database level
- Limited result sets

### Component Optimization
- Lazy loading for charts
- Memoized calculations
- Virtual scrolling for lists
- Progressive data loading

## Real-Time Updates

### WebSocket Integration
Real-time metric updates via WebSocket connection:

```typescript
ws.on('metrics:update', (data) => {
  updateMetrics(data);
});

ws.on('sales:new', (sale) => {
  addRecentSale(sale);
});
```

### Server-Sent Events
Alternative SSE implementation for environments without WebSocket support.

## Configuration

### Environment Variables
```bash
# Dashboard Configuration
DASHBOARD_REFRESH_INTERVAL=60000
DEFAULT_DASHBOARD_PERIOD=week
ENABLE_REALTIME_UPDATES=true

# Chart Configuration
CHART_ANIMATION_DURATION=750
MAX_CHART_DATA_POINTS=100

# Performance
ENABLE_DASHBOARD_CACHE=true
DASHBOARD_CACHE_TTL=60
```

## Accessibility

- Keyboard navigation for all interactive elements
- Screen reader support with ARIA labels
- WCAG AAA compliant color contrast
- Alternative text representations of charts
- Clear focus indicators
- Reduced motion support

## Mobile Optimization

- Responsive grid layout
- Touch gesture support
- Simplified visualizations
- Progressive loading
- Offline data caching

## Testing

### Unit Tests
Test coverage includes:

- Data aggregation accuracy
- Chart rendering validation
- Period switching functionality
- Metric calculations
- Loading states
- Error boundaries

### Example Test
```typescript
describe('Dashboard Metrics', () => {
  it('should calculate growth percentage correctly', () => {
    const current = 150;
    const previous = 100;
    const growth = calculateGrowth(current, previous);
    expect(growth).toBe(50);
  });
});
```

## Monitoring

### Key Metrics
- Page load time
- Data fetch duration
- Chart render performance
- WebSocket stability
- Cache hit ratio

### Alert Configuration
- Dashboard load time > 3s
- Real-time update lag > 5s
- Chart render failures
- Database query timeout

## Future Enhancements

1. **Custom Dashboards** - User-configurable widget layouts
2. **Advanced Analytics** - Predictive trends and anomaly detection
3. **Export Capabilities** - PDF/PNG export functionality
4. **Drill-Down Reports** - Click-through to detailed views
5. **Comparison Mode** - Side-by-side period comparisons
6. **AI Insights** - Automated recommendations
7. **Alerting System** - Threshold-based notifications
8. **Multi-Display Support** - TV/Wall display mode

## Related Documentation

- [Metrics Configuration](/docs/operator/metrics)
- [Analytics System](/docs/operator/analytics)
- [Data Fetching Patterns](/docs/developers/data-fetching)
- [Performance Monitoring](/docs/operator/observability)