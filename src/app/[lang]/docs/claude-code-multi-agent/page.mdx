# Claude Code Multi-Agent Workflows

Scale your development with parallel Claude instances working on different tasks simultaneously using multi-agent workflows and git worktrees.

## What Are Multi-Agent Workflows?

Multi-agent workflows involve running multiple Claude Code instances in parallel, each focused on different tasks or perspectives:

- **Parallel Development**: Work on features simultaneously
- **Separation of Concerns**: Different agents for different domains
- **Code Review**: One writes, one reviews
- **Experimentation**: Try multiple approaches in parallel
- **Team Simulation**: Simulate different team member perspectives

**Key Benefit**: Accomplish more in less time by leveraging parallel execution.

## Use Cases

### 1. Parallel Feature Development

Work on multiple features simultaneously:

```
Terminal 1: Frontend development
Terminal 2: Backend API development
Terminal 3: Database migrations
Terminal 4: Test writing
```

### 2. Write-Review Pattern

One agent writes code, another reviews it:

```
Terminal 1 (Developer): Implements feature
Terminal 2 (Reviewer): Reviews changes for quality, security, performance
```

### 3. Multi-Approach Exploration

Try different implementations in parallel:

```
Terminal 1: Implement using approach A
Terminal 2: Implement using approach B
Terminal 3: Implement using approach C

Compare results and choose the best
```

### 4. Domain Separation

Separate agents by domain expertise:

```
Terminal 1: Frontend specialist
Terminal 2: Backend specialist
Terminal 3: Database specialist
Terminal 4: DevOps specialist
```

## Git Worktrees

Git worktrees enable parallel work on different branches without constant checkout switching.

### What Are Worktrees?

A worktree is a separate working directory linked to your git repository:

```
main-repo/           # Main worktree (main branch)
main-repo-feature/   # Worktree for feature branch
main-repo-hotfix/    # Worktree for hotfix branch
```

Each worktree can have a different branch checked out simultaneously.

### Creating Worktrees

#### Basic Worktree

```bash
# From main repository
git worktree add ../project-feature feature/authentication

# This creates:
# - New directory ../project-feature
# - Checks out feature/authentication branch
# - Shares git history with main repo
```

#### Create New Branch in Worktree

```bash
git worktree add -b feature/new-feature ../project-new-feature
```

Creates a new branch and worktree simultaneously.

#### Worktree for Existing Branch

```bash
git worktree add ../project-hotfix hotfix/login-bug
```

### Managing Worktrees

#### List Worktrees

```bash
git worktree list
```

Output:
```
/home/user/project         abc1234 [main]
/home/user/project-feature def5678 [feature/authentication]
/home/user/project-hotfix  ghi9012 [hotfix/login-bug]
```

#### Remove Worktree

```bash
# Remove directory first
rm -rf ../project-feature

# Clean up git reference
git worktree prune
```

Or in one step:

```bash
git worktree remove ../project-feature
```

#### Move Worktree

```bash
git worktree move ../project-feature ../new-location
```

### Worktree Best Practices

#### Use Descriptive Locations

```bash
# ‚úÖ Good - clear purpose
git worktree add ../project-auth feature/auth
git worktree add ../project-hotfix hotfix/critical-bug

# ‚ùå Bad - unclear
git worktree add ../temp feature/auth
```

#### Clean Up When Done

```bash
# After merging feature
git worktree remove ../project-feature
git branch -d feature/authentication
```

#### Don't Commit in Multiple Worktrees

Each worktree is independent, but they share the same git repository. Avoid:

```bash
# Terminal 1
cd project-feature
git commit -m "Add feature"

# Terminal 2 (same moment)
cd project-main
git commit -m "Another change"
# Can cause confusion
```

## Multi-Agent Patterns

### Pattern 1: Write-Review Workflow

The most common pattern: one agent writes, one reviews.

#### Terminal 1: Developer Agent

```bash
cd ~/project
git checkout -b feature/user-profiles
claude
```

```
You: "Implement user profile feature following our patterns"

Claude: I'll implement the user profile feature...
[Implements feature]

Claude: Feature implemented. Ready for review.
```

#### Terminal 2: Reviewer Agent

```bash
cd ~/project
git checkout feature/user-profiles
claude /agents/code-reviewer
```

```
You: "Review the user profile implementation"

Claude (Reviewer): Reviewing changes...

‚úÖ Strengths:
- Clean implementation
- Good test coverage
- Follows project patterns

‚ö†Ô∏è  Issues:
1. Line 45: Missing error handling
2. Line 78: Could optimize this query

üí° Suggestions:
- Add loading states
- Consider caching user data

Overall: Approve with minor changes
```

#### Terminal 1: Address Review

```
You: "Address the review comments"

Claude: Implementing review feedback...
1. Added error handling at line 45
2. Optimized query at line 78
3. Added loading states
4. Implemented caching

Changes committed. Ready for re-review.
```

### Pattern 2: Parallel Feature Development

Work on multiple features simultaneously using worktrees.

#### Setup Worktrees

```bash
# Main repo
cd ~/project

# Feature 1: Authentication
git worktree add ../project-auth feature/authentication

# Feature 2: Dashboard
git worktree add ../project-dashboard feature/dashboard

# Feature 3: API
git worktree add ../project-api feature/api-v2
```

#### Terminal 1: Authentication

```bash
cd ~/project-auth
claude
```

```
You: "Implement JWT authentication"

Claude: [Implements authentication]
```

#### Terminal 2: Dashboard

```bash
cd ~/project-dashboard
claude
```

```
You: "Create user dashboard with widgets"

Claude: [Implements dashboard]
```

#### Terminal 3: API Development

```bash
cd ~/project-api
claude
```

```
You: "Implement API v2 endpoints"

Claude: [Implements API]
```

All three features develop in parallel without interference.

### Pattern 3: Multi-Approach Experimentation

Try different implementations simultaneously.

#### Approach A: Client-Side Caching

```bash
git worktree add ../project-cache-client experiment/client-cache
cd ../project-cache-client
claude
```

```
You: "Implement caching using React Query"
```

#### Approach B: Server-Side Caching

```bash
git worktree add ../project-cache-server experiment/server-cache
cd ../project-cache-server
claude
```

```
You: "Implement caching using Redis"
```

#### Approach C: Hybrid Caching

```bash
git worktree add ../project-cache-hybrid experiment/hybrid-cache
cd ../project-cache-hybrid
claude
```

```
You: "Implement hybrid caching with both client and server"
```

#### Compare Results

```bash
# Terminal 4: Analysis
cd ~/project
claude
```

```
You: "Compare the three caching implementations:
- experiment/client-cache
- experiment/server-cache
- experiment/hybrid-cache

Analyze performance, complexity, and maintainability."

Claude: [Analyzes all three approaches]

Recommendation: Hybrid approach offers best balance of...
```

### Pattern 4: Domain Experts

Assign specialized agents to different domains.

#### Terminal 1: Frontend Expert

```bash
cd ~/project
claude /agents/frontend-expert
```

Configured agent with frontend expertise:
```markdown
---
name: Frontend Expert
skills: [react-optimizer, accessibility, design-systems]
---

You specialize in React, TypeScript, and modern frontend development.
```

#### Terminal 2: Backend Expert

```bash
cd ~/project
claude /agents/backend-expert
```

Configured agent with backend expertise:
```markdown
---
name: Backend Expert
skills: [api-design, database-optimization, security]
---

You specialize in Node.js, databases, and API development.
```

#### Terminal 3: DevOps Expert

```bash
cd ~/project
claude /agents/devops-expert
```

Configured agent with DevOps expertise:
```markdown
---
name: DevOps Expert
skills: [docker, kubernetes, ci-cd]
---

You specialize in infrastructure, deployment, and CI/CD.
```

#### Collaboration

Agents work independently but share work through git:

```bash
# Frontend commits component
# Backend commits API
# DevOps adds deployment config

# All merge to main branch
```

### Pattern 5: Staged Development

Progressive development stages in separate worktrees.

#### Stage 1: Prototype

```bash
git worktree add ../project-prototype stage/prototype
cd ../project-prototype
claude
```

```
You: "Create quick prototype focusing on core functionality"
```

#### Stage 2: Implementation

```bash
git worktree add ../project-implement stage/implementation
cd ../project-implement
claude
```

```
You: "Implement production-ready version based on prototype"
```

#### Stage 3: Optimization

```bash
git worktree add ../project-optimize stage/optimization
cd ../project-optimize
claude
```

```
You: "Optimize implementation for performance"
```

Each stage builds on the previous, all visible simultaneously.

## Benefits of Multi-Agent Workflows

### 1. Parallel Execution

Accomplish multiple tasks simultaneously:

```
Single agent: 4 hours sequentially
Multi-agent: 1-2 hours in parallel (with 4 agents)
```

### 2. Separation of Concerns

Each agent focuses on specific domain:
- No context switching
- Deeper expertise
- Better results per domain

### 3. Independent Context

Each Claude instance maintains separate context:
- No confusion between tasks
- Cleaner conversation history
- More focused responses

### 4. Risk Mitigation

Experiment safely:
- Try risky changes in separate worktree
- Keep main codebase stable
- Easy to discard failed experiments

### 5. Better Code Review

Dedicated reviewer agent:
- Fresh perspective
- No implementation bias
- Systematic review process

## Coordination Between Agents

### Method 1: Git Commits

Agents communicate through git:

```bash
# Agent 1 commits API
git commit -m "feat: Add user API endpoint"
git push

# Agent 2 pulls and uses it
git pull
# Now can call the API from frontend
```

### Method 2: Shared Documentation

Use CLAUDE.md for coordination:

```markdown
# CLAUDE.md

## Current Work

### In Progress
- [Frontend Agent] User profile UI (feature/user-profiles)
- [Backend Agent] User API (feature/user-api)
- [DevOps Agent] Deployment config (feature/deploy)

### Completed Today
- [Frontend Agent] Login form
- [Backend Agent] Auth endpoints

### Blockers
- Frontend blocked on user API completion
```

Update as work progresses.

### Method 3: Branch Prefixes

Organize branches by agent:

```
frontend/user-profile
frontend/dashboard
backend/user-api
backend/auth-service
devops/docker-config
```

Clear ownership and purpose.

### Method 4: Session Summaries

End each session with summary:

```
You: "Summarize today's work and update TODO.md"

Claude: [Creates summary]

Appended to TODO.md:
## 2025-01-15 - Frontend Agent
- Completed user profile UI
- Started dashboard widgets
- Blocked on user API (pending backend)
- Next: Complete widget grid layout
```

## Advanced Patterns

### Pipeline Pattern

Agents work in sequence through worktrees:

```
Agent 1 (Design) ‚Üí Agent 2 (Implement) ‚Üí Agent 3 (Test) ‚Üí Agent 4 (Review)
```

Each agent picks up where the previous left off.

### Mob Programming

Multiple agents collaborate on single task:

```
Terminal 1: Driver (writes code)
Terminal 2: Navigator (reviews and guides)
Terminal 3: Observer (spots issues)
```

Real-time collaboration through shared branch.

### A/B Testing

Implement different versions simultaneously:

```
worktree-a: Version A implementation
worktree-b: Version B implementation

Compare performance, usability, code quality
```

Choose the better version.

## Best Practices

### Use Clear Naming

```bash
# ‚úÖ Good - purpose clear
git worktree add ../project-auth-impl feature/auth-implementation
git worktree add ../project-auth-review feature/auth-implementation

# ‚ùå Bad - confusing
git worktree add ../temp1 feature/auth
git worktree add ../temp2 feature/auth
```

### Maintain Independence

Don't have agents work on same files simultaneously:

```
Agent 1: Works on src/frontend/
Agent 2: Works on src/backend/
Agent 3: Works on src/database/
```

Reduces merge conflicts.

### Regular Synchronization

Sync worktrees periodically:

```bash
# In each worktree
git fetch origin
git rebase origin/main
```

### Clean Up Regularly

Remove completed worktrees:

```bash
# After feature is merged
git worktree remove ../project-feature
```

### Document Agent Assignments

In CLAUDE.md:

```markdown
## Multi-Agent Setup

- **Terminal 1** (~/project): Main development
- **Terminal 2** (~/project-review): Code review agent
- **Terminal 3** (~/project-test): Test generation agent
```

## Common Pitfalls

### ‚ùå Same Files, Multiple Agents

Don't edit the same files in parallel:
- Causes merge conflicts
- Confusing for collaboration
- Wasted effort

**Solution**: Divide work by directories or modules.

### ‚ùå Forgetting Which Terminal

Lost track of which agent is where?

**Solution**: Set terminal titles:

```bash
# In each terminal
echo -ne "\033]0;Frontend Agent\007"  # Sets title
```

### ‚ùå Stale Worktrees

Old worktrees accumulate over time.

**Solution**: Regular cleanup:

```bash
git worktree list
git worktree remove ../old-worktree
git worktree prune
```

### ‚ùå Context Confusion

Agents lose track of which branch they're on.

**Solution**: Always include branch in prompts:

```
You: "Working on feature/authentication branch - implement login"
```

## Tools and Tips

### Terminal Multiplexer

Use tmux or screen for multi-agent workflows:

```bash
# Create tmux session with multiple panes
tmux new -s claude-dev

# Split into panes
Ctrl+b %  # Vertical split
Ctrl+b "  # Horizontal split

# Navigate panes
Ctrl+b arrow-keys
```

### Visual Studio Code

Open multiple VS Code windows:

```bash
code ~/project           # Window 1
code ~/project-feature   # Window 2
code ~/project-review    # Window 3
```

Each with separate Claude terminal.

### Shell Aliases

Create shortcuts for common workflows:

```bash
# .bashrc or .zshrc
alias claude-dev='cd ~/project && claude'
alias claude-review='cd ~/project-review && claude /agents/code-reviewer'
alias claude-test='cd ~/project-test && claude /agents/test-writer'
```

## Next Steps

- [Best Practices](/docs/claude-code-best-practices) - Effective workflows
- [Thinking Modes](/docs/claude-code-thinking-modes) - Use thinking in parallel
- [Subagents](/docs/claude-code-subagents) - Specialized agents for multi-agent setups
- [Hooks](/docs/claude-code-hooks) - Automate multi-agent coordination

## Resources

- **Git Worktrees**: https://git-scm.com/docs/git-worktree
- **Tmux Guide**: Terminal multiplexing for multi-agent work
- **Multi-Agent Patterns**: Common workflow templates

---

*Multi-agent workflows multiply your productivity by enabling parallel development with Claude instances that work together towards common goals.*
