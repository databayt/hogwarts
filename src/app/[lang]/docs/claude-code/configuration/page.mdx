# Claude Code Configuration

**Complete guide to configuring Claude Code for your project**

---

## Configuration Files

### .claude/settings.json

Main configuration file with automation rules, permissions, and hooks.

```json
{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "permissions": {
    "allow": [
      "Read", "Write", "Edit", "Glob", "Grep", "Task",
      "WebSearch", "Bash(git:*)", "Bash(pnpm:*)"
    ],
    "deny": [
      "Bash(rm:*)", "Bash(format:*)", "Bash(shutdown:*)"
    ]
  },
  "model": "claude-sonnet-4-5-20250929",
  "enableAllProjectMcpServers": true,
  "includeCoAuthoredBy": true,
  "alwaysThinkingEnabled": true
}
```

### .claude/settings.local.json

Local overrides (not committed to git):

```json
{
  "env": {
    "DATABASE_URL": "postgresql://...",
    "GITHUB_TOKEN": "ghp_..."
  }
}
```

### .mcp.json

MCP server configurations:

```json
{
  "mcpServers": {
    "postgres": {
      "command": "npx",
      "args": ["@modelcontextprotocol/server-postgres", "${DATABASE_URL}"]
    },
    "github": {
      "command": "npx",
      "args": ["@modelcontextprotocol/server-github"]
    }
  }
}
```

## Permissions Configuration

### Tool Permissions

Control which tools Claude can use:

```json
"permissions": {
  "allow": [
    "Read",                    // Read files
    "Write",                   // Create files
    "Edit",                    // Modify files
    "Glob",                    // Pattern matching
    "Grep",                    // Search content
    "Task",                    // Launch agents
    "WebSearch",               // Search the web
    "Bash(git:*)",            // Git commands
    "Bash(pnpm:*)",           // Package manager
    "WebFetch(domain:github.com)"  // Fetch from domains
  ]
}
```

### Security Restrictions

Prevent dangerous operations:

```json
"deny": [
  "Bash(rm:*)",              // No file deletion
  "Bash(del:*)",             // No Windows delete
  "Bash(format:*)",          // No disk formatting
  "Bash(shutdown:*)",        // No system shutdown
  "Bash(reboot:*)"           // No system reboot
]
```

## Hooks Configuration

### PreToolUse Hooks

Execute before tool operations:

```json
"PreToolUse": [
  {
    "matcher": "Bash(git:commit)",
    "hooks": [
      {
        "type": "command",
        "command": "pnpm test --changed --silent"
      }
    ]
  }
]
```

### PostToolUse Hooks

Execute after tool operations:

```json
"PostToolUse": [
  {
    "matcher": "Write",
    "hooks": [
      {
        "type": "command",
        "command": "npx prettier --write \"$CLAUDE_TOOL_ARGS\""
      }
    ]
  }
]
```

### Available Hook Types

- **SessionStart**: When session begins
- **SessionEnd**: When session ends
- **PreToolUse**: Before tool execution
- **PostToolUse**: After tool execution
- **Stop**: On error or interruption

## Environment Variables

### Project Metadata

```json
"env": {
  "PROJECT_NAME": "Hogwarts School Automation Platform",
  "PROJECT_TYPE": "nextjs",
  "MULTI_TENANT": "true",
  "I18N_LANGUAGES": "en,ar"
}
```

### Sensitive Variables (settings.local.json)

```json
{
  "env": {
    "DATABASE_URL": "postgresql://...",
    "GITHUB_TOKEN": "ghp_...",
    "OPENAI_API_KEY": "sk-..."
  }
}
```

## MCP Server Configuration

### Available Servers

1. **PostgreSQL** - Database operations
2. **GitHub** - Repository management
3. **Filesystem** - File operations
4. **Memory** - Context persistence
5. **Ref Tools** - Documentation search
6. **Vercel** - Deployment
7. **Linear** - Issue tracking
8. **Slack** - Team communication
9. **Notion** - Documentation
10. **PostHog** - Analytics
11. **Sentry** - Error tracking
12. **Browser** - Web automation
13. **Memory Bank** - Long-term memory

### Server Setup

```json
{
  "mcpServers": {
    "postgres": {
      "command": "npx",
      "args": ["@modelcontextprotocol/server-postgres", "${DATABASE_URL}"]
    },
    "github": {
      "command": "npx",
      "args": ["@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "${GITHUB_TOKEN}"
      }
    }
  }
}
```

## Model Configuration

### Default Model Configuration

```json
"model": "claude-sonnet-4-5-20250929"
```

### Premium Model Strategy

Claude Code uses only the highest-tier models:

**Claude Opus 4.1** (claude-opus-4-1-20250805):
- Used for the orchestrate agent
- Superior multi-agent coordination
- Complex task decomposition

**Claude Sonnet 4.5** (claude-sonnet-4-5-20250929):
- Used for all technical agents
- Maximum code quality and understanding
- No compromises on performance

## Smart Quality Gates

### Branch-Specific Behavior

Pre-commit and pre-push hooks behave differently based on branch:

**Protected Branches** (main, master, production):
- **BLOCKS** if quality checks fail
- Tests must pass
- Build must succeed
- No type errors

**Feature Branches**:
- **WARNS** but allows commit/push
- Helps maintain velocity during development

### Example Configuration

```bash
# Pre-Commit Hook
BRANCH=$(git rev-parse --abbrev-ref HEAD)
if [ "$BRANCH" = "main" ]; then
  # Block on failure
  exit 1
else
  # Warn but continue
  echo "⚠️  WARNING: Quality checks failed"
fi
```

## Advanced Features

### Thinking Mode

```json
"alwaysThinkingEnabled": true
```

Enables Claude to think through complex problems before responding.

### Co-authorship

```json
"includeCoAuthoredBy": true
```

Adds Claude as co-author in git commits.

### Compact Mode

Reduces output verbosity (when available):

```json
"features": {
  "compactMode": true
}
```

## Platform-Specific Settings

### Hogwarts Configuration

```json
{
  "env": {
    "PROJECT_NAME": "Hogwarts School Automation Platform",
    "MULTI_TENANT": "true",
    "DEFAULT_LOCALE": "ar",
    "SUPPORTED_LOCALES": "ar,en",
    "DATABASE_PROVIDER": "neon",
    "AUTH_STRATEGY": "jwt",
    "TEST_COVERAGE_TARGET": "95"
  }
}
```

## Troubleshooting Configuration

### Debug Mode

Enable verbose logging:

```json
{
  "debug": true,
  "logLevel": "verbose"
}
```

### Check Configuration

```bash
# Validate settings.json
cat .claude/settings.json | jq .

# Check MCP servers
cat .mcp.json | jq .

# Test MCP connection
npx @modelcontextprotocol/server-postgres $DATABASE_URL
```

### Common Issues

1. **Hooks not working**: Check command syntax for your OS
2. **MCP connection failed**: Verify environment variables
3. **Permission denied**: Add tool to allow list
4. **Auto-format not working**: Check PostToolUse hooks

---

**See Also**:
- [Hooks Documentation](/docs/claude-code/hooks)
- [MCP Integration](/docs/claude-code/mcp)
- [Security Best Practices](/docs/claude-code/security)