export const metadata = {
  title: 'Hogwarts - Epic & Story Breakdown',
  description: 'Implementation roadmap with 12 epics and 190+ user stories for Hogwarts School Automation Platform',
}

# Hogwarts - Epic & Story Breakdown

**Document Version:** 1.0
**Last Updated:** January 2024
**Total Epics:** 12
**Total Stories:** 190+
**Estimated Timeline:** 12-18 months for MVP

---

## Overview

This document provides the complete implementation roadmap for the Hogwarts School Automation Platform, breaking down the [Product Requirements Document](/docs/prd) into actionable epics and user stories.

**Implementation Philosophy:**
- **Vertical Slicing**: Each story delivers end-to-end value (no horizontal layer stories)
- **No Forward Dependencies**: Stories only depend on previous epics, never future ones
- **Multi-Tenant Safety**: Every story includes tenant isolation verification
- **Deployable Incrementally**: Each epic completion results in a deployable increment

---

## Epic Overview

<div className="overflow-x-auto my-6">
  <table>
    <thead>
      <tr>
        <th>Epic #</th>
        <th>Epic Name</th>
        <th>Goal</th>
        <th>Stories</th>
        <th>Complexity</th>
        <th>Dependencies</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>1</strong></td>
        <td>Foundation & Infrastructure</td>
        <td>Establish core multi-tenant architecture</td>
        <td>15</td>
        <td>High</td>
        <td>None</td>
      </tr>
      <tr>
        <td><strong>2</strong></td>
        <td>Authentication & Authorization</td>
        <td>Complete user management and RBAC</td>
        <td>18</td>
        <td>High</td>
        <td>Epic 1</td>
      </tr>
      <tr>
        <td><strong>3</strong></td>
        <td>School Configuration</td>
        <td>School setup and academic structure</td>
        <td>12</td>
        <td>Medium</td>
        <td>Epic 1, 2</td>
      </tr>
      <tr>
        <td><strong>4</strong></td>
        <td>Student Management</td>
        <td>Comprehensive student lifecycle</td>
        <td>20</td>
        <td>Medium</td>
        <td>Epic 2, 3</td>
      </tr>
      <tr>
        <td><strong>5</strong></td>
        <td>Teacher & Staff Management</td>
        <td>Teacher profiles and workflows</td>
        <td>15</td>
        <td>Medium</td>
        <td>Epic 2, 3</td>
      </tr>
      <tr>
        <td><strong>6</strong></td>
        <td>Class & Subject Management</td>
        <td>Academic organization</td>
        <td>18</td>
        <td>Medium</td>
        <td>Epic 3, 4, 5</td>
      </tr>
      <tr>
        <td><strong>7</strong></td>
        <td>Attendance System</td>
        <td>Daily and period-wise tracking</td>
        <td>16</td>
        <td>Medium</td>
        <td>Epic 4, 6</td>
      </tr>
      <tr>
        <td><strong>8</strong></td>
        <td>Assessment & Grading</td>
        <td>Assignments, grades, reports</td>
        <td>22</td>
        <td>High</td>
        <td>Epic 6</td>
      </tr>
      <tr>
        <td><strong>9</strong></td>
        <td>Fee Management</td>
        <td>Fee structures and payments</td>
        <td>18</td>
        <td>High</td>
        <td>Epic 4</td>
      </tr>
      <tr>
        <td><strong>10</strong></td>
        <td>Communication</td>
        <td>Announcements and parent portal</td>
        <td>12</td>
        <td>Medium</td>
        <td>Epic 4, 5</td>
      </tr>
      <tr>
        <td><strong>11</strong></td>
        <td>Reporting & Analytics</td>
        <td>Dashboards and insights</td>
        <td>14</td>
        <td>Medium</td>
        <td>All previous</td>
      </tr>
      <tr>
        <td><strong>12</strong></td>
        <td>Polish & Launch</td>
        <td>Performance, security, docs</td>
        <td>10</td>
        <td>High</td>
        <td>All previous</td>
      </tr>
    </tbody>
  </table>
</div>

**Total Stories:** 190
**Implementation Approach:** Vertical slicing (each story delivers end-to-end value)

---

## Epic 1: Foundation & Infrastructure

**Goal:** Establish robust multi-tenant architecture that serves as the foundation for all features.

**Value Proposition:** Without proper multi-tenancy, we cannot safely serve multiple schools from one platform. This epic creates the infrastructure that ensures complete data isolation and scalability.

**Prerequisites:** None (Foundation epic)

**Acceptance Criteria for Epic Completion:**
- ‚úÖ Multi-tenant database schema with `schoolId` scoping
- ‚úÖ Subdomain routing working (`school.databayt.org`)
- ‚úÖ Basic Next.js 15 + React 19 + Prisma 6 setup
- ‚úÖ Development, staging, production environments configured
- ‚úÖ CI/CD pipeline with automated tests
- ‚úÖ First deployable version to Vercel
- ‚úÖ Multi-tenant isolation verified with automated tests

### Key Stories

**1.1 Initialize Next.js Project with TypeScript Strict Mode**
- Next.js 15.4.4 with App Router
- TypeScript strict mode
- ESLint + Prettier
- Turbopack enabled

**1.2 Configure Prisma with PostgreSQL (Neon)**
- Prisma 6.14.0
- Neon serverless PostgreSQL
- Connection pooling (max 100 connections)

**1.3 Create Multi-Tenant Base Schema**
- School model with domain field
- User model with `schoolId`
- `@@unique([email, schoolId])` constraint

**1.4 Implement Subdomain Routing Middleware**
- Extract subdomain from hostname
- Rewrite to `/[lang]/s/[subdomain]/...`
- Support production, preview, and development patterns

**1.5 Create Tenant Context Helper**
- `getTenantContext()` function
- Returns `{ schoolId, school }` from subdomain
- Works in Server Components and Server Actions

**1.6 Setup Environment Configuration**
- Type-safe environment variables with @t3-oss/env-nextjs
- .env.local for development
- Vercel environment variables for production

**1.7 Configure Tailwind CSS 4**
- shadcn/ui setup (New York style)
- Custom color palette (Blue primary, Amber secondary)
- RTL/LTR aware utilities

**1.8 Setup Testing Infrastructure**
- Vitest 2.0.6 for unit tests
- React Testing Library
- Playwright 1.55.0 for E2E tests

**1.9 Create Database Singleton Pattern**
- Prisma client singleton with global caching
- Development hot-reload safe
- Production optimized

**1.10 Setup CI/CD Pipeline**
- GitHub Actions workflow
- Automated tests on PR
- Automated deployment to Vercel on merge

**1.11 Implement Error Monitoring**
- Sentry 10.12.0 integration
- Error boundary components
- Sourcemap upload to Sentry

**1.12 Create Layout Structure**
- Root layout with font configuration
- Locale-aware layout ([lang])
- Platform layout with sidebar

**1.13 Setup Internationalization**
- Arabic (RTL) and English (LTR)
- Cookie-based locale detection
- Language switcher component

**1.14 Create Multi-Tenant Test Suite**
- Automated tests verifying no cross-tenant data leaks
- Test fixtures for multiple schools
- Seed data for development

**1.15 Deploy MVP Foundation**
- Deploy to Vercel production
- Configure custom domain (databayt.org)
- SSL certificate setup

> üìñ **For complete story details** with acceptance criteria, technical notes, and testing instructions, see the [full epics.md document](https://github.com/hogwarts/docs/blob/main/epics.md).

---

## Epic 2: Authentication & Authorization

**Goal:** Complete user management system with role-based access control.

**Value Proposition:** Secure authentication is critical for protecting student data and ensuring proper access control across 8 different user roles.

**Prerequisites:** Epic 1 (Foundation)

**Acceptance Criteria for Epic Completion:**
- ‚úÖ NextAuth v5 configured with multiple providers
- ‚úÖ 8 roles implemented with granular permissions
- ‚úÖ Email/password authentication with secure password hashing
- ‚úÖ OAuth providers (Google, Facebook) working
- ‚úÖ Two-factor authentication (2FA) functional
- ‚úÖ Password reset flow complete
- ‚úÖ Session management with JWT tokens
- ‚úÖ Role-based menu rendering

### Key Stories (18 total)

**2.1 Setup NextAuth v5 (Auth.js)**
**2.2 Configure JWT Session Strategy**
**2.3 Implement Email/Password Provider**
**2.4 Add Google OAuth Provider**
**2.5 Add Facebook OAuth Provider**
**2.6 Create User Registration Flow**
**2.7 Implement Two-Factor Authentication**
**2.8 Build Password Reset Flow**
**2.9 Create Login Page**
**2.10 Implement Session Timeout**
**2.11 Build User Profile Management**
**2.12 Create Role-Based Middleware**
**2.13 Implement Audit Logging**
**2.14 Build User Invitation System**
**2.15 Create Bulk User Import (CSV)**
**2.16 Implement Account Lockout Policy**
**2.17 Build Email Verification**
**2.18 Create Login Activity Log**

---

## Epic 3: School Configuration

**Goal:** Enable schools to configure their academic structure (year levels, terms, departments).

**Value Proposition:** Schools vary widely in their academic calendar and organizational structure. This epic provides the flexibility needed to accommodate different school types.

**Prerequisites:** Epic 1 (Foundation), Epic 2 (Authentication)

**Acceptance Criteria for Epic Completion:**
- ‚úÖ School profile management working
- ‚úÖ Academic year configuration with terms/periods
- ‚úÖ Year level/grade setup
- ‚úÖ Department management
- ‚úÖ School branding (logo, colors)
- ‚úÖ Timezone configuration

### Key Stories (12 total)

**3.1 Create School Profile Form**
**3.2 Implement Academic Year Setup**
**3.3 Build Year Level Configuration**
**3.4 Create Department Management**
**3.5 Implement School Branding**
**3.6 Build Timezone Configuration**
**3.7 Create Term/Period Setup**
**3.8 Implement School Settings Page**
**3.9 Build Logo Upload and Preview**
**3.10 Create Color Picker for Branding**
**3.11 Implement School Information Display**
**3.12 Build School Setup Wizard**

---

## Epic 4: Student Management

**Goal:** Comprehensive student lifecycle management from enrollment to graduation.

**Value Proposition:** Students are the core entity in school operations. This epic provides complete student management including profiles, health records, achievements, and disciplinary tracking.

**Prerequisites:** Epic 2 (Authentication), Epic 3 (School Configuration)

**Acceptance Criteria for Epic Completion:**
- ‚úÖ Student enrollment form working
- ‚úÖ Comprehensive student profiles (7 tabs)
- ‚úÖ Search and filtering functional
- ‚úÖ Batch operations working
- ‚úÖ Document upload (birth certificates, medical records)
- ‚úÖ Health records tracking
- ‚úÖ Achievement tracking
- ‚úÖ Disciplinary records
- ‚úÖ Guardian relationships
- ‚úÖ Photo management

### Key Stories (20 total)

**4.1 Create Student Enrollment Form**
**4.2 Build Student Profile Page Structure**
**4.3 Implement Personal Info Tab**
**4.4 Create Academic Tab**
**4.5 Build Health Tab**
**4.6 Implement Documents Tab**
**4.7 Create Achievements Tab**
**4.8 Build Disciplinary Tab**
**4.9 Implement Fees Tab**
**4.10 Create Student Search**
**4.11 Build Filtering System**
**4.12 Implement Batch Actions**
**4.13 Create Document Upload**
**4.14 Build Health Records Management**
**4.15 Implement Achievement Tracking**
**4.16 Create Disciplinary Records**
**4.17 Build Guardian Linking**
**4.18 Implement Photo Upload**
**4.19 Create Student Export (Individual)**
**4.20 Build Student Export (Bulk)**

---

## Epic 5: Teacher & Staff Management

**Goal:** Manage teacher profiles, qualifications, workload, and assignments.

**Value Proposition:** Teachers are the second-most important entity after students. This epic enables comprehensive teacher management including qualifications, class assignments, and performance tracking.

**Prerequisites:** Epic 2 (Authentication), Epic 3 (School Configuration)

**Acceptance Criteria for Epic Completion:**
- ‚úÖ Teacher profile creation working
- ‚úÖ Qualifications management
- ‚úÖ Department assignments
- ‚úÖ Class assignments
- ‚úÖ Workload tracking
- ‚úÖ Leave management
- ‚úÖ Substitution workflows

### Key Stories (15 total)

**5.1 Create Teacher Profile Form**
**5.2 Build Qualifications Management**
**5.3 Implement Department Assignment**
**5.4 Create Subject Expertise Tracking**
**5.5 Build Workload Calculator**
**5.6 Implement Teacher Dashboard**
**5.7 Create Leave Request System**
**5.8 Build Substitution Management**
**5.9 Implement Contract Management**
**5.10 Create Professional Development Tracking**
**5.11 Build Teacher Timetable View**
**5.12 Implement Non-Teaching Staff Management**
**5.13 Create ID Card Generation**
**5.14 Build Teacher Export**
**5.15 Implement Performance Reviews**

---

## Epic 6: Class & Subject Management

**Goal:** Organize academic structure with subjects, classes, and schedules.

**Value Proposition:** Classes and subjects are the core of academic operations. This epic provides the tools to organize students into classes, assign teachers, and build timetables.

**Prerequisites:** Epic 3 (School Configuration), Epic 4 (Student Management), Epic 5 (Teacher Management)

**Acceptance Criteria for Epic Completion:**
- ‚úÖ Subject creation working
- ‚úÖ Class organization functional
- ‚úÖ Student enrollment in classes
- ‚úÖ Teacher assignments
- ‚úÖ Timetable builder working
- ‚úÖ Conflict detection
- ‚úÖ Capacity management

### Key Stories (18 total)

**6.1 Create Subject Management**
**6.2 Build Class Creation**
**6.3 Implement Student Enrollment**
**6.4 Create Teacher Assignment**
**6.5 Build Schedule Configuration**
**6.6 Implement Capacity Limits**
**6.7 Create Timetable Builder**
**6.8 Build Conflict Detection**
**6.9 Implement Class Analytics**
**6.10 Create Class Announcements**
**6.11 Build Resource Sharing**
**6.12 Implement Gradebook Access**
**6.13 Create Attendance Sheet**
**6.14 Build Waitlist Management**
**6.15 Implement Section Management**
**6.16 Create Subject Prerequisites**
**6.17 Build Class Archive**
**6.18 Implement Roster Export**

---

## Epic 7-12: Summary

> ‚ö†Ô∏è **Detailed Stories TBD**
>
> The following epics have outlined goals and story counts but require detailed story expansion:

### Epic 7: Attendance System (16 stories)
Daily attendance marking ‚Ä¢ Period-wise tracking ‚Ä¢ QR code check-in ‚Ä¢ Alerts and notifications ‚Ä¢ Reporting at student, class, and school levels

### Epic 8: Assessment & Grading (22 stories)
Assignment creation ‚Ä¢ Submission portal ‚Ä¢ Grading interface ‚Ä¢ Gradebook ‚Ä¢ Report card generation ‚Ä¢ Score range configuration

### Epic 9: Fee Management (18 stories)
Fee structure setup ‚Ä¢ Payment recording ‚Ä¢ Invoice generation ‚Ä¢ Outstanding fees tracking ‚Ä¢ Scholarship management ‚Ä¢ Payment reminders

### Epic 10: Communication (12 stories)
Announcement system ‚Ä¢ Email notifications ‚Ä¢ Parent portal ‚Ä¢ Read tracking ‚Ä¢ Class-specific announcements ‚Ä¢ Emergency broadcasts

### Epic 11: Reporting & Analytics (14 stories)
Student reports ‚Ä¢ Class analytics ‚Ä¢ Attendance dashboards ‚Ä¢ Fee collection reports ‚Ä¢ Export functionality ‚Ä¢ Custom dashboards

### Epic 12: Polish & Launch (10 stories)
Performance optimization ‚Ä¢ Security hardening ‚Ä¢ Documentation completion ‚Ä¢ User onboarding ‚Ä¢ Training materials ‚Ä¢ Launch preparation

---

## Implementation Guidelines

### Vertical Slicing Principle

Each user story must deliver end-to-end value, touching all necessary layers:

**‚úÖ Good Vertical Slice:**
"As a teacher, I want to mark attendance for my class so that the system records who is present today."

This story includes:
- UI (attendance marking form)
- Server action (submit attendance)
- Database (save attendance records)
- Validation (ensure schoolId scoping)
- Testing (verify multi-tenant isolation)

**‚ùå Bad Horizontal Slice:**
"Create database schema for attendance records."

This only touches one layer and delivers no user value.

### Multi-Tenant Safety Checklist

Every story MUST verify:
- [ ] All database queries include `schoolId` filter
- [ ] Unique constraints are scoped by `schoolId`
- [ ] Session/context includes `schoolId`
- [ ] Automated test verifies no cross-tenant data leaks
- [ ] UI only shows data for current school

### Story Template

```markdown
### Story X.Y: [Story Title]

**As a** [role]
**I want** [capability]
**So that** [benefit]

**Acceptance Criteria:**
- [ ] Criterion 1
- [ ] Criterion 2
- [ ] Multi-tenant safety verified

**Technical Notes:**
- Implementation details
- Key dependencies
- Performance considerations

**Testing:**
- Manual test steps
- Automated test requirements
- Multi-tenant test case

**Vertical Slice:** What end-to-end value is delivered?
```

---

## Dependencies & Sequencing

**Dependency Graph:**
```
Epic 1 (Foundation)
  ‚Üì
Epic 2 (Authentication) ‚îÄ‚î¨‚îÄ‚Üí Epic 3 (School Config)
                         ‚îÇ         ‚Üì
                         ‚îú‚îÄ‚Üí Epic 4 (Students) ‚îÄ‚î¨‚îÄ‚Üí Epic 6 (Classes) ‚Üí Epic 7 (Attendance)
                         ‚îÇ         ‚Üì             ‚îÇ         ‚Üì
                         ‚îú‚îÄ‚Üí Epic 5 (Teachers) ‚îÄ‚îò    Epic 8 (Assessment)
                         ‚îÇ         ‚Üì
                         ‚îú‚îÄ‚Üí Epic 9 (Fees)
                         ‚îÇ         ‚Üì
                         ‚îî‚îÄ‚Üí Epic 10 (Communication)
                                   ‚Üì
                           Epic 11 (Reporting)
                                   ‚Üì
                           Epic 12 (Launch)
```

**Critical Path:** Epic 1 ‚Üí Epic 2 ‚Üí Epic 3 ‚Üí Epic 4/5 ‚Üí Epic 6 ‚Üí Epic 7/8/9/10 ‚Üí Epic 11 ‚Üí Epic 12

**Parallelization Opportunities:**
- Epics 4, 5, 9 can be developed in parallel (all depend on Epic 2 & 3)
- Epics 7, 8, 10 can be developed in parallel (after Epic 6)

---

## Estimation & Timeline

**Story Point Scale:** Fibonacci (1, 2, 3, 5, 8, 13)

**Average Story Complexity:**
- Epic 1 (Foundation): 8 points/story ‚Üí 120 points total
- Epic 2 (Authentication): 5 points/story ‚Üí 90 points total
- Epic 3-6: 3-5 points/story ‚Üí 60-90 points each
- Epic 7-10: 3-5 points/story ‚Üí 48-90 points each
- Epic 11: 5 points/story ‚Üí 70 points total
- Epic 12: 8 points/story ‚Üí 80 points total

**Total Estimated Points:** ~1,000 points

**Team Velocity Assumptions:**
- 1 senior full-stack developer: 20 points/sprint (2 weeks)
- 2 developers: 40 points/sprint
- 3 developers: 60 points/sprint

**Timeline Scenarios:**
- **Solo developer:** ~50 sprints = 100 weeks = ~24 months
- **2 developers:** ~25 sprints = 50 weeks = ~12 months
- **3 developers:** ~17 sprints = 34 weeks = ~8 months

**Recommended:** 2-3 developers for 12-month MVP delivery

---

## Quality Metrics

**Story Acceptance:**
- [ ] All acceptance criteria met
- [ ] Multi-tenant safety verified
- [ ] Automated tests written (95%+ coverage)
- [ ] Code review completed
- [ ] Documentation updated
- [ ] Deployed to staging environment

**Epic Completion:**
- [ ] All stories completed
- [ ] Epic-level acceptance criteria met
- [ ] Integration tests passing
- [ ] Performance benchmarks met
- [ ] Security audit passed
- [ ] Deployed to production

---

## Next Steps

1. **Review Full Epic Documentation** - See [epics.md](https://github.com/hogwarts/docs/blob/main/epics.md) for complete story details
2. **Validation Report** - See [Validation Report](/docs/validation) for quality assessment
3. **Begin Implementation** - Start with Epic 1 (Foundation)
4. **Track Progress** - Use GitHub Projects or Linear for epic/story tracking

---

_This epic breakdown follows the BMAD-METHOD for vertically sliced, dependency-free, multi-tenant-safe implementation._

_Last Updated: January 2024 | Document Version: 1.0_
