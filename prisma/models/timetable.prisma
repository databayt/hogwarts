// Timetable placement model (weekly slots)

model Timetable {
  id          String @id @default(cuid())
  schoolId    String
  termId      String
  dayOfWeek   Int // 0 = Sun ... 6 = Sat
  periodId    String
  classId     String
  teacherId   String
  classroomId String
  weekOffset  Int    @default(0) // 0 current, 1 next

  // Relations
  school    School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  term      Term      @relation(fields: [termId], references: [id])
  period    Period    @relation(fields: [periodId], references: [id])
  class     Class     @relation(fields: [classId], references: [id])
  teacher   Teacher   @relation(fields: [teacherId], references: [id])
  classroom Classroom @relation(fields: [classroomId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([schoolId, termId, dayOfWeek, periodId, classId, weekOffset])
  @@unique([schoolId, termId, dayOfWeek, periodId, teacherId, weekOffset])
  @@unique([schoolId, termId, dayOfWeek, periodId, classroomId, weekOffset])

  // Performance indexes for common queries
  @@index([schoolId, termId, dayOfWeek])
  @@index([schoolId, termId, periodId])
  @@index([schoolId, termId, weekOffset])
  @@index([schoolId, termId, teacherId])
  @@index([schoolId, termId, classId])
  @@index([schoolId, termId, classroomId])

  // Composite indexes for specific query patterns
  @@index([schoolId, termId, dayOfWeek, periodId])
  @@index([schoolId, termId, teacherId, dayOfWeek])
  @@index([schoolId, termId, classId, dayOfWeek])

  @@map("timetables")
}
