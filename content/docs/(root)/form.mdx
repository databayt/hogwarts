---
title: "Form Block"
description: "Generic, reusable form system with atoms, templates, server actions, and React 19 integration"
---

## Overview

The **Form Block** is a centralized, **generic** form system for building consistent forms across the application. It provides atomic field components, composed templates, generic server actions, analytics, and persistence - all integrated with `react-hook-form`, Zod 4, and React 19.

### Design Principles

- **Generic**: Components work with any data model
- **Reusable**: Atoms compose into any form flow
- **Type-safe**: Full TypeScript inference
- **Server-ready**: Generic action helpers for mutations
- **Multi-tenant**: Built-in schoolId scoping

### Key Features

- Atomic field components (single-purpose)
- Composed templates (multi-step, modals)
- Generic CRUD server actions
- React 19 integration (useActionState, useFormStatus)
- Auto-save and persistence
- Analytics tracking

---

## Architecture

The form system follows an **atomic design pattern** with clear separation of concerns.

### Directory Structure

```
src/components/form/
├── index.ts              # Main exports (backward compatible)
├── types.ts              # Generic TypeScript types
├── actions.ts            # Generic server action helpers (NEW)
├── use-form.ts           # Central hooks file (all hooks merged)
│
├── atoms/                # Atomic field components (single-purpose)
│   ├── index.ts          # Atom exports
│   ├── input.tsx         # Text/email/tel/url input
│   ├── number.tsx        # Number input with min/max
│   ├── select.tsx        # Select dropdown
│   ├── textarea.tsx      # Multi-line text
│   ├── checkbox.tsx      # Boolean checkbox
│   ├── date.tsx          # Date picker
│   ├── switch.tsx        # Toggle switch
│   ├── radio-group.tsx   # Radio options
│   └── combobox.tsx      # Searchable select
│
└── template/             # Composed form templates (molecules + organisms)
    ├── index.ts          # Template exports
    │
    │ # Composed Fields (molecules)
    ├── field-array.tsx   # Dynamic field list
    ├── password-field.tsx # Password with strength meter
    ├── phone-field.tsx   # Phone with country code
    │
    │ # Form Structures (organisms)
    ├── provider.tsx      # Multi-step form provider
    ├── modal.tsx         # Modal wrapper
    ├── container.tsx     # Step container
    ├── header.tsx        # Step header
    ├── heading.tsx       # Form heading
    ├── navigation.tsx    # Step navigation
    ├── progress.tsx      # Progress indicator
    ├── success.tsx       # Success celebration
    └── layout.tsx        # Two-column layout
```

---

## Component Roles & Usage

### Atoms (Single-Purpose Fields)

Atomic field components that work with any form. All integrate with `react-hook-form`.

| Component         | Role                                | Usage Across App                                    |
| ----------------- | ----------------------------------- | --------------------------------------------------- |
| `InputField`      | Text/email/password/tel/url input   | Login, registration, profile, search, contact forms |
| `NumberField`     | Numeric values with min/max         | Age, quantity, prices, scores, capacities           |
| `SelectField`     | Dropdown selection                  | Roles, statuses, categories, types, subjects        |
| `TextareaField`   | Multi-line text                     | Descriptions, bios, notes, messages, feedback       |
| `CheckboxField`   | Boolean toggle                      | Consent, preferences, filters, bulk selection       |
| `DateField`       | Date picker                         | Birth dates, deadlines, schedules, events           |
| `SwitchField`     | On/off toggle                       | Settings, notifications, feature flags              |
| `RadioGroupField` | Single selection from options       | Plan selection, payment methods, priorities         |
| `ComboboxField`   | Searchable select with autocomplete | Large lists, tags, user search                      |

### Template Components

Composed components that combine atoms into patterns (molecules) or complete structures (organisms).

#### Composed Fields (Molecules)

| Component       | Role                                             | Usage Across App                              |
| --------------- | ------------------------------------------------ | --------------------------------------------- |
| `FieldArray`    | Dynamic list of fields with add/remove           | Email lists, phone numbers, addresses, skills |
| `PasswordField` | Password with visibility toggle + strength meter | Registration, password reset, settings        |
| `PhoneField`    | Phone input with country code selector           | Contact forms, profiles, emergency contacts   |

#### Form Structures (Organisms)

| Component               | Role                                  | Usage Across App                    |
| ----------------------- | ------------------------------------- | ----------------------------------- |
| `MultiStepFormProvider` | Step state management + context       | Onboarding, applications, wizards   |
| `ModalMultiStepForm`    | Modal wrapper with multi-step support | Quick forms, dialogs, confirmations |
| `FormStepContainer`     | Step content wrapper                  | Any multi-step flow                 |
| `FormStepHeader`        | Step title/description                | Guidance in wizards                 |
| `FormHeading`           | Form heading with icon                | Any form header                     |
| `FormStepNavigation`    | Back/Next buttons                     | Wizard navigation                   |
| `FormStepProgress`      | Visual progress indicator             | User orientation                    |
| `FormSuccess`           | Completion celebration with confetti  | End of successful flows             |
| `FormLayout`            | Two-column split layout               | Landing pages, detailed forms       |

### Hooks

Reusable form logic extracted into hooks.

| Hook                       | Role                                               | Usage Across App               |
| -------------------------- | -------------------------------------------------- | ------------------------------ |
| `useMultiStepForm`         | Access step state and navigation                   | Inside `MultiStepFormProvider` |
| `useMultiStepFormOptional` | Optional version (returns null outside provider)   | Conditional form contexts      |
| `useFormAnalytics`         | Track form events (view, complete, error, abandon) | All forms for metrics          |
| `useFormPersistence`       | Auto-save drafts to localStorage                   | Long forms, prevent data loss  |
| `useActionStateBridge`     | Bridge React 19 useActionState + react-hook-form   | Server action forms            |
| `useFormSubmitStatus`      | Loading state from useFormStatus                   | Submit button states           |

### Wizard Validation Context

Unified validation for multi-step forms across onboarding and application flows.

| Export                        | Role                                            | Usage Across App         |
| ----------------------------- | ----------------------------------------------- | ------------------------ |
| `WizardValidationProvider`    | Context provider for wizard validation          | Onboarding, applications |
| `useWizardValidation`         | Access validation state and controls            | Inside provider          |
| `useWizardValidationOptional` | Optional version (returns undefined if outside) | Conditional contexts     |
| `HostValidationProvider`      | Alias for backward compatibility                | Legacy onboarding code   |
| `useHostValidation`           | Alias for backward compatibility                | Legacy onboarding code   |
| `ApplyValidationProvider`     | Alias for backward compatibility                | Legacy application code  |
| `useApplyValidation`          | Alias for backward compatibility                | Legacy application code  |

```tsx
import {
  useWizardValidation,
  WizardValidationProvider,
} from "@/components/form"

// In layout

;<WizardValidationProvider flowType="linear">
  {children}
</WizardValidationProvider>

// In step components
const { enableNext, disableNext, isNextDisabled } = useWizardValidation()

// Enable next when form is valid
useEffect(() => {
  if (form.formState.isValid) {
    enableNext()
  } else {
    disableNext()
  }
}, [form.formState.isValid])
```

#### Props

| Prop                    | Type                       | Default    | Description                            |
| ----------------------- | -------------------------- | ---------- | -------------------------------------- |
| `flowType`              | `"linear" \| "dependency"` | `"linear"` | Linear (sequential) or dependency flow |
| `dependencies`          | `Record<string, string[]>` | -          | Step dependencies map                  |
| `initialCompletedSteps` | `string[]`                 | `[]`       | Initially completed steps              |

### Server Actions

Generic helpers for CRUD operations with multi-tenant safety.

| Helper                | Role                              | Usage Across App              |
| --------------------- | --------------------------------- | ----------------------------- |
| `createFormAction`    | Wrap schema + handler into action | Any validated form submission |
| `createGenericAction` | Generic create with schoolId      | CRUD create operations        |
| `updateGenericAction` | Generic update with schoolId      | CRUD update operations        |
| `deleteGenericAction` | Generic delete with schoolId      | CRUD delete operations        |
| `findGenericAction`   | Generic find with schoolId        | CRUD read operations          |
| `mapZodErrors`        | Convert Zod errors to form format | Error handling                |
| `createRevalidator`   | Create path revalidation helper   | Cache invalidation            |

---

## React 19 Integration

### useActionState Bridge

Seamlessly integrate React 19's `useActionState` with `react-hook-form`:

```tsx
import { useActionStateBridge } from "@/components/form"

const { form, state, isPending, handleSubmit } = useActionStateBridge({
  schema: studentSchema,
  action: createStudentAction,
  defaultValues: { name: "", email: "" },
  onSuccess: (data) => toast.success("Student created!"),
  onError: (errors) => console.error(errors),
})

return (
  <Form {...form}>
    <form onSubmit={handleSubmit()}>
      <InputField name="name" label="Name" required />
      <InputField name="email" label="Email" type="email" required />
      <Button type="submit" disabled={isPending}>
        {isPending ? "Saving..." : "Save"}
      </Button>
    </form>
  </Form>
)
```

### How It Works

1. **Client Validation**: `react-hook-form` + Zod validates before submission
2. **Server Action**: `useActionState` handles the server action lifecycle
3. **Error Bridging**: Server errors are mapped back to form fields
4. **Type Safety**: Full TypeScript inference from schema to form

---

## Generic Server Actions

### Creating Form Actions

Use `createFormAction` to wrap any schema + handler:

```tsx
// actions.ts
"use server"

import { ActionResponse, createFormAction } from "@/components/form"

import { studentSchema } from "./validation"

export const createStudentAction = createFormAction(
  studentSchema,
  async (data, schoolId) => {
    const student = await db.student.create({
      data: { ...data, schoolId },
    })
    return student
  }
)
```

### Generic CRUD Helpers

```tsx
import {
  createGenericAction,
  deleteGenericAction,
  updateGenericAction,
} from "@/components/form"

// Create
const result = await createGenericAction(
  db.student,
  { name: "John", email: "john@school.com" },
  schoolId,
  "/students" // revalidate path
)

// Update
const result = await updateGenericAction(
  db.student,
  studentId,
  { name: "John Updated" },
  schoolId,
  "/students"
)

// Delete
const result = await deleteGenericAction(
  db.student,
  studentId,
  schoolId,
  "/students"
)
```

### ActionResponse Type

All actions return a consistent response:

```typescript
interface ActionResponse<T = unknown> {
  success: boolean
  data?: T
  errors?: Record<string, string[]>
  message?: string
}
```

---

## Field Components

### Basic Usage

All fields integrate with `react-hook-form` context:

```tsx
import { InputField, SelectField, NumberField, DateField } from "@/components/form"

// Inside a Form provider
<InputField name="email" label="Email" type="email" required />

<SelectField
  name="role"
  label="Role"
  options={[
    { value: "teacher", label: "Teacher" },
    { value: "student", label: "Student" },
  ]}
/>

<NumberField name="age" label="Age" min={0} max={120} />

<DateField name="birthDate" label="Birth Date" maxDate={new Date()} />
```

### New Field Components

#### SwitchField

```tsx
<SwitchField
  name="notifications"
  label="Email Notifications"
  description="Receive updates via email"
/>
```

#### RadioGroupField

```tsx
<RadioGroupField
  name="plan"
  label="Select Plan"
  options={[
    { value: "basic", label: "Basic" },
    { value: "pro", label: "Pro" },
    { value: "enterprise", label: "Enterprise" },
  ]}
  orientation="horizontal"
/>
```

#### ComboboxField

```tsx
<ComboboxField
  name="country"
  label="Country"
  options={countries}
  searchPlaceholder="Search countries..."
  emptyMessage="No country found."
/>
```

#### PasswordField

```tsx
<PasswordField
  name="password"
  label="Password"
  showStrengthMeter
  minLength={8}
/>
```

#### PhoneField

```tsx
<PhoneField
  name="phone"
  countryCodeName="phoneCountryCode"
  label="Phone Number"
  defaultCountryCode="SA"
/>
```

#### FieldArray

```tsx
<FieldArray
  name="emails"
  label="Email Addresses"
  placeholder="email@example.com"
  addButtonLabel="Add another email"
  maxItems={5}
  minItems={1}
/>
```

---

## Multi-Step Forms

### Provider Setup

```tsx
import {
  FormStepContainer,
  FormStepHeader,
  FormStepNavigation,
  MultiStepFormProvider,
  useMultiStepForm,
} from "@/components/form"

const config = {
  steps: [
    { id: "info", title: "Personal Info", fields: ["name", "email"] },
    { id: "details", title: "Details", fields: ["bio"] },
    { id: "confirm", title: "Confirm", optional: true },
  ],
  validation: {
    info: infoSchema,
    details: detailsSchema,
  },
}

function MyForm() {
  return (
    <MultiStepFormProvider config={config} onSubmit={handleSubmit}>
      <FormContent />
    </MultiStepFormProvider>
  )
}

function FormContent() {
  const { currentStep, next, back, isFirstStep, isLastStep } =
    useMultiStepForm()

  return (
    <>
      <FormStepHeader title={steps[currentStep].title} />
      <FormStepContainer>
        {currentStep === 0 && <InfoStep />}
        {currentStep === 1 && <DetailsStep />}
        {currentStep === 2 && <ConfirmStep />}
      </FormStepContainer>
      <FormStepNavigation
        onBack={back}
        onNext={next}
        isFirstStep={isFirstStep}
        isLastStep={isLastStep}
      />
    </>
  )
}
```

### Modal Multi-Step Form

```tsx
import { FormStepContainer, ModalMultiStepForm } from "@/components/form"

;<ModalMultiStepForm
  config={formConfig}
  open={isOpen}
  onOpenChange={setIsOpen}
  onComplete={handleComplete}
  title="Application Form"
  showCloseConfirmation
>
  <FormStepContainer>{/* Step content */}</FormStepContainer>
</ModalMultiStepForm>
```

---

## Analytics & Persistence

### Form Analytics

Track form events for funnel analysis:

```tsx
import { useFormAnalytics } from "@/components/form"

const analytics = useFormAnalytics()

// Track step view
useEffect(() => {
  analytics.trackStepView("onboarding", "personal-info")
}, [currentStep])

// Track step completion
const handleNext = async () => {
  await next()
  analytics.trackStepComplete("onboarding", "personal-info")
}

// Track errors
analytics.trackStepError("onboarding", "personal-info", "validation_failed")

// Track flow completion
analytics.trackFlowComplete("onboarding", { userId })

// Track abandonment
analytics.trackFlowAbandonment("onboarding", "personal-info")
```

### Form Persistence

Auto-save drafts to prevent data loss:

```tsx
import { useFormPersistence } from "@/components/form"

const persistence = useFormPersistence<FormData>({
  key: "admission-draft",
  autoSave: true,
  autoSaveInterval: 30000, // 30 seconds
})

// Load draft on mount
useEffect(() => {
  const draft = persistence.load()
  if (draft) form.reset(draft)
}, [])

// Manual save
persistence.save(form.getValues())

// Clear draft on successful submission
persistence.clear()

// Check status
console.log(persistence.isDirty, persistence.lastSaved)
```

---

## Best Practices

### 1. Validate Twice

Client-side for UX, server-side for security:

```typescript
// Client: Immediate feedback
const form = useForm({
  resolver: zodResolver(stepSchema),
})

// Server: Security validation
export async function submitForm(data: FormData) {
  "use server"
  const validated = stepSchema.safeParse(Object.fromEntries(data))
  if (!validated.success) {
    return { success: false, errors: mapZodErrors(validated.error) }
  }
  // ... process data
}
```

### 2. Always Include schoolId

For multi-tenant safety:

```typescript
export async function createItem(data: FormData) {
  "use server"
  const session = await auth()
  const schoolId = session?.user?.schoolId

  if (!schoolId) throw new Error("Unauthorized")

  await db.item.create({
    data: { ...validated, schoolId }, // Required!
  })
}
```

### 3. Use Generic Actions

Reduce boilerplate with generic helpers:

```typescript
// Instead of writing full actions
export const createStudent = createFormAction(
  studentSchema,
  async (data, schoolId) => {
    return createGenericAction(db.student, data, schoolId, "/students")
  }
)
```

### 4. Handle Errors Gracefully

Bridge server errors to form fields:

```tsx
const { form, state } = useActionStateBridge({
  schema,
  action,
  onError: (errors) => {
    // Errors already mapped to form fields
    toast.error("Please fix the errors")
  },
})
```

### 5. Enable Auto-Save for Long Forms

Prevent data loss:

```typescript
const config = {
  autoSave: true,
  autoSaveInterval: 30000,
  persistenceKey: "long-form-draft",
}
```

### 6. Track Analytics

Monitor conversion and abandonment:

```typescript
// Track every step
analytics.trackStepView(flowType, stepId)
analytics.trackStepComplete(flowType, stepId)

// Track on unload
useEffect(() => {
  return () => {
    analytics.trackFlowAbandonment(flowType, currentStepId)
  }
}, [])
```

---

## Import Patterns

### Recommended Imports

```tsx
// All from main export
import {
  CheckboxField,
  ComboboxField,
  // Actions
  createFormAction,
  createGenericAction,
  DateField,
  deleteGenericAction,
  FieldArray,
  FormLayout,
  FormStepContainer,
  FormStepHeader,
  FormStepNavigation,
  FormStepProgress,
  FormSuccess,
  // Atoms
  InputField,
  mapZodErrors,
  ModalMultiStepForm,
  // Templates
  MultiStepFormProvider,
  NumberField,
  PasswordField,
  PhoneField,
  RadioGroupField,
  SelectField,
  SwitchField,
  TextareaField,
  updateGenericAction,
  useActionStateBridge,
  // Hooks
  useFormAnalytics,
  useFormPersistence,
  useMultiStepForm,
  // Types
  type ActionResponse,
} from "@/components/form"
```

### Backward Compatibility

Old imports still work:

```tsx
// Legacy (still works)
import { TextField } from "@/components/form" // Alias for InputField
```

---

## Related Documentation

- [Onboarding System](/docs/onboarding) - Route-based multi-step flow
- [Newcomers](/docs/newcomers) - Modal-based onboarding
- [Server Actions](/docs/server-actions) - Form submission handling
- [Multi-Tenant Safety](/docs/multi-tenant) - schoolId scoping patterns

---

**Last Updated**: December 2024
**Status**: Production Ready
**Version**: 2.0.0
