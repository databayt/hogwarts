---
title: "Internationalization"
description: "Complete guide to internationalization with Arabic (RTL) and English (LTR) support"
---

## Overview

This application provides full internationalization support with Arabic (RTL) as the default language alongside English (LTR). The system handles both **static UI translations** and **single-language user-generated content with on-demand translation**.

### Supported Languages

| Locale | Name    | Direction | Flag | Currency | Default |
| ------ | ------- | --------- | ---- | -------- | ------- |
| `ar`   | Arabic  | RTL       | SA   | SAR      | Yes     |
| `en`   | English | LTR       | US   | USD      | No      |

### Key Features

- **URL-based routing**: `/[lang]/path` (e.g., `/ar/dashboard`, `/en/dashboard`)
- **Single-language storage**: One `lang` field, translated on demand via Google Translate API
- **Logical CSS properties**: `ms-`, `me-`, `ps-`, `pe-` for auto-mirroring
- **Direction switching**: `dir` attribute on `<html>` element
- **Smart fallbacks**: Falls back to available language if preferred is empty

---

## Quick Start

### Server Components

```tsx
import type { Locale } from "@/components/internationalization/config"
import { getDictionary } from "@/components/internationalization/dictionaries"

export default async function Page({ params }: { params: { lang: string } }) {
  const { lang } = await params
  const dictionary = await getDictionary(lang as Locale)

  return (
    <div>
      <h1>{dictionary.common.home}</h1>
      <p>{dictionary.common.loading}</p>
    </div>
  )
}
```

### Client Components

```tsx
"use client"

import { useLocale } from "@/components/internationalization/use-locale"

export function LocaleIndicator() {
  const { locale, isRTL, localeConfig } = useLocale()

  return (
    <span className={isRTL ? "text-end" : "text-start"}>
      {localeConfig.flag} {localeConfig.nativeName}
    </span>
  )
}
```

---

## User Content Storage

All user-generated content uses **single-language storage** with a `lang` field. Content is stored in one language only. Translation happens on-demand via Google Translate API with database caching through the `TranslationCache` model.

### Rules

1. **Generic field names only** -- `title`, `body`, `name`, `description` (never `titleAr`, `nameEn`)
2. **`lang` field** -- Every content model has `lang String @default("ar")` indicating the stored language
3. **On-demand translation** -- Use `getDisplayText()` from `@/lib/content-display` to translate at display time
4. **TranslationCache** -- Translated strings are cached in the database to avoid repeated API calls
5. **School's preferred language** -- `School.preferredLanguage` determines the default storage language

### Schema Pattern

```prisma
model Announcement {
  id       String  @id @default(cuid())
  schoolId String
  title    String?          // Generic field name (NOT titleEn/titleAr)
  body     String? @db.Text // Generic field name (NOT bodyEn/bodyAr)
  lang     String  @default("ar") // Language of stored content
}
```

### Display with Translation

```tsx
import { getDisplayText } from "@/lib/content-display"

// Stored in Arabic, user views in English -> translates via API
const title = await getDisplayText(announcement.title, "ar", "en", schoolId)

// Same language -> returns directly, no API call
const title = await getDisplayText(announcement.title, "ar", "ar", schoolId)
```

### Form Pattern

Forms collect content in a single language. The `lang` field is set based on the school's preferred language or the current locale:

```tsx
"use client"

import { useForm } from "react-hook-form"

interface ContentFormData {
  title: string
  body: string
}

export function ContentForm({ lang }: { lang: string }) {
  const form = useForm<ContentFormData>()

  return (
    <form>
      <input type="hidden" name="lang" value={lang} />
      <Input {...form.register("title")} placeholder="Title" />
      <Textarea {...form.register("body")} placeholder="Content" />
    </form>
  )
}
```

### Infrastructure

| File                          | Purpose                     |
| ----------------------------- | --------------------------- |
| `src/lib/google-translate.ts` | Google Translate API client |
| `src/lib/translate.ts`        | Translation with caching    |
| `src/lib/auto-translate.ts`   | Auto-translation utilities  |
| `src/lib/content-display.ts`  | `getDisplayText()` for UI   |
| `prisma/models/school.prisma` | `TranslationCache` model    |

---

## Configuration

### Locale Config

Location: `src/components/internationalization/config.ts`

```ts
export const i18n = {
  defaultLocale: "ar",
  locales: ["en", "ar"],
} as const

export type Locale = (typeof i18n)["locales"][number]

export const localeConfig = {
  en: {
    name: "English",
    nativeName: "English",
    dir: "ltr",
    flag: "üá∫üá∏",
    dateFormat: "MM/dd/yyyy",
    currency: "USD",
  },
  ar: {
    name: "Arabic",
    nativeName: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",
    dir: "rtl",
    flag: "üá∏üá¶",
    dateFormat: "dd/MM/yyyy",
    currency: "SAR",
  },
} as const

export function isRTL(locale: Locale): boolean {
  return localeConfig[locale]?.dir === "rtl"
}
```

---

## Dictionary System

### Loading Dictionaries

Location: `src/components/internationalization/dictionaries.ts`

The system uses **route-specific dictionary loaders** for optimized bundle sizes:

```ts
// Marketing pages - lightweight
// Platform core - general + school + operator

// Finance pages - includes finance module

// Full dictionary - all translations (use sparingly)
import {
  getDictionary,
  getFinanceDictionary,
  getMarketingDictionary,
  getPlatformCoreDictionary,
} from "@/components/internationalization/dictionaries"
```

### Translation Files Structure

```
src/components/internationalization/
‚îú‚îÄ‚îÄ config.ts              # Locale config, types
‚îú‚îÄ‚îÄ dictionaries.ts        # Dictionary loaders
‚îú‚îÄ‚îÄ use-locale.ts          # Client hooks
‚îú‚îÄ‚îÄ use-dictionary.ts      # Dictionary hook
‚îú‚îÄ‚îÄ language-switcher.tsx  # UI component
‚îú‚îÄ‚îÄ en.json                # General English
‚îú‚îÄ‚îÄ ar.json                # General Arabic
‚îú‚îÄ‚îÄ school-en.json         # School module (English)
‚îú‚îÄ‚îÄ school-ar.json         # School module (Arabic)
‚îú‚îÄ‚îÄ operator-en.json       # Operator module
‚îú‚îÄ‚îÄ operator-ar.json
‚îî‚îÄ‚îÄ dictionaries/
    ‚îú‚îÄ‚îÄ en/
    ‚îÇ   ‚îú‚îÄ‚îÄ finance.json
    ‚îÇ   ‚îú‚îÄ‚îÄ library.json
    ‚îÇ   ‚îî‚îÄ‚îÄ ...
    ‚îî‚îÄ‚îÄ ar/
        ‚îú‚îÄ‚îÄ finance.json
        ‚îú‚îÄ‚îÄ library.json
        ‚îî‚îÄ‚îÄ ...
```

### Type-Safe Usage

```tsx
import type { Dictionary } from "@/components/internationalization/dictionaries"

interface Props {
  dictionary: Dictionary["school"]
}

export function StudentList({ dictionary }: Props) {
  return <h1>{dictionary.students.title}</h1>
}
```

---

## RTL Support with Logical Properties

### CSS Logical Properties (Preferred)

Always use **logical CSS properties** instead of physical directions. These automatically adapt to RTL/LTR:

| Physical (Avoid) | Logical (Use) | Description          |
| ---------------- | ------------- | -------------------- |
| `ml-*`           | `ms-*`        | Margin inline-start  |
| `mr-*`           | `me-*`        | Margin inline-end    |
| `pl-*`           | `ps-*`        | Padding inline-start |
| `pr-*`           | `pe-*`        | Padding inline-end   |
| `left-*`         | `start-*`     | Position start       |
| `right-*`        | `end-*`       | Position end         |
| `text-left`      | `text-start`  | Text alignment start |
| `text-right`     | `text-end`    | Text alignment end   |
| `border-l-*`     | `border-s-*`  | Border start         |
| `border-r-*`     | `border-e-*`  | Border end           |
| `rounded-l-*`    | `rounded-s-*` | Border radius start  |
| `rounded-r-*`    | `rounded-e-*` | Border radius end    |

**Example:**

```tsx
// ‚ùå Wrong - physical properties don't adapt
<div className="ml-4 pr-2 text-left border-l-2">

// ‚úÖ Correct - logical properties adapt to RTL/LTR
<div className="ms-4 pe-2 text-start border-s-2">
```

### Layout Integration

The root layout sets direction based on locale:

```tsx
// src/app/[lang]/layout.tsx
import {
  localeConfig,
  type Locale,
} from "@/components/internationalization/config"

export default async function RootLayout({
  children,
  params,
}: {
  children: React.ReactNode
  params: { lang: string }
}) {
  const { lang } = (await params) as { lang: Locale }
  const config = localeConfig[lang]

  return (
    <html lang={lang} dir={config.dir}>
      <body>{children}</body>
    </html>
  )
}
```

### When to Use `rtl:` Variants

Only use `rtl:` variants for cases that **cannot** be solved with logical properties:

```tsx
// Flex direction reversal (no logical equivalent)
<div className="flex flex-row rtl:flex-row-reverse">

// Icon mirroring for directional icons
<ChevronRight className="rtl:scale-x-[-1]" />

// Space reversal in flex
<div className="flex space-x-2 rtl:space-x-reverse">
```

---

## Client-Side Hooks

### useLocale Hook

```tsx
"use client"

import { useLocale } from "@/components/internationalization/use-locale"

export function MyComponent() {
  const { locale, isRTL, localeConfig } = useLocale()

  return (
    <div dir={isRTL ? "rtl" : "ltr"}>
      <p>Current: {localeConfig.nativeName}</p>
      <p>Direction: {localeConfig.dir}</p>
    </div>
  )
}
```

### useDictionary Hook

```tsx
"use client"

import { useDictionary } from "@/components/internationalization/use-dictionary"

export function ClientComponent() {
  const { dictionary, isLoading } = useDictionary()

  if (isLoading) return <Spinner />

  return <h1>{dictionary?.common.welcome}</h1>
}
```

### useSwitchLocaleHref Hook

```tsx
"use client"

import Link from "next/link"

import { useSwitchLocaleHref } from "@/components/internationalization/use-locale"

export function LanguageSwitcher() {
  const switchLocaleHref = useSwitchLocaleHref()

  return (
    <nav className="flex gap-2">
      <Link href={switchLocaleHref("ar")}>ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</Link>
      <Link href={switchLocaleHref("en")}>English</Link>
    </nav>
  )
}
```

---

## Arabic Number & Date Formatting

### Number Formatting

```tsx
// Format with locale-aware separators
const formatter = new Intl.NumberFormat(locale, {
  style: "decimal",
  maximumFractionDigits: 2,
})
formatter.format(1234567) // ar: "Ÿ°Ÿ¨Ÿ¢Ÿ£Ÿ§Ÿ¨Ÿ•Ÿ¶Ÿß" | en: "1,234,567"

// Currency formatting
const currencyFormatter = new Intl.NumberFormat(locale, {
  style: "currency",
  currency: locale === "ar" ? "SAR" : "USD",
})
currencyFormatter.format(99.99) // ar: "Ÿ©Ÿ©Ÿ´Ÿ©Ÿ© ÿ±.ÿ≥" | en: "$99.99"
```

### Date Formatting

```tsx
const dateFormatter = new Intl.DateTimeFormat(locale, {
  year: "numeric",
  month: "long",
  day: "numeric",
})
dateFormatter.format(new Date()) // ar: "Ÿ° ÿØŸäÿ≥ŸÖÿ®ÿ± Ÿ¢Ÿ†Ÿ¢Ÿ•" | en: "December 1, 2025"

// Relative time
const relativeFormatter = new Intl.RelativeTimeFormat(locale, {
  numeric: "auto",
})
relativeFormatter.format(-2, "day") // ar: "ŸÖŸÜÿ∞ ŸäŸàŸÖŸäŸÜ" | en: "2 days ago"
```

### Arabic Pluralization

Arabic has three plural forms: singular (1), dual (2), and plural (3+).

```tsx
function arabicPlural(
  count: number,
  singular: string,
  dual: string,
  plural: string
): string {
  if (count === 1) return singular
  if (count === 2) return dual
  return plural
}

// Usage
arabicPlural(count, "ÿ∑ÿßŸÑÿ®", "ÿ∑ÿßŸÑÿ®ÿßŸÜ", "ÿ∑ŸÑÿßÿ®") // student/students
arabicPlural(count, "ŸäŸàŸÖ", "ŸäŸàŸÖÿßŸÜ", "ÿ£ŸäÿßŸÖ") // day/days
```

---

## Best Practices

### UI Guidelines

1. **Use logical properties** - `ms-`, `me-`, `ps-`, `pe-` instead of `ml-`, `mr-`, etc.
2. **Mirror directional icons** - Arrows and chevrons should flip in RTL
3. **Test both languages** - Always verify layouts in ar and en
4. **Numbers stay Western** - Unless explicitly localized for display

### Content Guidelines

1. **Avoid string concatenation** - Use full-sentence translations
2. **Generic field names only** - `title`, `body`, `name` (never `titleEn`/`titleAr`)
3. **Single-language storage** - Store in one language with a `lang` field
4. **On-demand translation** - Use `getDisplayText()` for display-time translation

### Typography

- **Arabic font**: Rubik (system default)
- **English font**: Inter
- **Line height**: 1.8 recommended for Arabic
- **No font-size hardcoding** - Use semantic HTML (h1-h6, p, small)

### Testing Checklist

- [ ] All flows tested in ar/en
- [ ] Logical properties used (no `ml-*`, `mr-*`, etc.)
- [ ] Icons mirror correctly
- [ ] Dates/numbers localized
- [ ] Screen readers handle language
- [ ] Keyboard navigation works
- [ ] No text overflow

---

## Migration Guide

### Adding the `lang` Field to Legacy Models

If a model stores content without a `lang` field, add one and detect the stored language:

```sql
-- Add lang field with default
ALTER TABLE "announcements" ADD COLUMN IF NOT EXISTS "lang" TEXT DEFAULT 'ar';

-- Detect and update language for existing rows
UPDATE "announcements"
SET "lang" = 'ar'
WHERE "title" ~ '[\u0600-\u06FF]';

UPDATE "announcements"
SET "lang" = 'en'
WHERE "title" !~ '[\u0600-\u06FF]';
```

### Migrating from Dual Fields to Single-Language

If any legacy code uses `titleEn`/`titleAr` patterns, migrate to the single-language storage model:

```ts
import { detectLanguage } from "@/lib/i18n-content"

async function migrateToDualToSingle() {
  const items = await db.announcement.findMany()

  for (const item of items) {
    // Keep the primary language content, detect which one it is
    const title = item.titleAr || item.titleEn
    const body = item.bodyAr || item.bodyEn
    const lang = item.titleAr ? "ar" : "en"

    await db.announcement.update({
      where: { id: item.id },
      data: { title, body, lang },
    })
  }
}
```

---

## Folder Structure

```
src/
  components/internationalization/
    config.ts              # Locale config, types, isRTL helper
    dictionaries.ts        # Dictionary loaders (route-specific)
    use-locale.ts          # Client hooks: useLocale, useSwitchLocaleHref
    use-dictionary.ts      # useDictionary hook
    language-switcher.tsx  # Language switcher component
    en.json                # General English translations
    ar.json                # General Arabic translations
    school-*.json          # School module translations
    operator-*.json        # Operator module translations
    dictionaries/          # Feature-specific translations
      en/
      ar/
  lib/
    content-display.ts     # getDisplayText() for on-demand translation
    google-translate.ts    # Google Translate API client
    translate.ts           # Translation with caching
    auto-translate.ts      # Auto-translation utilities
    i18n-content.ts        # Legacy i18n content utilities
  styles/
    globals.css            # Base styles with logical properties
```

---

## References

### Internal

- `src/lib/content-display.ts` - `getDisplayText()` for on-demand translation
- `src/lib/google-translate.ts` - Google Translate API client
- `src/lib/translate.ts` - Translation with database caching
- `src/components/internationalization/` - Full i18n implementation

### External

- [Next.js Internationalization](https://nextjs.org/docs/app/building-your-application/routing/internationalization)
- [Tailwind CSS Logical Properties](https://tailwindcss.com/docs/margin#using-logical-properties)
- [MDN CSS Logical Properties](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_logical_properties_and_values)
- [W3C Authoring HTML & CSS for RTL](https://www.w3.org/International/techniques/authoring-html)
