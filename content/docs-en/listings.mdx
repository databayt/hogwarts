---
title: "Listings"
description: "A unified pattern for data tables, grids, and CRUD operations across the platform with optimistic updates, auto-refresh, and consistent UX."
---

## Overview

**Listings** are the backbone of data-driven features in the platform. They provide a unified pattern for displaying, searching, filtering, creating, editing, and deleting recordsâ€”all with a consistent UX and optimistic updates.

The platform currently has **12 listing entities**, each following the same structure. This makes the codebase predictable for developers and consistent for users. Whether you're working with Students, Teachers, Classrooms, Assignments, or any other entityâ€”the pattern remains the same.

## Key Features

<div className="not-prose mt-6 grid grid-cols-1 gap-4 md:grid-cols-2">
  <div className="rounded-lg border p-6">
    <h4 className="mb-2 font-semibold">Optimistic Updates</h4>
    <p className="text-muted-foreground text-sm">
      Add, update, and remove items instantly with automatic rollback on errors.
    </p>
  </div>
  <div className="rounded-lg border p-6">
    <h4 className="mb-2 font-semibold">URL-Persisted Views</h4>
    <p className="text-muted-foreground text-sm">
      Table/Grid view toggle persists via URL query params using nuqs.
    </p>
  </div>
  <div className="rounded-lg border p-6">
    <h4 className="mb-2 font-semibold">Infinite Scroll</h4>
    <p className="text-muted-foreground text-sm">
      Load-more pagination for seamless data browsing without page reloads.
    </p>
  </div>
  <div className="rounded-lg border p-6">
    <h4 className="mb-2 font-semibold">Centralized Queries</h4>
    <p className="text-muted-foreground text-sm">
      Type-safe query builders with role-based authorization per module.
    </p>
  </div>
</div>

---

## Listing Structure

Every listing follows the **mirror pattern** â€” the URL route produces two directories: one in `app/` for routing, one in `components/` for feature logic. Replace `abc` with your feature name.

<ListingStructure />

---

## Standardized File Patterns

Each listing directory follows these naming conventions:

| File               | Purpose                                         |
| ------------------ | ----------------------------------------------- |
| `content.tsx`      | Server component: data fetching, tenant context |
| `table.tsx`        | Client component: interactive table with state  |
| `columns.tsx`      | Column definitions (client, uses hooks)         |
| `form.tsx`         | Create/Edit form with validation                |
| `actions.ts`       | Server actions: validate, scope tenant, mutate  |
| `queries.ts`       | Query builders with Prisma                      |
| `authorization.ts` | RBAC permission checks                          |
| `validation.ts`    | Zod schemas & refinements                       |
| `types.ts`         | TypeScript interfaces                           |
| `config.ts`        | Constants, options, labels                      |
| `list-params.ts`   | URL params (nuqs)                               |
| `README.md`        | Feature documentation                           |
| `ISSUE.md`         | Known issues tracker                            |

---

## Page Layout Composition

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PageTitle                     src/components/atom/page-title.tsxâ”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Abc Management                                              â”‚â”‚
â”‚  â”‚ Manage all abc records in your school                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PageNav                         src/components/atom/page-nav.tsxâ”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ All      â”‚ Active   â”‚ Archive  â”‚ Settings â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Toolbar                         src/components/atom/toolbar.tsx â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ SearchInput    Filters           ViewToggle Export Create   â”‚â”‚
â”‚  â”‚ [ğŸ” Search...] [Statusâ–¾][Typeâ–¾]  [â‰¡/âŠ]     [â†“]    [+]      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DataTable                   src/components/table/data-table.tsx â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â˜ â”‚ Name        â”‚ Status   â”‚ Created    â”‚ Actions          â”‚â”‚
â”‚  â”‚â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”‚
â”‚  â”‚ â˜ â”‚ Item 1      â”‚ Active   â”‚ 2025-01-20 â”‚ [Â·Â·Â·]            â”‚â”‚
â”‚  â”‚ â˜ â”‚ Item 2      â”‚ Draft    â”‚ 2025-01-19 â”‚ [Â·Â·Â·]            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  OR GridContainer          src/components/atom/grid-container.tsxâ”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ Card 1  â”‚ â”‚ Card 2  â”‚ â”‚ Card 3  â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Modal (when open)              src/components/atom/modal/modal  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ModalFormLayout  src/components/atom/modal/modal-form-layout â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚ â”‚ Create Abc   â”‚  â”‚  Form (listings/abc/form.tsx)         â”‚â”‚â”‚
â”‚  â”‚ â”‚ Add new item â”‚  â”‚  - Field 1                           â”‚â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â”‚ ModalFooter      src/components/atom/modal/modal-footer     â”‚â”‚
â”‚  â”‚ [â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”]                              â”‚â”‚
â”‚  â”‚ Step 1 of 2: Basic Info              [Cancel] [Next]       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Flow

```
Route (page.tsx)
    â”‚
    â–¼
Content (content.tsx) â”€â”€â”€â”€ Server Component
    â”‚ â€¢ getTenantContext()
    â”‚ â€¢ Parse URL params
    â”‚ â€¢ Fetch data via queries.ts
    â”‚
    â–¼
Table (table.tsx) â”€â”€â”€â”€â”€â”€â”€â”€ Client Component
    â”‚ â€¢ useModal()
    â”‚ â€¢ usePlatformView()
    â”‚ â€¢ useDataTable()
    â”‚
    â”œâ”€â”€â–º Toolbar
    â”‚      â€¢ SearchInput
    â”‚      â€¢ ViewToggle
    â”‚      â€¢ ExportButton
    â”‚      â€¢ CreateButton
    â”‚
    â”œâ”€â”€â–º DataTable / GridContainer
    â”‚      â€¢ Columns (columns.tsx)
    â”‚      â€¢ Row actions
    â”‚      â€¢ Pagination
    â”‚
    â””â”€â”€â–º Modal
           â€¢ Form (form.tsx)
           â€¢ ModalFormLayout
           â€¢ ModalFooter
```

---

## Reference Implementation

The **Grades** module serves as the reference implementation with the complete pattern:

| Pattern        | Reference File                                                     |
| -------------- | ------------------------------------------------------------------ |
| Server Actions | `src/components/school-dashboard/listings/grades/actions.ts`       |
| Queries        | `src/components/school-dashboard/listings/grades/queries.ts`       |
| Authorization  | `src/components/school-dashboard/listings/grades/authorization.ts` |
| Validation     | `src/components/school-dashboard/listings/grades/validation.ts`    |
| Table          | `src/components/school-dashboard/listings/grades/table.tsx`        |
| Columns        | `src/components/school-dashboard/listings/grades/columns.tsx`      |
| Form           | `src/components/school-dashboard/listings/grades/form.tsx`         |
| Content        | `src/components/school-dashboard/listings/grades/content.tsx`      |

---

## Core Hooks

| Hook            | Path                                     | Purpose                                                   |
| --------------- | ---------------------------------------- | --------------------------------------------------------- |
| usePlatformData | `src/hooks/use-platform-data.ts`         | Data fetching with optimistic updates and infinite scroll |
| usePlatformView | `src/hooks/use-platform-view.ts`         | View mode (table/grid) with URL persistence               |
| useDataTable    | `src/components/table/use-data-table.ts` | TanStack Table state management                           |
| useModal        | `src/components/atom/modal/context.tsx`  | Modal open/close state management                         |

---

## Modules Status

| Module            | Table | Grid | Search | Export |
| ----------------- | ----- | ---- | ------ | ------ |
| **Announcements** | âœ…    | âœ…   | âœ…     | âœ…     |
| **Assignments**   | âœ…    | âœ…   | âœ…     | âœ…     |
| **Classes**       | âœ…    | âœ…   | âœ…     | âœ…     |
| **Classrooms**    | âœ…    | âœ…   | âœ…     | âœ…     |
| **Events**        | âœ…    | âœ…   | âœ…     | âœ…     |
| **Grades**        | âœ…    | âœ…   | âœ…     | âœ…     |
| **Lessons**       | âœ…    | âœ…   | âœ…     | âœ…     |
| **Parents**       | âœ…    | âœ…   | âœ…     | âœ…     |
| **Staff**         | âœ…    | âœ…   | âœ…     | âœ…     |
| **Students**      | âœ…    | âœ…   | âœ…     | âœ…     |
| **Subjects**      | âœ…    | âœ…   | âœ…     | âœ…     |
| **Teachers**      | âœ…    | âœ…   | âœ…     | âœ…     |

---

## Best Practices

### Multi-Tenant Safety

- **ALWAYS include `schoolId`** in every database query
- Get schoolId from session: `const { schoolId } = session.user`
- Missing schoolId breaks tenant isolation

### Column Definitions

- Define handlers **BEFORE** columns `useMemo`
- Columns with hooks (useModal) must be generated in **client components**
- Pass callbacks via `getColumns(dictionary, lang, { onDelete, onEdit, onView })`

### Optimistic Updates

- Call `optimisticRemove(id)` before server request
- Call `refresh()` on error to rollback
- Use `optimisticUpdate(id, updater)` for in-place updates

### Server Actions

- Start with `"use server"` directive
- Validate with Zod on both client (UX) and server (security)
- Call `revalidatePath()` or `redirect()` after mutations
- Return typed `ActionResponse<T>` results

### Modal Forms

- Use `ModalFormLayout` for two-column header/form layout
- Use `ModalFooter` for progress bar and navigation
- Call `onSuccess()` callback after successful mutations

---

## Listing Maturity Levels

| Level | Feature                                       | Status         |
| ----- | --------------------------------------------- | -------------- |
| **1** | Basic CRUD (create, read, update, delete)     | âœ… Complete    |
| **2** | Relationship context (counts, quick links)    | ğŸ”„ In Progress |
| **3** | Rich detail pages with related data tabs      | ğŸ”„ In Progress |
| **4** | Cross-listing actions (bulk operations)       | ğŸ”„ In Progress |
| **5** | Automated workflows (triggers, notifications) | â³ Planned     |

---

The Listings pattern ensures consistency across all data-driven features. By following this pattern, you get auto-refresh, optimistic updates, view toggles, and export functionalityâ€”all with type-safe queries and role-based authorization.
