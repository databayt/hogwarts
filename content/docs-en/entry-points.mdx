---
title: "Entry Points"
description: "Four main entry points architecture - SaaS marketing, operator dashboard, school sites, and school platform"
---

## Overview

The platform has **four distinct entry points**, each serving different audiences with specific access controls. Understanding these surfaces is critical for development, testing, and user experience design.

```
                          FOUR ENTRY POINTS
    ┌──────────────────────────────────────────────────────────────┐
    │                                                              │
    │  1. SaaS Marketing (ed.databayt.org)                         │
    │     └── Public landing for all visitors                      │
    │     └── "Get Started" → Onboarding                           │
    │     └── "Login" → Role-based redirect                        │
    │                                                              │
    │  2. Operator Dashboard (ed.databayt.org/o/*)                 │
    │     └── DEVELOPER role only                                  │
    │     └── Platform management, analytics, billing              │
    │                                                              │
    │  3. School Site ({school}.databayt.org)                      │
    │     └── Public school marketing pages                        │
    │     └── Prospective students/parents                         │
    │     └── "Apply" → Admission flow                             │
    │                                                              │
    │  4. School Platform ({school}.databayt.org/dashboard)        │
    │     └── Authenticated school management                      │
    │     └── Role-based access (30+ modules)                      │
    │     └── ADMIN, TEACHER, STUDENT, GUARDIAN, STAFF             │
    │                                                              │
    └──────────────────────────────────────────────────────────────┘
```

---

## Entry Point 1: SaaS Marketing Page

**URL**: `https://ed.databayt.org`

**Purpose**: Public landing page for all visitor types including school owners, principals, teachers, students, parents, guests, investors, and contributors.

### Route Structure

```
src/app/[lang]/(marketing)/
├── page.tsx              # Homepage with hero, features, pricing
├── layout.tsx            # Marketing layout with SiteHeader
├── features/page.tsx     # Features page
├── pricing/page.tsx      # Pricing plans
├── blog/page.tsx         # Blog listing
└── docs/page.tsx         # Documentation
```

### Key Components

| Component     | Location                                | Purpose                            |
| ------------- | --------------------------------------- | ---------------------------------- |
| `SiteHeader`  | `components/template/marketing-header/` | Navigation with Login button       |
| `Hero`        | `components/marketing/hero/`            | "Get Started" CTA                  |
| `UserButton`  | `components/auth/user-button.tsx`       | Login/avatar (variant="marketing") |
| `CommandMenu` | `components/template/marketing-header/` | Quick search                       |

### Call-to-Actions

| CTA           | Location     | Destination   | Auth Required? |
| ------------- | ------------ | ------------- | -------------- |
| "Login"       | Header icon  | `/login`      | No             |
| "Get Started" | Hero section | `/onboarding` | Yes (redirect) |
| "Join"        | Various      | `/join`       | No             |

### Login Redirect Logic

```typescript
// src/components/auth/login/action.ts
if (existingUser.role === "DEVELOPER") {
  finalRedirectUrl = `/${locale}/dashboard`
} else {
  finalRedirectUrl = `/${locale}` // Homepage
}
```

| Role       | Redirect After Login   |
| ---------- | ---------------------- |
| DEVELOPER  | `/{locale}/dashboard`  |
| All others | `/{locale}` (homepage) |

### Status

| Feature            | Status  |
| ------------------ | ------- |
| Homepage render    | Working |
| Login button       | Working |
| Get Started flow   | Working |
| Pricing page       | Working |
| Feature comparison | Working |
| SEO/OG metadata    | Working |

---

## Entry Point 2: Operator Dashboard (SaaS Dashboard)

**URL**: `https://ed.databayt.org/o/*`

**Purpose**: Platform operator dashboard for DEVELOPER role only. Manages all schools, analytics, billing, and platform configuration.

### Route Structure

```
src/app/[lang]/(saas-dashboard)/
├── layout.tsx                 # SaaS auth guard (DEVELOPER only)
├── dashboard/page.tsx         # Operator dashboard home
├── analytics/page.tsx         # Platform-wide analytics
├── billing/page.tsx           # Subscription management
├── domains/page.tsx           # Domain configuration
├── tenants/page.tsx           # School/tenant management
├── product/page.tsx           # Product management
├── sales/page.tsx             # Sales management
├── profile/page.tsx           # Operator profile
├── kanban/page.tsx            # Kanban board
├── observability/page.tsx     # Platform observability
└── (catalog)/                 # Catalog management
```

### Access Control

```typescript
// (saas-dashboard)/layout.tsx
const session = await auth()

if (!session) {
  redirect(`/${lang}/login?callbackUrl=/${lang}/dashboard`)
}

if (session.user?.role !== "DEVELOPER") {
  redirect(`/${lang}/access-denied`)
}
```

**Only DEVELOPER role can access.** All other roles are redirected with access denied.

### Key Components

| Component      | Location                             | Purpose                        |
| -------------- | ------------------------------------ | ------------------------------ |
| `SaasSidebar`  | `components/template/saas-sidebar/`  | Navigation for operator routes |
| `SaasHeader`   | `components/template/saas-header/`   | Operator-specific header       |
| `UserButton`   | `components/auth/user-button.tsx`    | Logout (variant="saas")        |
| `TenantsTable` | `components/saas-dashboard/tenants/` | All schools data table         |

### Capabilities

| Capability           | Description                              |
| -------------------- | ---------------------------------------- |
| All Schools Access   | View and manage all schools on platform  |
| Impersonation        | "View as" to enter any school as admin   |
| Platform Analytics   | Usage metrics, revenue, growth           |
| Billing Management   | Subscriptions, invoices, payment methods |
| Domain Configuration | Wildcard DNS, SSL provisioning           |
| Tenant Management    | Activate/deactivate schools              |

### Status

| Feature        | Status  | Notes                               |
| -------------- | ------- | ----------------------------------- |
| Dashboard home | Working | Basic stats                         |
| Tenants        | Working | School/tenant management            |
| Billing        | Partial | Has loading skeleton                |
| Analytics      | Partial | Has loading skeleton                |
| Domains        | Partial | Has loading skeleton                |
| Sales          | Working | Has import, analytics sub-routes    |
| Product        | Working | Product management with detail view |
| Kanban         | Partial | Has loading skeleton                |
| Observability  | Partial | Has loading skeleton                |
| Profile        | Partial | Has loading skeleton                |

---

## Entry Point 3: School Marketing Page (School Site)

**URL**: `https://{school}.databayt.org`

**Purpose**: Public-facing school pages for prospective students, parents, and community. Each school has its own subdomain.

### Route Structure

```
src/app/[lang]/s/[subdomain]/(site)/
├── page.tsx              # School homepage
├── layout.tsx            # SchoolProvider wrapper
├── about/page.tsx        # About the school
├── academic/page.tsx     # Academic programs
├── admissions/page.tsx   # Admission requirements
├── apply/page.tsx        # Application form
├── tour/page.tsx         # Virtual tour
├── contact/page.tsx      # Contact information
└── events/page.tsx       # Public events
```

### Subdomain Routing

The edge proxy (`src/proxy.ts`) detects the subdomain and rewrites to tenant-scoped routes:

```typescript
// Subdomain detection flow
hogwarts.databayt.org
    ↓ (Middleware)
Extract subdomain: "hogwarts"
    ↓
Rewrite to: /[lang]/s/hogwarts/(site)/*
    ↓
SchoolProvider loads school context
```

**URL Patterns**:

| Environment | URL Pattern                  | Internal Route              |
| ----------- | ---------------------------- | --------------------------- |
| Production  | `school.databayt.org`        | `/[lang]/s/school/(site)/*` |
| Preview     | `school---branch.vercel.app` | `/[lang]/s/school/(site)/*` |
| Development | `school.localhost:3000`      | `/[lang]/s/school/(site)/*` |

### Key Components

| Component      | Location                          | Purpose                |
| -------------- | --------------------------------- | ---------------------- |
| `SchoolHeader` | `components/school/site/header/`  | School-branded header  |
| `SchoolHero`   | `components/school/site/hero/`    | School intro with CTA  |
| `UserButton`   | `components/auth/user-button.tsx` | Login (variant="site") |
| `ApplyForm`    | `components/admission/apply/`     | Application submission |

### Call-to-Actions

| CTA              | Destination              | Auth Required? |
| ---------------- | ------------------------ | -------------- |
| "Apply Now"      | `/{subdomain}/apply`     | Yes (to save)  |
| "Schedule Tour"  | `/{subdomain}/tour`      | No             |
| "Contact Us"     | `/{subdomain}/contact`   | No             |
| "Go to Platform" | `/{subdomain}/dashboard` | Yes            |

### Public vs Protected

All `(site)` routes are **public** by default:

```typescript
// src/routes.ts - publicRoutes
export const publicRoutes = [
  "/",
  "/about",
  "/academic",
  "/admissions",
  "/tour",
  "/contact",
  "/events",
  // ...
]
```

### Status

| Feature           | Status      | Notes                        |
| ----------------- | ----------- | ---------------------------- |
| Subdomain routing | Working     | Middleware handles all cases |
| School homepage   | Working     | Dynamic content from DB      |
| About page        | Working     | School description           |
| Academic programs | Working     | Programs listing             |
| Apply form        | Partial     | Form works, needs backend    |
| Virtual tour      | Placeholder | Needs 360 integration        |

---

## Entry Point 4: School Platform (School Dashboard)

**URL**: `https://{school}.databayt.org/dashboard` (and `/s/{subdomain}/(school-dashboard)/*`)

**Purpose**: Authenticated school management platform with role-based access to 30+ modules.

### Route Structure

```
src/app/[lang]/s/[subdomain]/(school-dashboard)/
├── layout.tsx                # PlatformLayout with sidebar
├── dashboard/page.tsx        # Role-specific dashboard
├── admission/                # Admission management
├── attendance/               # ADMIN, TEACHER, STAFF
├── billing/                  # Billing management
├── cards/                    # Student/staff cards
├── charts/                   # Data visualizations
├── exams/                    # ADMIN, TEACHER
├── finance/                  # All authenticated (role-specific views)
├── lab/                      # Lab management
├── library/                  # All authenticated
├── messages/                 # Messaging system
├── notifications/            # Notification center
├── profile/                  # All authenticated
├── sales/                    # Sales management
├── school/                   # School configuration
├── settings/                 # ADMIN, DEVELOPER
├── stats/                    # Statistics dashboards
├── stream/                   # Streaming/video content
├── timetable/                # ADMIN, TEACHER
├── unauthorized/             # Access denied page
└── (listings)/               # Listings route group
    ├── layout.tsx
    ├── announcements/        # ADMIN, TEACHER, STAFF
    ├── assignments/          # ADMIN, TEACHER
    ├── classes/              # ADMIN, TEACHER
    ├── classrooms/           # Classroom management
    ├── events/               # All authenticated
    ├── grades/               # ADMIN, TEACHER
    ├── lessons/              # ADMIN, TEACHER
    ├── parents/              # ADMIN, TEACHER, STAFF
    ├── staff/                # Staff management
    ├── students/             # ADMIN, TEACHER, STAFF
    ├── subjects/             # ADMIN, TEACHER
    └── teachers/             # ADMIN only
```

### Role-Based Access Control

Access is controlled via `roleRoutes` matrix in `src/routes.ts`:

```typescript
export const roleRoutes: Record<string, Role[]> = {
  // Admin routes
  "/admin": ["ADMIN", "DEVELOPER"],
  "/admin/*": ["ADMIN", "DEVELOPER"],
  "/settings/*": ["ADMIN", "DEVELOPER"],

  // Academic management
  "/teachers": ["ADMIN", "DEVELOPER"],
  "/subjects/*": ["ADMIN", "TEACHER", "DEVELOPER"],
  "/grades/*": ["ADMIN", "TEACHER", "DEVELOPER"],

  // Student management
  "/students/*": ["ADMIN", "TEACHER", "STAFF", "DEVELOPER"],
  "/parents/*": ["ADMIN", "TEACHER", "STAFF", "DEVELOPER"],
  "/attendance/*": ["ADMIN", "TEACHER", "STAFF", "DEVELOPER"],

  // Finance (all authenticated, role-specific views in UI)
  "/finance/*": [
    "ADMIN",
    "TEACHER",
    "STUDENT",
    "GUARDIAN",
    "ACCOUNTANT",
    "STAFF",
    "DEVELOPER",
  ],

  // Student/Guardian self-service
  "/my-grades": ["STUDENT", "GUARDIAN", "DEVELOPER"],
  "/my-attendance": ["STUDENT", "GUARDIAN", "DEVELOPER"],
  "/my-fees": ["STUDENT", "GUARDIAN", "DEVELOPER"],
}
```

### Access Check Function

```typescript
// src/routes.ts
export function isRouteAllowedForRole(pathname: string, role: Role): boolean {
  // DEVELOPER has access to everything
  if (role === "DEVELOPER") return true

  // Check exact match first
  if (roleRoutes[pathname]) {
    return roleRoutes[pathname].includes(role)
  }

  // Check wildcard patterns
  for (const [pattern, allowedRoles] of Object.entries(roleRoutes)) {
    if (pattern.endsWith("/*")) {
      const basePattern = pattern.slice(0, -2)
      if (pathname.startsWith(basePattern + "/")) {
        return allowedRoles.includes(role)
      }
    }
  }

  // Default: allow for routes not in matrix
  return true
}
```

### Role-Specific Dashboard Views

| Role       | Dashboard Modules Visible                             |
| ---------- | ----------------------------------------------------- |
| DEVELOPER  | All modules + platform admin link                     |
| ADMIN      | All school modules + settings                         |
| TEACHER    | Classes, lessons, attendance, grades, assignments     |
| STUDENT    | My classes, my grades, my attendance, assignments     |
| GUARDIAN   | Children's progress, fees, communication              |
| ACCOUNTANT | Finance modules only                                  |
| STAFF      | Limited operational views (attendance, announcements) |

### Key Components

| Component         | Location                                                 | Purpose                           |
| ----------------- | -------------------------------------------------------- | --------------------------------- |
| `PlatformLayout`  | `app/[lang]/s/[subdomain]/(school-dashboard)/layout.tsx` | Main layout with sidebar          |
| `PlatformSidebar` | `components/template/platform-sidebar/`                  | Navigation based on role          |
| `PlatformHeader`  | `components/template/platform-header/`                   | School-dashboard header           |
| `UserButton`      | `components/auth/user-button.tsx`                        | Profile menu (variant="platform") |
| `RoleGate`        | `components/auth/role-gate.tsx`                          | Conditional rendering by role     |

### Multi-Tenant Safety

**CRITICAL**: All queries MUST include `schoolId`:

```typescript
// CORRECT - Includes schoolId
const students = await db.student.findMany({
  where: { schoolId, yearLevel: "10" },
})

// WRONG - Breaks tenant isolation
const students = await db.student.findMany({
  where: { yearLevel: "10" },
})
```

### Status

| Module          | Status  | Notes                        |
| --------------- | ------- | ---------------------------- |
| Dashboard       | Working | Role-specific widgets        |
| Students CRUD   | Working | Full DataTable + forms       |
| Teachers CRUD   | Working | Full DataTable + forms       |
| Parents CRUD    | Working | Guardian linking partial     |
| Attendance      | Working | Daily/weekly views           |
| Grades          | Partial | Needs grade calculation      |
| Finance modules | Partial | Basic CRUD, needs Stripe     |
| Timetable       | Partial | Display works, editor needed |
| Announcements   | Working | CRUD with targeting          |
| Events          | Working | Calendar integration         |

---

## Cross-Entry Point Navigation

Users may navigate between entry points based on their role and context:

```
                    Navigation Between Entry Points
    ┌──────────────────────────────────────────────────────────────┐
    │                                                              │
    │  SaaS Marketing → Login → Onboarding → School Platform       │
    │       │              │                      ↑                │
    │       ↓              ↓                      │                │
    │  Operator Dash  School Site ────────────────┘                │
    │  (DEVELOPER)    (Any role with school)                       │
    │                                                              │
    └──────────────────────────────────────────────────────────────┘
```

### Flow: School Site → School Platform ("Platform" Link)

```
       All Possible Scenarios After Clicking "Platform" Link

  Click "Platform" from {school}.databayt.org header
                      │
                      ▼
          ┌─────────────────────┐
          │  Is user logged in? │
          └─────────────────────┘
                      │
           ┌──────────┴──────────┐
           ▼                     ▼
      [NO - Guest]          [YES - Authenticated]
           │                     │
           ▼                     ▼
     Redirect to            ┌────────────────┐
     /{locale}/login        │ Correct school?│
           │                └────────────────┘
           │                     │
           │              ┌──────┴──────┐
           │              ▼             ▼
           │         [NO - Wrong]  [YES - Match]
           │              │             │
           │              ▼             ▼
           │         Access Denied  ┌─────────────┐
           │         or Redirect    │  User Role? │
           │                        └─────────────┘
           │                             │
           │              ┌──────┬───────┼───────┬──────┐
           │              ▼      ▼       ▼       ▼      ▼
           │           ADMIN  TEACHER STUDENT STAFF  OTHER
           │              │      │       │       │      │
           │              ▼      ▼       ▼       ▼      ▼
           │           Full   Teacher Student Staff  Limited
           │           Dashboard View   View   View   View
           │
           ▼
     ┌─────────────┐
     │ Login Form  │
     └─────────────┘
           │
           ▼
     ┌─────────────────┐
     │ Valid login?    │
     └─────────────────┘
           │
      ┌────┴────┐
      ▼         ▼
    [NO]      [YES]
      │         │
      ▼         ▼
    Error    Redirect to
    message  /{locale}/dashboard
```

### Flow: SaaS Marketing → "Get Started"

```
       All Possible Scenarios After Clicking "Get Started"

  Click "Get Started" from ed.databayt.org hero
                      │
                      ▼
          ┌─────────────────────┐
          │  Is user logged in? │
          └─────────────────────┘
                      │
           ┌──────────┴──────────┐
           ▼                     ▼
      [NO - Guest]          [YES - Authenticated]
           │                     │
           ▼                     ▼
     Redirect to            ┌────────────────┐
     /login?callback=       │ Has schoolId?  │
     /onboarding            └────────────────┘
           │                     │
           │              ┌──────┴──────┐
           │              ▼             ▼
           │         [YES - Has]   [NO - None]
           │              │             │
           │              ▼             ▼
           │         Redirect to   Continue to
           │         school dash   /onboarding
           │
           ▼
     ┌─────────────┐
     │ Login/Join  │
     │ Options     │
     └─────────────┘
           │
           ▼
     ┌─────────────────┐
     │ OAuth or Creds  │
     └─────────────────┘
           │
           ▼
     ┌─────────────────────┐
     │ User created/found  │
     │ schoolId: null      │
     └─────────────────────┘
           │
           ▼
     ┌─────────────────────┐
     │ Onboarding Wizard   │
     │ (16 steps)          │
     └─────────────────────┘
           │
           ▼
     School created →
     User = ADMIN →
     Redirect to {school}.databayt.org
```

### Flow: SaaS Marketing → "Live Demo"

```
       All Possible Scenarios After Clicking "Live Demo"

  Click "Live Demo" from ed.databayt.org hero
                      │
                      ▼
          ┌─────────────────────┐
          │ Opens new tab to    │
          │ demo.databayt.org   │
          └─────────────────────┘
                      │
                      ▼
          ┌─────────────────────┐
          │ Demo school site    │
          │ (public marketing)  │
          └─────────────────────┘
                      │
                      ▼
          User can browse:
          • School homepage
          • About page
          • Academic programs
          • Faculty/Houses
          • Contact info
                      │
                      ▼
     ┌────────────────┴────────────────┐
     │                                 │
     ▼                                 ▼
Click "Platform"              Click "Apply"
     │                                 │
     ▼                                 ▼
(See Platform                 Redirect to
 Link flow above)             /apply form
```

### Navigation Scenarios Summary

| From           | Action      | Auth State   | Destination                    |
| -------------- | ----------- | ------------ | ------------------------------ |
| SaaS Marketing | Get Started | Guest        | Login → Onboarding             |
| SaaS Marketing | Get Started | Has school   | Redirect to school dashboard   |
| SaaS Marketing | Get Started | No school    | Onboarding wizard              |
| SaaS Marketing | Live Demo   | Any          | demo.databayt.org (new tab)    |
| SaaS Marketing | Login       | Guest        | Login page                     |
| SaaS Marketing | Login       | DEVELOPER    | Operator dashboard             |
| School Site    | Platform    | Guest        | Login → Dashboard              |
| School Site    | Platform    | Correct user | Role-based dashboard           |
| School Site    | Platform    | Wrong school | Access denied                  |
| School Site    | Apply       | Any          | Application form               |
| Operator Dash  | View School | DEVELOPER    | School dashboard (impersonate) |

### UserButton Variants

The `UserButton` component adapts its menu based on entry point:

| Variant     | Entry Point        | Menu Items                                 |
| ----------- | ------------------ | ------------------------------------------ |
| `marketing` | SaaS Marketing     | Dashboard, Schools (operators), Settings   |
| `saas`      | Operator Dashboard | Profile, Billing, Schools, Settings        |
| `site`      | School Site        | Go to Platform, Profile                    |
| `platform`  | School Platform    | Profile, My Account, School Settings, Help |

---

## Technical Implementation

### Edge Proxy Flow

```typescript
// src/proxy.ts - Simplified flow
export async function middleware(request: NextRequest) {
  const hostname = request.headers.get("host")
  const subdomain = extractSubdomain(hostname)

  if (subdomain && subdomain !== "ed") {
    // School subdomain detected
    // Rewrite: school.databayt.org/about → /en/s/school/about
    return NextResponse.rewrite(
      new URL(`/${locale}/s/${subdomain}${pathname}`, request.url)
    )
  }

  // Main domain - check auth for protected routes
  if (isProtectedRoute(pathname)) {
    const session = await auth()
    if (!session) {
      return NextResponse.redirect(new URL("/login", request.url))
    }
  }

  return NextResponse.next()
}
```

### Session Context

```typescript
// Extended session includes tenant context
session.user = {
  id: string
  email: string
  role: UserRole
  schoolId: string | null  // null for new users / DEVELOPER
  isPlatformAdmin: boolean
}
```

### School Context Provider

```typescript
// src/components/school/school-provider.tsx
export function SchoolProvider({ subdomain, children }) {
  const [school, setSchool] = useState(null)

  useEffect(() => {
    async function loadSchool() {
      const school = await getSchoolBySubdomain(subdomain)
      setSchool(school)
    }
    loadSchool()
  }, [subdomain])

  return (
    <SchoolContext.Provider value={school}>
      {children}
    </SchoolContext.Provider>
  )
}
```

---

## Testing Entry Points

### E2E Test Coverage

```typescript
// e2e/entry-points.spec.ts
test.describe("Entry Points", () => {
  test("SaaS marketing loads without auth", async ({ page }) => {
    await page.goto("https://ed.databayt.org/en")
    await expect(page.locator("h1")).toContainText("School Automation")
  })

  test("Operator dashboard requires DEVELOPER", async ({ page }) => {
    await page.goto("https://ed.databayt.org/en/o")
    await expect(page).toHaveURL(/\/login/)
  })

  test("School site loads with subdomain", async ({ page }) => {
    await page.goto("https://hogwarts.databayt.org/en")
    await expect(page.locator("h1")).toContainText("Hogwarts")
  })

  test("School platform requires auth", async ({ page }) => {
    await page.goto("https://hogwarts.databayt.org/en/dashboard")
    await expect(page).toHaveURL(/\/login/)
  })
})
```

### Manual Testing Checklist

| Entry Point        | Test                          | Expected                          |
| ------------------ | ----------------------------- | --------------------------------- |
| SaaS Marketing     | Visit ed.databayt.org         | Homepage renders                  |
| SaaS Marketing     | Click Login                   | Redirect to /login                |
| SaaS Marketing     | Click Get Started             | Redirect to /login (callback URL) |
| Operator Dashboard | Visit /o as non-DEVELOPER     | Redirect with access denied       |
| Operator Dashboard | Visit /o as DEVELOPER         | Dashboard renders                 |
| School Site        | Visit school.databayt.org     | School homepage renders           |
| School Site        | Click Apply                   | Application form loads            |
| School Platform    | Visit /dashboard without auth | Redirect to /login                |
| School Platform    | Visit /dashboard with auth    | Role-appropriate dashboard        |
| School Platform    | Access /admin as TEACHER      | Access denied or hidden           |

---

## Related Documentation

- [Authentication](/docs/authentication) - Login/logout flows, OAuth, sessions
- [Onboarding](/docs/onboarding) - School creation wizard
- [Architecture](/docs/architecture) - Mirror pattern, file structure
- [Multi-Tenant Safety](/docs/multi-tenant) - schoolId isolation
