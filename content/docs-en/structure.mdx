---
title: "Structure"
description: "Project directory structure, routing layout, and file conventions."
---

## Project Root

```text
hogwarts/
├── public/                     # Static assets (images, fonts, icons)
├── prisma/
│   ├── schema.prisma           # Base schema (datasource, generator, imports)
│   ├── models/                 # 57 .prisma files
│   └── seeds/                  # 46 seed files
├── src/
│   ├── app/                    # Next.js App Router (routes)
│   ├── components/             # 35 component directories
│   ├── lib/                    # 76 utility modules
│   ├── types/                  # Global TypeScript definitions
│   ├── styles/                 # Global styles (typography.css)
│   └── proxy.ts               # Edge proxy (subdomain detection, URL rewriting)
├── content/docs-en/            # MDX documentation (98 pages)
├── scripts/                    # Build and seed scripts
├── tests/                      # E2E test suites (Playwright)
├── .env                        # Central environment (NEVER .env.local)
├── next.config.ts              # Next.js configuration
├── package.json                # pnpm dependencies
└── tsconfig.json               # TypeScript config (@/* → ./src/*)
```

---

## Route Structure (`src/app/`)

All routes live under `[lang]/` for locale support (en/ar). The platform has **4 entry points**, implemented as route groups.

### Entry Points

| Route Group          | URL Pattern                     | Purpose               | Access                     |
| -------------------- | ------------------------------- | --------------------- | -------------------------- |
| `(saas-marketing)`   | `ed.databayt.org/`              | Public marketing site | Public                     |
| `(saas-dashboard)`   | `ed.databayt.org/dashboard`     | Operator dashboard    | DEVELOPER role only        |
| `(school-marketing)` | `school.databayt.org/`          | Public school site    | Public                     |
| `(school-dashboard)` | `school.databayt.org/dashboard` | School platform       | Authenticated school roles |

### Route Tree

```text
src/app/[lang]/
├── (saas-marketing)/              # ed.databayt.org public pages
│   ├── page.tsx                   # Landing page
│   ├── pricing/                   # Pricing page
│   ├── features/                  # Features page
│   ├── blog/                      # Blog
│   └── docs/                      # Documentation viewer
│
├── (saas-dashboard)/              # Operator dashboard (DEVELOPER only)
│   ├── dashboard/                 # Platform analytics
│   ├── tenants/                   # School management
│   ├── billing/                   # Subscription billing
│   ├── sales/                     # Sales pipeline
│   ├── product/                   # Product management
│   ├── domains/                   # Domain management
│   ├── kanban/                    # Task board
│   ├── analytics/                 # Platform analytics
│   ├── observability/             # System monitoring
│   ├── profile/                   # Developer profile
│   └── (catalog)/                 # Platform content catalog
│       └── catalog/
│
├── onboarding/                    # School creation wizard
├── settings/                      # User settings
├── my-school/                     # School selector
│
└── s/[subdomain]/                 # School subdomain routes
    ├── (school-marketing)/        # Public school pages
    │   ├── page.tsx               # School homepage
    │   ├── admissions/            # Admissions info
    │   ├── academic/              # Academic programs
    │   ├── about/                 # About the school
    │   ├── tour/                  # Virtual tour
    │   └── inquiry/               # Contact/inquiry form
    │
    ├── (school-apply)/            # Application portal
    │   └── apply/                 # Student application form
    │
    └── (school-dashboard)/        # Authenticated school platform
        ├── dashboard/             # School dashboard
        ├── admission/             # Admission management
        ├── attendance/            # Attendance tracking
        ├── timetable/             # Schedule management
        ├── exams/                 # Exam management
        ├── stream/                # LMS / streaming
        ├── library/               # Digital library
        ├── finance/               # Financial management
        ├── billing/               # School billing
        ├── messages/              # Messaging
        ├── notifications/         # Notifications
        ├── settings/              # School settings
        ├── profile/               # User profile
        ├── school/                # School info
        ├── sales/                 # School sales
        ├── stats/                 # Statistics
        ├── charts/                # Chart views
        ├── cards/                 # Card views
        ├── lab/                   # Experimental features
        │
        └── (listings)/            # 14 CRUD entities
            ├── announcements/
            ├── assignments/
            ├── classes/
            ├── classrooms/
            ├── events/
            ├── grades/
            ├── lessons/
            ├── parents/
            ├── staff/
            ├── students/
            ├── subjects/
            └── teachers/
```

---

## Component Structure (`src/components/`)

### 35 Component Directories

| Directory               | Purpose                                                  |
| ----------------------- | -------------------------------------------------------- |
| `ui/`                   | shadcn/ui primitives (button, input, card, dialog, etc.) |
| `atom/`                 | Composed components (2+ primitives combined)             |
| `template/`             | Full-page layouts (header, sidebar, footer)              |
| `auth/`                 | Authentication (login, join, reset, OAuth, role gates)   |
| `onboarding/`           | 20-step school creation wizard                           |
| `school-dashboard/`     | School platform features (28 subdirectories)             |
| `saas-dashboard/`       | Operator dashboard features                              |
| `saas-marketing/`       | Marketing site components                                |
| `school-marketing/`     | School public site components                            |
| `stream/`               | LMS / streaming (courses, dashboard, payment)            |
| `table/`                | DataTable with sorting, filtering, pagination            |
| `form/`                 | Form utilities and patterns                              |
| `sidebar/`              | Sidebar navigation                                       |
| `icons/`                | Icon system and registry                                 |
| `internationalization/` | i18n components (language switcher, RTL)                 |
| `theme/`                | Theme provider and toggles                               |
| `providers/`            | React context providers                                  |
| `tenant/`               | Multi-tenant components                                  |
| `school-switcher/`      | School selector component                                |
| `profile/`              | User profile components                                  |
| `docs/`                 | Documentation components                                 |
| `mdx/`                  | MDX rendering components                                 |
| `file/`                 | File upload and management                               |
| `export/`               | Data export utilities                                    |
| `crud-modal/`           | Generic CRUD modal pattern                               |
| `view-toggle/`          | List/grid view toggle                                    |
| `rich-text-editor/`     | Rich text editor                                         |
| `chatbot/`              | AI chatbot interface                                     |
| `monitoring/`           | System monitoring UI                                     |
| `offline/`              | Offline mode support                                     |
| `library/`              | Digital library components                               |
| `billingsdk/`           | Billing SDK integration                                  |
| `sales/`                | Sales pipeline components                                |
| `ha-ui/`                | Home automation UI                                       |
| `kokonutui/`            | KokonutUI components                                     |

### Template Directory (`src/components/template/`)

| Component            | Purpose                          |
| -------------------- | -------------------------------- |
| `platform-sidebar/`  | Main platform sidebar navigation |
| `platform-header/`   | Platform header bar              |
| `platform-footer/`   | Platform footer                  |
| `dashboard-sidebar/` | Dashboard-specific sidebar       |
| `dashboard-header/`  | Dashboard header                 |
| `marketing-header/`  | Marketing site header            |
| `marketing-footer/`  | Marketing site footer            |
| `saas-header/`       | SaaS dashboard header            |
| `saas-sidebar/`      | SaaS dashboard sidebar           |
| `site-header/`       | School site header               |
| `site-footer/`       | School site footer               |
| `docs-sidebar/`      | Documentation sidebar            |
| `mobile-nav/`        | Mobile navigation                |
| `notion-header/`     | Notion-style header              |
| `listing.tsx`        | Generic listing page template    |

### School Dashboard Features (`src/components/school-dashboard/`)

| Directory           | Files       | Purpose                         |
| ------------------- | ----------- | ------------------------------- |
| `listings/`         | 13 entities | CRUD entities (see below)       |
| `dashboard/`        | -           | Dashboard widgets and layout    |
| `attendance/`       | 42          | Attendance tracking module      |
| `timetable/`        | 56          | Schedule generation and display |
| `admission/`        | -           | Student admission workflow      |
| `exams/`            | -           | Exam creation and grading       |
| `finance/`          | -           | Financial management            |
| `fees/`             | -           | Fee collection                  |
| `billing/`          | -           | Billing operations              |
| `library/`          | -           | Digital library                 |
| `reports/`          | -           | Report generation               |
| `notifications/`    | -           | Notification system             |
| `messaging/`        | -           | Internal messaging              |
| `settings/`         | -           | School settings                 |
| `profile/`          | -           | User profile                    |
| `school/`           | -           | School info management          |
| `parent/`           | -           | Parent portal                   |
| `parent-portal/`    | -           | Parent-facing views             |
| `teacher/`          | -           | Teacher-specific views          |
| `analytics/`        | -           | School analytics                |
| `qbank-automation/` | -           | Question bank automation        |
| `activity/`         | -           | Activity tracking               |
| `facility/`         | -           | Facility management             |
| `lab/`              | -           | Experimental features           |
| `import/`           | -           | Data import tools               |
| `shared/`           | -           | Shared school components        |
| `context/`          | -           | React contexts                  |
| `communication/`    | -           | Communication tools             |

### Listing Entities (`src/components/school-dashboard/listings/`)

13 entities, each following the standard feature file pattern:

| Entity           | Key Files                                                                           |
| ---------------- | ----------------------------------------------------------------------------------- |
| `announcements/` | content, actions, validation, form, table, columns                                  |
| `assignments/`   | content, actions, validation, form, table, columns                                  |
| `classes/`       | content, actions, validation, form, table, columns                                  |
| `classrooms/`    | content, actions, validation, form, table, columns                                  |
| `events/`        | content, actions, validation, form, table, columns                                  |
| `grades/`        | content, actions, validation, form, table, columns                                  |
| `lessons/`       | content, actions, validation, form, table, columns                                  |
| `parents/`       | content, actions, validation, form, table, columns                                  |
| `staff/`         | content, actions, validation, form, table, columns                                  |
| `students/`      | content, actions, validation, form, table, columns, enrollment/, profile/, reports/ |
| `subjects/`      | content, actions, validation, form, table, columns, catalog/                        |
| `teachers/`      | content, actions, validation, form, table, columns                                  |

---

## Standard Feature File Pattern

Every feature directory follows a consistent set of files.

| File               | Type             | Purpose                                    |
| ------------------ | ---------------- | ------------------------------------------ |
| `content.tsx`      | Server Component | Main UI, data fetching, layout             |
| `actions.ts`       | Server Actions   | `"use server"` mutations with schoolId     |
| `validation.ts`    | Shared           | Zod schemas for form and server validation |
| `form.tsx`         | Client Component | Create/edit forms                          |
| `table.tsx`        | Client Component | DataTable with sorting, filtering          |
| `columns.tsx`      | Client Component | Column definitions (must use `useMemo`)    |
| `types.ts`         | Shared           | TypeScript interfaces                      |
| `config.ts`        | Shared           | Constants, configurations                  |
| `queries.ts`       | Server           | Database query functions                   |
| `authorization.ts` | Server           | Role-based access checks                   |

---

## Mirror Pattern

**Routes in `app/` mirror components in `components/`.** The page file imports the content component.

```text
Route:     src/app/[lang]/s/[subdomain]/(school-dashboard)/(listings)/students/page.tsx
Component: src/components/school-dashboard/listings/students/content.tsx
```

The page file is thin -- it imports and renders the content component:

```tsx
// page.tsx
import { Content } from "@/components/school-dashboard/listings/students/content"

export default function StudentsPage() {
  return <Content />
}
```

---

## Prisma Schema (`prisma/`)

```text
prisma/
├── schema.prisma               # Datasource, generator, model imports
├── models/                     # 57 .prisma files
│   ├── school.prisma           # School, TranslationCache
│   ├── auth.prisma             # User, Account, Session, Role
│   ├── students.prisma         # Student, Guardian
│   ├── staff.prisma            # Staff, StaffMember
│   ├── subjects.prisma         # Subject, SubjectAssignment
│   ├── academic-structure.prisma # YearLevel, Class, Section
│   ├── timetable.prisma        # Timetable, Period, Slot
│   ├── attendance.prisma       # Attendance, AttendanceRecord
│   ├── catalog.prisma          # CatalogSubject, CatalogTopic, CatalogLesson
│   ├── exam.prisma             # Exam, ExamResult
│   ├── finance-core.prisma     # Account, Transaction, Budget
│   ├── subscription.prisma     # Subscription, Plan, Invoice
│   ├── stream.prisma           # Course, Lesson, Progress
│   └── ...                     # 44 more model files
└── seeds/                      # 46 seed files
    ├── index.ts                # Seed orchestrator (NEVER run directly)
    ├── single.ts               # Single seed runner (ALWAYS use this)
    ├── school.ts               # Demo school seed
    ├── auth.ts                 # User accounts seed
    ├── catalog.ts              # Subject catalog seed
    ├── classes.ts              # Class structure seed
    ├── timetable.ts            # Timetable seed
    └── ...                     # 39 more seed files
```

---

## Lib Utilities (`src/lib/`)

76 modules. Key utilities:

| File                  | Purpose                                      |
| --------------------- | -------------------------------------------- |
| `db.ts`               | Prisma client singleton                      |
| `tenant-context.ts`   | Multi-tenant context resolution              |
| `catalog-setup.ts`    | Catalog bridge provisioning                  |
| `google-translate.ts` | Google Translate API client                  |
| `translate.ts`        | Translation with DB caching                  |
| `content-display.ts`  | `getDisplayText()` for on-demand translation |
| `auto-translate.ts`   | Auto-translation utilities                   |
| `stripe.ts`           | Stripe payment integration                   |
| `cloudfront.ts`       | CloudFront CDN utilities                     |
| `rate-limit.ts`       | API rate limiting                            |
| `oauth-redirect.ts`   | OAuth callback handling                      |
| `school-access.ts`    | School access control                        |
| `mapbox.ts`           | Mapbox geocoding                             |
| `format-date.ts`      | Date formatting utilities                    |
| `join-code.ts`        | School join code generation                  |

---

## Key Rules

| Rule                   | Detail                                                                 |
| ---------------------- | ---------------------------------------------------------------------- |
| Package manager        | `pnpm` only (Vercel requirement)                                       |
| Environment            | Central `.env` only. Never `.env.local` or `.env.development`          |
| Multi-tenant isolation | Every DB query must include `schoolId`                                 |
| Mirror pattern         | `app/` routes map to `components/` directories                         |
| Semantic HTML          | No hardcoded `text-*` or `font-*` classes. Use `h1`-`h6`, `p`, `small` |
| Locale routing         | All routes under `[lang]/` for en/ar support                           |
| Subdomain routing      | School routes under `s/[subdomain]/`                                   |
| Import alias           | `@/*` maps to `./src/*`                                                |
| Port                   | Always port 3000 for dev server                                        |
| Seeding                | Always `pnpm db:seed:single <name>`. Never `pnpm db:seed`              |

---

## Import Examples

```typescript
import { auth } from "@/auth" // Authentication

import { getDisplayText } from "@/lib/content-display" // On-demand translation
import { db } from "@/lib/db" // Prisma client

import { getTenantContext } from "@/lib/tenant-context" // Multi-tenant context
import { cn } from "@/lib/utils" // Class merging utility

import { Button } from "@/components/ui/button" // UI primitives
import { Card } from "@/components/ui/card"
import { PageHeader } from "@/components/atom/page-header" // Atoms

import { Content } from "@/components/school-dashboard/listings/students/content"
import { PlatformSidebar } from "@/components/template/platform-sidebar" // Templates
```
