---
description: Auth (NextAuth v5 / Auth.js) patterns and session shape
globs:
  - "src/auth.ts"
  - "src/auth.config.ts"
  - "src/app/api/auth/**"
  - "src/components/auth/**"
alwaysApply: false
---

- Session extends user with `id`, `role`, `isTwoFactorEnabled`, and `isOAuth`.
- Keep callbacks pure and typed; log judiciously in development only.
- Credentials provider requires verified email; handle 2FA confirmation tokens.
- OAuth linking sets `emailVerified` at account link.
- Use adapter methods and central DB client. Do not leak cross-tenant data.

Referenced context

@src/auth.ts
@src/components/auth/validation.ts

